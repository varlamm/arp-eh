import{v as X}from"./vue-i18n.c6de3223.js";import{u as J,w as x,x as K}from"./main.f5ac513d.js";import{l as Q}from"./lodash.8ab3583e.js";import{u as Y}from"./vue-router.746ec05f.js";import"./moment.9709ab41.js";import{u as Z}from"./invoice.c832422e.js";import{u as ee}from"./global.b17b6368.js";import{f as j,r as v,i as te,a as g,e as oe,O as d,j as u,k as y,U as s,l as a,u as r,g as C,as as V,X as m,R as k,P as i,M as F,aW as ae,F as se}from"./@vue.8cc12e6e.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@vuelidate.c7422de1.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./auth.f67c9755.js";const re={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 bg-white w-88 xl:block"},ne={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},ie={class:"flex ml-3",role:"group","aria-label":"First group"},le={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},de={class:"px-2"},ce={class:"px-2"},ue={class:"px-2"},me={class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid sw-scroll"},pe={class:"flex-2"},fe={class:"mb-1 not-italic font-medium leading-5 text-gray-500 capitalize text-md"},_e={class:"flex-1 whitespace-nowrap right"},ve={class:"text-sm text-right text-gray-500 non-italic"},ye={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},be={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},he=["src"],We={__name:"View",setup(ge){const p=Y(),l=Z(),f=ee(),{tm:S}=X.useI18n();let b=j({}),t=j({orderBy:"",orderByField:"",invoice_number:""});v(null),v(null);let B=v(!1),R=v(!1);v(!1),te("utils"),J();const U=g(()=>l.selectedViewInvoice),$=g(()=>t.orderBy==="asc"||t.orderBy==null);g(()=>$.value?S("general.ascending"):S("general.descending"));const P=g(()=>b.unique_hash?`/invoices/pdf/${b.unique_hash}`:!1);oe(p,()=>{D()}),N(),D(),c=Q.exports.debounce(c,500);function z(e){return p.params.id==e}async function N(){await l.fetchInvoices({limit:"all"},f.companySlug),setTimeout(()=>{M()},500)}async function D(){if(p&&p.params.id){let e=await l.fetchViewInvoice({id:p.params.id},f.companySlug);e.data&&Object.assign(b,e.data.data)}}function M(){const e=document.getElementById(`invoice-${p.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function c(){let e={};t.invoice_number!==""&&t.invoice_number!==null&&t.invoice_number!==void 0&&(e.invoice_number=t.invoice_number),t.orderBy!==null&&t.orderBy!==void 0&&(e.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(e.orderByField=t.orderByField),B.value=!0;try{let n=await l.searchInvoice(e,f.companySlug);B.value=!1,n.data.data&&(l.invoices=n.data.data)}catch{B.value=!1}}function T(){return t.orderBy==="asc"?(t.orderBy="desc",c(),!0):(t.orderBy="asc",c(),!0)}function q(){router.push({name:"invoice.portal.payment",params:{id:l.selectedViewInvoice.id,company:l.selectedViewInvoice.company.slug}})}return(e,n)=>{const _=d("BaseIcon"),h=d("BaseButton"),A=d("BasePageHeader"),E=d("BaseInput"),w=d("BaseRadio"),I=d("BaseInputGroup"),G=d("BaseInvoiceStatusBadge"),L=d("BaseFormatMoney"),O=d("router-link"),H=d("BasePage");return u(),y(H,{class:"xl:pl-96"},{default:s(()=>[a(A,{title:U.value.invoice_number},{actions:s(()=>[a(h,{disabled:r(R),variant:"primary-outline",class:"mr-2",tag:"a",href:`/invoices/pdf/${r(b).unique_hash}`,download:""},{left:s(o=>[a(_,{name:"DownloadIcon",class:C(o.class)},null,8,["class"]),V(" "+m(e.$t("invoices.download")),1)]),_:1},8,["disabled","href"]),r(l)?.selectedViewInvoice?.paid_status!=="PAID"&&r(f).enabledModules.includes("Payments")?(u(),y(h,{key:0,variant:"primary",onClick:q},{default:s(()=>[V(m(e.$t("invoices.pay_invoice")),1)]),_:1})):k("",!0)]),_:1},8,["title"]),i("div",re,[i("div",ne,[a(E,{modelValue:r(t).invoice_number,"onUpdate:modelValue":n[0]||(n[0]=o=>r(t).invoice_number=o),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:c},{right:s(()=>[a(_,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"]),i("div",ie,[a(K,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:s(()=>[a(h,{variant:"gray"},{default:s(()=>[a(_,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:s(()=>[i("div",le,m(e.$t("general.sort_by")),1),i("div",de,[a(x,{class:"pt-3 rounded-md hover:rounded-md"},{default:s(()=>[a(I,{class:"-mt-3 font-normal"},{default:s(()=>[a(w,{id:"filter_invoice_date",modelValue:r(t).orderByField,"onUpdate:modelValue":[n[1]||(n[1]=o=>r(t).orderByField=o),c],label:e.$t("invoices.invoice_date"),name:"filter",size:"sm",value:"invoice_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),i("div",ce,[a(x,{class:"pt-3 rounded-md hover:rounded-md"},{default:s(()=>[a(I,{class:"-mt-3 font-normal"},{default:s(()=>[a(w,{id:"filter_due_date",modelValue:r(t).orderByField,"onUpdate:modelValue":[n[2]||(n[2]=o=>r(t).orderByField=o),c],label:e.$t("invoices.due_date"),name:"filter",size:"sm",value:"due_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),i("div",ue,[a(x,{class:"pt-3 rounded-md hover:rounded-md"},{default:s(()=>[a(I,{class:"-mt-3 font-normal"},{default:s(()=>[a(w,{id:"filter_invoice_number",modelValue:r(t).orderByField,"onUpdate:modelValue":[n[3]||(n[3]=o=>r(t).orderByField=o),c],label:e.$t("invoices.invoice_number"),size:"sm",name:"filter",value:"invoice_number"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),a(h,{class:"ml-1",variant:"white",onClick:T},{default:s(()=>[$.value?(u(),y(_,{key:0,name:"SortAscendingIcon",class:"h-5"})):(u(),y(_,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),i("div",me,[(u(!0),F(se,null,ae(r(l).invoices,(o,W)=>(u(),y(O,{id:"invoice-"+o.id,key:W,to:`/${r(f).companySlug}/customer/invoices/${o.id}/view`,class:C(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":z(o.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:s(()=>[i("div",pe,[i("div",fe,m(o.invoice_number),1),a(G,{status:o.status},{default:s(()=>[V(m(o.status),1)]),_:2},1032,["status"])]),i("div",_e,[a(L,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:o.total,currency:o.currency},null,8,["amount","currency"]),i("div",ve,m(o.formatted_invoice_date),1)])]),_:2},1032,["id","to","class"]))),128)),r(l).invoices.length?k("",!0):(u(),F("p",ye,m(e.$t("invoices.no_matching_invoices")),1))])]),i("div",be,[P.value?(u(),F("iframe",{key:0,ref:"report",src:P.value,class:"flex-1 border border-gray-400 border-solid rounded-md",onClick:n[4]||(n[4]=(...o)=>e.ViewReportsPDF&&e.ViewReportsPDF(...o))},null,8,he)):k("",!0)])]),_:1})}}};export{We as default};
