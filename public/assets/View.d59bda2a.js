import{v as re}from"./vue-i18n.c6de3223.js";import{u as le}from"./vue-router.746ec05f.js";import{l as ne}from"./lodash.8ab3583e.js";import{c as ie,i as de,e as ue,j as ce,g as C}from"./main.f5ac513d.js";import{_ as me}from"./SendInvoiceModal.b7b34c34.js";import{_ as pe}from"./InvoiceIndexDropdown.86fb0c41.js";import{L as ve}from"./LoadingIcon.f4bad6f3.js";import{r as y,f as fe,a as S,e as _e,O as n,j as i,M as T,l as a,k as p,U as s,P as d,u as b,as as F,X as v,R as f,F as P,aW as ye,g as ge}from"./@vue.8cc12e6e.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./mail-driver.f62a08cc.js";const be={class:"text-sm mr-3"},he={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},Be={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},xe={class:"mb-6"},Ie={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},ke={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},Se={class:"flex-2"},Te={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},we={class:"flex-1 whitespace-nowrap right"},Ve={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},Fe={key:0,class:"flex justify-center p-4 items-center"},Ee={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},$e={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},De=["src"],nt={__name:"View",setup(Ne){const U=ie(),E=de(),$=ue(),R=ce(),{t:_}=re.useI18n(),r=y(null),h=le(),w=y(!1),B=y(!1),u=y(null),x=y(1),D=y(1),M=y(null),t=fe({orderBy:null,orderByField:null,searchText:null}),O=S(()=>r.value.invoice_number),j=S(()=>t.orderBy==="asc"||t.orderBy==null);S(()=>j.value?_("general.ascending"):_("general.descending"));const H=S(()=>`/invoices/pdf/${r.value.unique_hash}`);S(()=>r.value&&r.value.id?invoice.value.id:null),_e(h,(e,l)=>{e.name==="invoices.view"&&z()});async function G(){R.openDialog({title:_("general.are_you_sure"),message:_("invoices.invoice_mark_as_sent"),yesLabel:_("general.ok"),noLabel:_("general.cancel"),variant:"primary",hideNoButton:!1,size:"lg"}).then(async e=>{w.value=!1,e&&(await E.markAsSent({id:r.value.id,status:"SENT"}),r.value.status="SENT",w.value=!0),w.value=!1})}async function W(e){U.openModal({title:_("invoices.send_invoice"),componentName:"SendInvoiceModal",id:r.value.id,data:r.value})}function q(e){return h.params.id==e}async function I(e,l=!1){if(B.value)return;let c={};t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(c.search=t.searchText),t.orderBy!==null&&t.orderBy!==void 0&&(c.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(c.orderByField=t.orderByField),B.value=!0;let k=await E.fetchInvoices({page:e,...c});B.value=!1,u.value=u.value?u.value:[],u.value=[...u.value,...k.data.data],x.value=e||1,D.value=k.data.meta.last_page;let V=u.value.find(g=>g.id==h.params.id);l==!1&&!V&&x.value<D.value&&Object.keys(c).length===0&&I(++x.value),V&&setTimeout(()=>{l==!1&&X()},500)}function X(){const e=document.getElementById(`invoice-${h.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"),Y())}function Y(){M.value.addEventListener("scroll",e=>{e.target.scrollTop>0&&e.target.scrollTop+e.target.clientHeight>e.target.scrollHeight-200&&x.value<D.value&&I(++x.value,!0)})}async function z(){let e=await E.fetchInvoice(h.params.id);e.data&&(r.value={...e.data.data})}async function m(){u.value=[],I()}function J(){return t.orderBy==="asc"?(t.orderBy="desc",m(),!0):(t.orderBy="asc",m(),!0)}function K(){let e=u.value.findIndex(l=>l.id===r.value.id);u.value[e]&&(u.value[e].status="SENT",r.value.status="SENT")}return I(),z(),m=ne.exports.debounce(m,500),(e,l)=>{const c=n("BaseButton"),k=n("router-link"),V=n("BasePageHeader"),g=n("BaseIcon"),Q=n("BaseInput"),N=n("BaseRadio"),A=n("BaseInputGroup"),L=n("BaseDropdownItem"),Z=n("BaseDropdown"),ee=n("BaseText"),te=n("BaseEstimateStatusBadge"),ae=n("BaseFormatMoney"),oe=n("BasePage");return i(),T(P,null,[a(me,{onUpdate:K}),r.value?(i(),p(oe,{key:0,class:"xl:pl-96 xl:ml-8"},{default:s(()=>[a(V,{title:O.value},{actions:s(()=>[d("div",be,[r.value.status==="DRAFT"&&b($).hasAbilities(b(C).EDIT_INVOICE)?(i(),p(c,{key:0,disabled:w.value,variant:"primary-outline",onClick:G},{default:s(()=>[F(v(e.$t("invoices.mark_as_sent")),1)]),_:1},8,["disabled"])):f("",!0)]),r.value.status==="DRAFT"&&b($).hasAbilities(b(C).SEND_INVOICE)?(i(),p(c,{key:0,variant:"primary",class:"text-sm",onClick:W},{default:s(()=>[F(v(e.$t("invoices.send_invoice")),1)]),_:1})):f("",!0),b($).hasAbilities(b(C).CREATE_PAYMENT)?(i(),p(k,{key:1,to:`/admin/payments/${e.$route.params.id}/create`},{default:s(()=>[r.value.status==="SENT"||r.value.status==="VIEWED"?(i(),p(c,{key:0,variant:"primary"},{default:s(()=>[F(v(e.$t("invoices.record_payment")),1)]),_:1})):f("",!0)]),_:1},8,["to"])):f("",!0),a(pe,{class:"ml-3",row:r.value,"load-data":I},null,8,["row"])]),_:1},8,["title"]),d("div",he,[d("div",Be,[d("div",xe,[a(Q,{modelValue:t.searchText,"onUpdate:modelValue":l[0]||(l[0]=o=>t.searchText=o),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:l[1]||(l[1]=o=>m())},{right:s(()=>[a(g,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),d("div",Ie,[a(Z,{class:"ml-3",position:"bottom-start"},{activator:s(()=>[a(c,{size:"md",variant:"gray"},{default:s(()=>[a(g,{name:"FilterIcon"})]),_:1})]),default:s(()=>[d("div",ke,v(e.$t("general.sort_by")),1),a(L,{class:"flex px-1 py-2 cursor-pointer"},{default:s(()=>[a(A,{class:"-mt-3 font-normal"},{default:s(()=>[a(N,{id:"filter_invoice_date",modelValue:t.orderByField,"onUpdate:modelValue":[l[2]||(l[2]=o=>t.orderByField=o),m],label:e.$t("reports.invoices.invoice_date"),size:"sm",name:"filter",value:"invoice_date"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(L,{class:"flex px-1 py-2 cursor-pointer"},{default:s(()=>[a(A,{class:"-mt-3 font-normal"},{default:s(()=>[a(N,{id:"filter_due_date",modelValue:t.orderByField,"onUpdate:modelValue":[l[3]||(l[3]=o=>t.orderByField=o),m],label:e.$t("invoices.due_date"),value:"due_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1}),a(L,{class:"flex px-1 py-2 cursor-pointer"},{default:s(()=>[a(A,{class:"-mt-3 font-normal"},{default:s(()=>[a(N,{id:"filter_invoice_number",modelValue:t.orderByField,"onUpdate:modelValue":[l[4]||(l[4]=o=>t.orderByField=o),m],label:e.$t("invoices.invoice_number"),value:"invoice_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),a(c,{class:"ml-1",size:"md",variant:"gray",onClick:J},{default:s(()=>[j.value?(i(),p(g,{key:0,name:"SortAscendingIcon"})):(i(),p(g,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),d("div",{ref_key:"invoiceListSection",ref:M,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(i(!0),T(P,null,ye(u.value,(o,se)=>(i(),T("div",{key:se},[o?(i(),p(k,{key:0,id:"invoice-"+o.id,to:`/admin/invoices/${o.id}/view`,class:ge(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":q(o.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:s(()=>[d("div",Se,[a(ee,{text:o.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),d("div",Te,v(o.invoice_number),1),a(te,{status:o.status,class:"px-1 text-xs"},{default:s(()=>[F(v(o.status),1)]),_:2},1032,["status"])]),d("div",we,[a(ae,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:o.total,currency:o.customer.currency},null,8,["amount","currency"]),d("div",Ve,v(o.formatted_invoice_date),1)])]),_:2},1032,["id","to","class"])):f("",!0)]))),128)),B.value?(i(),T("div",Fe,[a(ve,{class:"h-6 m-1 animate-spin text-primary-400"})])):f("",!0),!u.value?.length&&!B.value?(i(),T("p",Ee,v(e.$t("invoices.no_matching_invoices")),1)):f("",!0)],512)]),d("div",$e,[d("iframe",{src:`${H.value}`,class:"flex-1 border border-gray-400 border-solid bg-white rounded-md frame-style"},null,8,De)])]),_:1})):f("",!0)],64)}}};export{nt as default};
