import{r as x,f as Z,a as q,e as P,o as ee,O as m,j as y,M as O,P as g,l as i,u as e,X as k,U as c,k as p,R as S,F as j,g as ne,as as te,by as ie}from"./@vue.8cc12e6e.js";import{u as A,b as re}from"./vue-router.746ec05f.js";import{v as oe}from"./vue-i18n.c6de3223.js";import{t as G,d as ae,b as le,m as se,r as ce,c as ue,l as de,u as me}from"./main.f5ac513d.js";import{_ as ge,a as ve,b as fe,c as ye,d as be,e as Ie,f as pe}from"./SalesTax.6c6ba50a.js";import{_ as we}from"./ExchangeRateConverter.8557ba74.js";import{u as _e}from"./@vueuse.b6c5a1c1.js";import{_ as $e}from"./CreateCustomFields.52efad8b.js";import{c as f,r as R,a as N,f as Re,d as qe}from"./@vuelidate.c7422de1.js";import{_ as Be}from"./TaxTypeModal.0de294f9.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./vuedraggable.e15681bc.js";import"./sortablejs.79e2f684.js";import"./DragIcon.20becf7b.js";import"./SelectNotePopup.9871fb7b.js";import"./NoteModal.86bd9d44.js";import"./payment.333e3a22.js";import"./exchange-rate.b16bc248.js";const Se={class:"col-span-5 pr-0"},he={class:"flex mt-7"},Ce={class:"relative w-20 mt-8"},Ve={class:"ml-2"},Fe={class:"p-0 mb-1 leading-snug text-left text-black"},Le={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},Me={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},ke={__name:"RecurringInvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const r=n,C=A(),t=G(),V=ae(),w=x(!1),U=Z([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),F=q(()=>t.newRecurringInvoice.selectedFrequency&&t.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),u=q(()=>r.isEdit?V.config.recurring_invoice_status.update_status:V.config.recurring_invoice_status.create_status);P(()=>t.newRecurringInvoice.selectedFrequency,a=>{t.isFetchingInitialSettings||(a&&a.value!=="CUSTOM"?t.newRecurringInvoice.frequency=a.value:t.newRecurringInvoice.frequency=null)}),ee(()=>{C.params.id||_()});function d(a){return t.newRecurringInvoice.limit_by===a}const T=_e(()=>{_()},500);async function _(){const a=t.newRecurringInvoice.frequency;if(!a)return;w.value=!0;let o={starts_at:t.newRecurringInvoice.starts_at,frequency:a};try{await t.fetchRecurringInvoiceFrequencyDate(o)}catch(B){console.error(B),w.value=!1}w.value=!1}return(a,o)=>{const B=m("BaseCustomerSelectPopup"),$=m("BaseSwitch"),h=m("BaseDatePicker"),v=m("BaseInputGroup"),b=m("BaseMultiselect"),L=m("BaseInput");return y(),O(j,null,[g("div",Se,[i(B,{modelValue:e(t).newRecurringInvoice.customer,"onUpdate:modelValue":o[0]||(o[0]=l=>e(t).newRecurringInvoice.customer=l),valid:n.v.customer_id,"content-loading":n.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),g("div",he,[g("div",Ce,[i($,{modelValue:e(t).newRecurringInvoice.send_automatically,"onUpdate:modelValue":o[1]||(o[1]=l=>e(t).newRecurringInvoice.send_automatically=l),class:"absolute -top-4"},null,8,["modelValue"])]),g("div",Ve,[g("p",Fe,k(a.$t("recurring_invoices.send_automatically")),1),g("p",Le,k(a.$t("recurring_invoices.send_automatically_desc")),1)])])]),g("div",Me,[i(v,{label:a.$t("recurring_invoices.starts_at"),"content-loading":n.isLoading,required:"",error:n.v.starts_at.$error&&n.v.starts_at.$errors[0].$message},{default:c(()=>[i(h,{modelValue:e(t).newRecurringInvoice.starts_at,"onUpdate:modelValue":o[2]||(o[2]=l=>e(t).newRecurringInvoice.starts_at=l),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:n.v.starts_at.$error,onChange:o[3]||(o[3]=l=>_())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),i(v,{label:a.$t("recurring_invoices.next_invoice_date"),"content-loading":n.isLoading,required:""},{default:c(()=>[i(h,{modelValue:e(t).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":o[4]||(o[4]=l=>e(t).newRecurringInvoice.next_invoice_at=l),"content-loading":n.isLoading,"calendar-button":!0,disabled:!0,loading:w.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),i(v,{label:a.$t("recurring_invoices.limit_by"),"content-loading":n.isLoading,class:"lg:mt-0",required:"",error:n.v.limit_by.$error&&n.v.limit_by.$errors[0].$message},{default:c(()=>[i(b,{modelValue:e(t).newRecurringInvoice.limit_by,"onUpdate:modelValue":o[5]||(o[5]=l=>e(t).newRecurringInvoice.limit_by=l),"content-loading":n.isLoading,options:U,label:"label",invalid:n.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),d("DATE")?(y(),p(v,{key:0,label:a.$t("recurring_invoices.limit_date"),"content-loading":n.isLoading,required:d("DATE"),error:n.v.limit_date.$error&&n.v.limit_date.$errors[0].$message},{default:c(()=>[i(h,{modelValue:e(t).newRecurringInvoice.limit_date,"onUpdate:modelValue":o[6]||(o[6]=l=>e(t).newRecurringInvoice.limit_date=l),"content-loading":n.isLoading,invalid:n.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):S("",!0),d("COUNT")?(y(),p(v,{key:1,label:a.$t("recurring_invoices.count"),"content-loading":n.isLoading,required:d("COUNT"),error:n.v.limit_count.$error&&n.v.limit_count.$errors[0].$message},{default:c(()=>[i(L,{modelValue:e(t).newRecurringInvoice.limit_count,"onUpdate:modelValue":o[7]||(o[7]=l=>e(t).newRecurringInvoice.limit_count=l),"content-loading":n.isLoading,invalid:n.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):S("",!0),i(v,{label:a.$t("recurring_invoices.status"),required:"","content-loading":n.isLoading,error:n.v.status.$error&&n.v.status.$errors[0].$message},{default:c(()=>[i(b,{modelValue:e(t).newRecurringInvoice.status,"onUpdate:modelValue":o[8]||(o[8]=l=>e(t).newRecurringInvoice.status=l),options:u.value,"content-loading":n.isLoading,invalid:n.v.status.$error,placeholder:a.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),i(v,{label:a.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":n.isLoading,error:n.v.selectedFrequency.$error&&n.v.selectedFrequency.$errors[0].$message},{default:c(()=>[i(b,{modelValue:e(t).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":o[9]||(o[9]=l=>e(t).newRecurringInvoice.selectedFrequency=l),"content-loading":n.isLoading,options:e(t).frequencies,label:"label",invalid:n.v.selectedFrequency.$error,object:"",onChange:_},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),F.value?(y(),p(v,{key:2,label:a.$t("recurring_invoices.frequency.title"),"content-loading":n.isLoading,required:"",error:n.v.frequency.$error&&n.v.frequency.$errors[0].$message},{default:c(()=>[i(L,{modelValue:e(t).newRecurringInvoice.frequency,"onUpdate:modelValue":[o[10]||(o[10]=l=>e(t).newRecurringInvoice.frequency=l),e(T)],"content-loading":n.isLoading,disabled:!F.value,invalid:n.v.frequency.$error,loading:w.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):S("",!0),i(we,{store:e(t),"store-prop":"newRecurringInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(t).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},Ue=["onSubmit"],Te={class:"flex"},Ne={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},Ee={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},xe={class:"w-full relative lg:w-1/2"},E="newRecurringInvoice",wn={__name:"RecurringInvoiceCreate",setup(n){const r=G(),C=le(),t=se(),V=ce(),w=ue(),U=de(),F=me(),{t:u}=oe.useI18n();let d=x(!1);const T=x(["customer","company","customerCustom","invoice","invoiceCustom"]);let _=A(),a=re(),o=q(()=>r.isFetchingInvoice||r.isFetchingInitialSettings),B=q(()=>$.value?u("recurring_invoices.edit_invoice"):u("recurring_invoices.new_invoice")),$=q(()=>_.name==="recurring-invoices.edit");const h=q(()=>C.selectedCompanySettings.sales_tax_us_enabled==="YES"&&V.salesTaxUSEnabled),v={starts_at:{required:f.withMessage(u("validation.required"),R)},status:{required:f.withMessage(u("validation.required"),R)},frequency:{required:f.withMessage(u("validation.required"),R)},limit_by:{required:f.withMessage(u("validation.required"),R)},limit_date:{required:f.withMessage(u("validation.required"),N(function(){return r.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:f.withMessage(u("validation.required"),N(function(){return r.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:f.withMessage(u("validation.required"),R)},customer_id:{required:f.withMessage(u("validation.required"),R)},exchange_rate:{required:N(function(){return f.withMessage(u("validation.required"),R),r.showExchangeRate}),decimal:f.withMessage(u("validation.valid_exchange_rate"),Re)}},b=qe(v,q(()=>r.newRecurringInvoice),{$scope:E});r.resetCurrentRecurringInvoice(),r.fetchRecurringInvoiceInitialSettings($.value),t.resetCustomFields(),b.value.$reset,P(()=>r.newRecurringInvoice.customer,s=>{s&&s.currency?r.newRecurringInvoice.currency=s.currency:r.newRecurringInvoice.currency=C.selectedCompanyCurrency});async function L(){if(b.value.$touch(),b.value.$invalid)return!1;d.value=!0;let s={...r.newRecurringInvoice,sub_total:r.getSubTotal,total:r.getTotal,tax:r.getTotalTax};if(s.customer&&!s.customer.email&&s.send_automatically){F.showNotification({type:"error",message:u("recurring_invoices.add_customer_email")}),l(),d.value=!1;return}_.params.id?r.updateRecurringInvoice(s).then(I=>{I.data.data&&a.push(`/admin/recurring-invoices/${I.data.data.id}/view`),d.value=!1}).catch(I=>{d.value=!1}):H(s)}async function l(){let s=r.newRecurringInvoice.customer.id;await U.fetchCustomer(s),w.openModal({title:u("customers.edit_customer"),componentName:"CustomerModal"})}function H(s){r.addRecurringInvoice(s).then(I=>{I.data.data&&a.push(`/admin/recurring-invoices/${I.data.data.id}/view`),d.value=!1}).catch(I=>{d.value=!1})}return(s,I)=>{const M=m("BaseBreadcrumbItem"),z=m("BaseBreadcrumb"),D=m("BaseButton"),X=m("router-link"),Y=m("BaseIcon"),J=m("BasePageHeader"),K=m("BaseScrollPane"),Q=m("BasePage");return y(),O(j,null,[i(ge),i(ve),i(Be),h.value&&!e(o)?(y(),p(fe,{key:0,store:e(r),"store-prop":"newRecurringInvoice","is-edit":e($),customer:e(r).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):S("",!0),i(Q,{class:"relative invoice-create-page"},{default:c(()=>[g("form",{onSubmit:ie(L,["prevent"])},[i(J,{title:e(B)},{actions:c(()=>[i(X,{to:`/invoices/pdf/${e(r).newRecurringInvoice.unique_hash}`},{default:c(()=>[s.$route.name==="invoices.edit"?(y(),p(D,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:c(()=>[g("span",Te,k(s.$t("general.view_pdf")),1)]),_:1})):S("",!0)]),_:1},8,["to"]),i(D,{loading:e(d),disabled:e(d),variant:"primary",type:"submit"},{left:c(W=>[e(d)?S("",!0):(y(),p(Y,{key:0,name:"SaveIcon",class:ne(W.class)},null,8,["class"]))]),default:c(()=>[te(" "+k(s.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:c(()=>[i(z,null,{default:c(()=>[i(M,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),i(M,{title:s.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(y(),p(M,{key:0,title:s.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(y(),p(M,{key:1,title:e(B),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),g("div",Ne,[i(ke,{v:e(b),"is-loading":e(o),"is-edit":e($)},null,8,["v","is-loading","is-edit"])]),i(K,null,{default:c(()=>[i(ye,{currency:e(r).newRecurringInvoice.currency,"is-loading":e(o),"item-validation-scope":E,store:e(r),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),g("div",Ee,[g("div",xe,[i(be,{store:e(r),"store-prop":"newRecurringInvoice",fields:T.value,type:"Invoice"},null,8,["store","fields"]),i($e,{type:"Invoice","is-edit":e($),"is-loading":e(o),store:e(r),"store-prop":"newRecurringInvoice","custom-field-scope":E,class:"mb-6"},null,8,["is-edit","is-loading","store"]),i(Ie,{store:e(r),"store-prop":"newRecurringInvoice"},null,8,["store"])]),i(pe,{currency:e(r).newRecurringInvoice.currency,"is-loading":e(o),store:e(r),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Ue)]),_:1})],64)}}};export{wn as default};
