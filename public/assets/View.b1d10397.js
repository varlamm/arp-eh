import{v as X}from"./vue-i18n.c6de3223.js";import{j as K,u as Q,w as E,x as Y}from"./main.f5ac513d.js";import{l as Z}from"./lodash.8ab3583e.js";import{u as ee,b as te}from"./vue-router.746ec05f.js";import"./moment.9709ab41.js";import{u as ae}from"./estimate.da313ea4.js";import{u as se}from"./global.b17b6368.js";import{f as R,r as oe,i as re,a as h,e as ie,O as d,j as m,k as y,U as o,l as a,P as i,u as l,as as V,X as _,R as B,M as S,aW as le,g as ne,F as de}from"./@vue.8cc12e6e.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@vuelidate.c7422de1.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./auth.f67c9755.js";const me={class:"mr-3 text-sm"},ce={class:"mr-3 text-sm"},ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 bg-white w-88 xl:block"},pe={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},_e={class:"flex ml-3",role:"group","aria-label":"First group"},fe={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},ye={class:"px-2"},ge={class:"px-2"},be={class:"px-2"},he={class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid sw-scroll"},Be={class:"flex-2"},ve={class:"mb-1 text-md not-italic font-medium leading-5 text-gray-500 capitalize"},xe={class:"flex-1 whitespace-nowrap right"},we={class:"text-sm text-right text-gray-500 non-italic"},ke={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ee={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Ve=["src"],et={__name:"View",setup(Se){const c=ee(),F=te(),n=ae(),f=se(),I=K(),{tm:$,t:u}=X.useI18n();let v=R({}),t=R({orderBy:"",orderByField:"",estimate_number:""}),x=oe(!1);re("utils"),Q();const T=h(()=>n.selectedViewEstimate),j=h(()=>t.orderBy==="asc"||t.orderBy==null);h(()=>j.value?$("general.ascending"):$("general.descending"));const C=h(()=>v.unique_hash?`/estimates/pdf/${v.unique_hash}`:!1);ie(c,()=>{D()}),L(),D(),p=Z.exports.debounce(p,500);function z(e){return c.params.id==e}async function L(){await n.fetchEstimate({limit:"all"},f.companySlug),setTimeout(()=>{N()},500)}async function D(){if(c&&c.params.id){let e=await n.fetchViewEstimate({id:c.params.id},f.companySlug);e.data&&Object.assign(v,e.data.data)}}function N(){const e=document.getElementById(`estimate-${c.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function p(){let e={};t.estimate_number!==""&&t.estimate_number!==null&&t.estimate_number!==void 0&&(e.estimate_number=t.estimate_number),t.orderBy!==null&&t.orderBy!==void 0&&(e.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(e.orderByField=t.orderByField),x.value=!0;try{let r=await n.searchEstimate(e,f.companySlug);x.value=!1,r.data.data&&(n.estimates=r.data.data)}catch{x.value=!1}}function A(){return t.orderBy==="asc"?(t.orderBy="desc",p(),!0):(t.orderBy="asc",p(),!0)}async function P(){I.openDialog({title:u("general.are_you_sure"),message:u("estimates.confirm_mark_as_accepted",1),yesLabel:u("general.ok"),noLabel:u("general.cancel"),variant:"primary",size:"lg",hideNoButton:!1}).then(async e=>{let r={slug:f.companySlug,id:c.params.id,status:"ACCEPTED"};e&&(n.acceptEstimate(r),F.push({name:"estimates.dashboard"}))})}async function U(){I.openDialog({title:u("general.are_you_sure"),message:u("estimates.confirm_mark_as_rejected",1),yesLabel:u("general.ok"),noLabel:u("general.cancel"),variant:"primary",size:"lg",hideNoButton:!1}).then(async e=>{let r={slug:f.companySlug,id:c.params.id,status:"REJECTED"};e&&(n.rejectEstimate(r),F.push({name:"estimates.dashboard"}))})}return(e,r)=>{const g=d("BaseButton"),G=d("BasePageHeader"),b=d("BaseIcon"),M=d("BaseInput"),w=d("BaseRadio"),k=d("BaseInputGroup"),O=d("BaseEstimateStatusBadge"),q=d("BaseFormatMoney"),H=d("router-link"),J=d("BasePage");return m(),y(J,{class:"xl:pl-96"},{default:o(()=>[a(G,{title:T.value.estimate_number},{actions:o(()=>[i("div",me,[l(n).selectedViewEstimate.status==="DRAFT"?(m(),y(g,{key:0,variant:"primary",onClick:P},{default:o(()=>[V(_(e.$t("estimates.accept_estimate")),1)]),_:1})):B("",!0)]),i("div",ce,[l(n).selectedViewEstimate.status==="DRAFT"?(m(),y(g,{key:0,variant:"primary-outline",onClick:U},{default:o(()=>[V(_(e.$t("estimates.reject_estimate")),1)]),_:1})):B("",!0)])]),_:1},8,["title"]),i("div",ue,[i("div",pe,[a(M,{modelValue:l(t).estimate_number,"onUpdate:modelValue":r[0]||(r[0]=s=>l(t).estimate_number=s),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:p},{right:o(()=>[a(b,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"]),i("div",_e,[a(Y,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:o(()=>[a(g,{variant:"gray"},{default:o(()=>[a(b,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:o(()=>[i("div",fe,_(e.$t("general.sort_by")),1),i("div",ye,[a(E,{class:"rounded-md pt-3 hover:rounded-md"},{default:o(()=>[a(k,{class:"-mt-3 font-normal"},{default:o(()=>[a(w,{id:"filter_estimate_date",modelValue:l(t).orderByField,"onUpdate:modelValue":r[1]||(r[1]=s=>l(t).orderByField=s),label:e.$t("reports.estimates.estimate_date"),size:"sm",name:"filter",value:"estimate_date",onChange:p},null,8,["modelValue","label"])]),_:1})]),_:1})]),i("div",ge,[a(E,{class:"rounded-md pt-3 hover:rounded-md"},{default:o(()=>[a(k,{class:"-mt-3 font-normal"},{default:o(()=>[a(w,{id:"filter_due_date",modelValue:l(t).orderByField,"onUpdate:modelValue":[r[2]||(r[2]=s=>l(t).orderByField=s),p],label:e.$t("estimates.due_date"),value:"expiry_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),i("div",be,[a(E,{class:"rounded-md pt-3 hover:rounded-md"},{default:o(()=>[a(k,{class:"-mt-3 font-normal"},{default:o(()=>[a(w,{id:"filter_estimate_number",modelValue:l(t).orderByField,"onUpdate:modelValue":[r[3]||(r[3]=s=>l(t).orderByField=s),p],label:e.$t("estimates.estimate_number"),value:"estimate_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),a(g,{class:"ml-1",variant:"white",onClick:A},{default:o(()=>[j.value?(m(),y(b,{key:0,name:"SortAscendingIcon",class:"h-5"})):(m(),y(b,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),i("div",he,[(m(!0),S(de,null,le(l(n).estimates,(s,W)=>(m(),y(H,{id:"estimate-"+s.id,key:W,to:`/${l(f).companySlug}/customer/estimates/${s.id}/view`,class:ne(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":z(s.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[i("div",Be,[i("div",ve,_(s.estimate_number),1),a(O,{status:s.status},{default:o(()=>[V(_(s.status),1)]),_:2},1032,["status"])]),i("div",xe,[a(q,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:s.total,currency:s.currency},null,8,["amount","currency"]),i("div",we,_(s.formatted_estimate_date),1)])]),_:2},1032,["id","to","class"]))),128)),l(n).estimates.length?B("",!0):(m(),S("p",ke,_(e.$t("estimates.no_matching_estimates")),1))])]),i("div",Ee,[C.value?(m(),S("iframe",{key:0,src:C.value,class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,Ve)):B("",!0)])]),_:1})}}};export{et as default};
