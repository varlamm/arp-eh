import{r as E,f as O,a as B,e as T,o as X,O as p,j as A,k as R,U as m,P as $,as as S,X as b,u as a,l,by as H,g as J}from"./@vue.8cc12e6e.js";import{v as K}from"./vue-i18n.c6de3223.js";import{u as Q}from"./vue-router.746ec05f.js";import{c as I,r as M,m as W,d as Y}from"./@vuelidate.c7422de1.js";import{h as _,c as Z,u as ee,i as te,k as oe}from"./main.f5ac513d.js";import{a as g}from"./axios.7b768d2b.js";import{d as ae}from"./pinia.32c02ade.js";import{u as ne}from"./payment.333e3a22.js";const se=(C=!1)=>(C?window.pinia.defineStore:ae)({id:"notes",state:()=>({notes:[],currentNote:{id:null,type:"",name:"",notes:""}}),getters:{isEdit:n=>!!n.currentNote.id},actions:{resetCurrentNote(){this.currentNote={type:"",name:"",notes:""}},fetchNotes(n){return new Promise((e,u)=>{g.get("/api/v1/notes",{params:n}).then(t=>{this.notes=t.data.data,e(t)}).catch(t=>{_(t),u(t)})})},fetchNote(n){return new Promise((e,u)=>{g.get(`/api/v1/notes/${n}`).then(t=>{this.currentNote=t.data.data,e(t)}).catch(t=>{_(t),u(t)})})},addNote(n){return new Promise((e,u)=>{g.post("/api/v1/notes",n).then(t=>{this.notes.push(t.data),e(t)}).catch(t=>{_(t),u(t)})})},updateNote(n){return new Promise((e,u)=>{g.put(`/api/v1/notes/${n.id}`,n).then(t=>{if(t.data){let N=this.notes.findIndex(i=>i.id===t.data.data.id);this.notes[N]=n.notes}e(t)}).catch(t=>{_(t),u(t)})})},deleteNote(n){return new Promise((e,u)=>{g.delete(`/api/v1/notes/${n}`).then(t=>{let N=this.notes.findIndex(i=>i.id===n);this.notes.splice(N,1),e(t)}).catch(t=>{_(t),u(t)})})}}})();const re={class:"flex justify-between w-full"},ie=["onSubmit"],ue={class:"px-8 py-8 sm:p-6"},le={class:"z-0 flex justify-end px-4 py-4 border-t border-solid border-gray-light"},he={__name:"NoteModal",setup(C){const c=Z(),n=ee(),e=se(),u=te(),t=ne(),N=oe(),i=Q(),{t:v}=K.useI18n();let f=E(!1);const x=O(["Invoice","Estimate","Payment"]);let y=E(["customer","customerCustom"]);const z=B(()=>c.active&&c.componentName==="NoteModal"),k=B(()=>({currentNote:{name:{required:I.withMessage(v("validation.required"),M),minLength:I.withMessage(v("validation.name_min_length",{count:3}),W(3))},notes:{required:I.withMessage(v("validation.required"),M)},type:{required:I.withMessage(v("validation.required"),M)}}})),s=Y(k,B(()=>e));T(()=>e.currentNote.type,o=>{V()}),X(()=>{i.name==="estimates.create"?e.currentNote.type="Estimate":i.name==="invoices.create"?e.currentNote.type="Invoice":e.currentNote.type="Payment"});function V(){y.value=["customer","customerCustom"],e.currentNote.type=="Invoice"&&y.value.push("invoice","invoiceCustom"),e.currentNote.type=="Estimate"&&y.value.push("estimate","estimateCustom"),e.currentNote.type=="Payment"&&y.value.push("payment","paymentCustom")}async function D(){if(s.value.currentNote.$touch(),s.value.currentNote.$invalid)return!0;if(f.value=!0,e.isEdit){let o={id:e.currentNote.id,...e.currentNote};await e.updateNote(o).then(r=>{f.value=!1,r.data&&(n.showNotification({type:"success",message:v("settings.customization.notes.note_updated")}),c.refreshData&&c.refreshData(),h())}).catch(r=>{f.value=!1})}else await e.addNote(e.currentNote).then(o=>{f.value=!1,o.data&&(n.showNotification({type:"success",message:v("settings.customization.notes.note_added")}),(i.name==="invoices.create"&&o.data.data.type==="Invoice"||i.name==="invoices.edit"&&o.data.data.type==="Invoice")&&u.selectNote(o.data.data),(i.name==="estimates.create"&&o.data.data.type==="Estimate"||i.name==="estimates.edit"&&o.data.data.type==="Estimate")&&N.selectNote(o.data.data),(i.name==="payments.create"&&o.data.data.type==="Payment"||i.name==="payments.edit"&&o.data.data.type==="Payment")&&t.selectNote(o.data.data)),c.refreshData&&c.refreshData(),h()}).catch(o=>{f.value=!1})}function h(){c.closeModal(),setTimeout(()=>{e.resetCurrentNote(),s.value.$reset()},300)}return(o,r)=>{const P=p("BaseIcon"),j=p("BaseInput"),w=p("BaseInputGroup"),G=p("BaseMultiselect"),U=p("BaseCustomInput"),F=p("BaseInputGrid"),q=p("BaseButton"),L=p("BaseModal");return A(),R(L,{show:z.value,onClose:h,onOpen:V},{header:m(()=>[$("div",re,[S(b(a(c).title)+" ",1),l(P,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:h})])]),default:m(()=>[$("form",{action:"",onSubmit:H(D,["prevent"])},[$("div",ue,[l(F,{layout:"one-column"},{default:m(()=>[l(w,{label:o.$t("settings.customization.notes.name"),variant:"vertical",error:a(s).currentNote.name.$error&&a(s).currentNote.name.$errors[0].$message,required:""},{default:m(()=>[l(j,{modelValue:a(e).currentNote.name,"onUpdate:modelValue":r[0]||(r[0]=d=>a(e).currentNote.name=d),invalid:a(s).currentNote.name.$error,type:"text",onInput:r[1]||(r[1]=d=>a(s).currentNote.name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),l(w,{label:o.$t("settings.customization.notes.type"),error:a(s).currentNote.type.$error&&a(s).currentNote.type.$errors[0].$message,required:""},{default:m(()=>[l(G,{modelValue:a(e).currentNote.type,"onUpdate:modelValue":r[2]||(r[2]=d=>a(e).currentNote.type=d),options:x,"value-prop":"type",class:"mt-2"},null,8,["modelValue","options"])]),_:1},8,["label","error"]),l(w,{label:o.$t("settings.customization.notes.notes"),error:a(s).currentNote.notes.$error&&a(s).currentNote.notes.$errors[0].$message,required:""},{default:m(()=>[l(U,{modelValue:a(e).currentNote.notes,"onUpdate:modelValue":r[3]||(r[3]=d=>a(e).currentNote.notes=d),invalid:a(s).currentNote.notes.$error,fields:a(y),onInput:r[4]||(r[4]=d=>a(s).currentNote.notes.$touch())},null,8,["modelValue","invalid","fields"])]),_:1},8,["label","error"])]),_:1})]),$("div",le,[l(q,{class:"mr-2",variant:"primary-outline",type:"button",onClick:h},{default:m(()=>[S(b(o.$t("general.cancel")),1)]),_:1}),l(q,{loading:a(f),disabled:a(f),variant:"primary",type:"submit"},{left:m(d=>[l(P,{name:"SaveIcon",class:J(d.class)},null,8,["class"])]),default:m(()=>[S(" "+b(a(e).isEdit?o.$t("general.update"):o.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,ie)]),_:1},8,["show"])}}};export{he as _,se as u};
