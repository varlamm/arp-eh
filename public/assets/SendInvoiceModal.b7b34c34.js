import{c as X,b as H,u as J,i as K}from"./main.f5ac513d.js";import{v as Q}from"./vue-i18n.c6de3223.js";import{c as p,r as w,e as N,d as W}from"./@vuelidate.c7422de1.js";import{u as Y}from"./mail-driver.f62a08cc.js";import{r as B,f as Z,a as h,O as c,j as _,k as V,U as n,P as v,as as f,X as $,l as a,M as U,u as e,g as ee,R as x}from"./@vue.8cc12e6e.js";const oe={class:"flex justify-between w-full"},te={key:0,action:""},ae={class:"px-8 py-8 sm:p-6"},re={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},se={key:1},le={class:"my-6 mx-4 border border-gray-200 relative"},ne=["src"],ie={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},fe={__name:"SendInvoiceModal",emits:["update"],setup(ue,{emit:P}){const u=X(),j=H(),D=J(),k=K();Y();const{t:d}=Q.useI18n();let i=B(!1);const C=B(""),b=B(!1),G=B(["customer","customerCustom","invoice","invoiceCustom","company"]),r=Z({id:null,from:null,to:null,subject:"New Invoice",body:null}),R=h(()=>u.active&&u.componentName==="SendInvoiceModal"),z=h(()=>u.title),S=h(()=>u.data),F={from:{required:p.withMessage(d("validation.required"),w),email:p.withMessage(d("validation.email_incorrect"),N)},to:{required:p.withMessage(d("validation.required"),w),email:p.withMessage(d("validation.email_incorrect"),N)},subject:{required:p.withMessage(d("validation.required"),w)},body:{required:p.withMessage(d("validation.required"),w)}},t=W(F,h(()=>r));function L(){b.value=!1}async function O(){let s=await j.fetchBasicMailConfig();r.id=u.id,s.data&&(r.from=s.data.from_mail),S.value&&(r.to=S.value.customer.email),r.body=j.selectedCompanySettings.invoice_mail_body}async function q(){if(t.value.$touch(),t.value.$invalid)return!0;try{if(i.value=!0,!b.value){const m=await k.previewInvoice(r);i.value=!1,b.value=!0;var s=new Blob([m.data],{type:"text/html"});C.value=URL.createObjectURL(s);return}const o=await k.sendInvoice(r);if(i.value=!1,o.data.success)return P("update",u.id),y(),!0}catch(o){console.error(o),i.value=!1,D.showNotification({type:"error",message:d("invoices.something_went_wrong")})}}function y(){u.closeModal(),setTimeout(()=>{t.value.$reset(),b.value=!1,C.value=null},300)}return(s,o)=>{const m=c("BaseIcon"),M=c("BaseInput"),I=c("BaseInputGroup"),T=c("BaseCustomInput"),A=c("BaseInputGrid"),g=c("BaseButton"),E=c("BaseModal");return _(),V(E,{show:R.value,onClose:y,onOpen:O},{header:n(()=>[v("div",oe,[f($(z.value)+" ",1),a(m,{name:"XIcon",class:"w-6 h-6 text-gray-500 cursor-pointer",onClick:y})])]),default:n(()=>[b.value?(_(),U("div",se,[v("div",le,[a(g,{class:"absolute top-4 right-4",disabled:e(i),variant:"primary-outline",onClick:L},{default:n(()=>[a(m,{name:"PencilIcon",class:"h-5 mr-2"}),f(" Edit ")]),_:1},8,["disabled"]),v("iframe",{src:C.value,frameborder:"0",class:"w-full",style:{"min-height":"500px"}},null,8,ne)]),v("div",ie,[a(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:n(()=>[f($(s.$t("general.cancel")),1)]),_:1}),a(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",onClick:o[7]||(o[7]=l=>q())},{default:n(()=>[e(i)?x("",!0):(_(),V(m,{key:0,name:"PaperAirplaneIcon",class:"h-5 mr-2"})),f(" "+$(s.$t("general.send")),1)]),_:1},8,["loading","disabled"])])])):(_(),U("form",te,[v("div",ae,[a(A,{layout:"one-column",class:"col-span-7"},{default:n(()=>[a(I,{label:s.$t("general.from"),required:"",error:e(t).from.$error&&e(t).from.$errors[0].$message},{default:n(()=>[a(M,{modelValue:r.from,"onUpdate:modelValue":o[0]||(o[0]=l=>r.from=l),type:"text",invalid:e(t).from.$error,onInput:o[1]||(o[1]=l=>e(t).from.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(I,{label:s.$t("general.to"),required:"",error:e(t).to.$error&&e(t).to.$errors[0].$message},{default:n(()=>[a(M,{modelValue:r.to,"onUpdate:modelValue":o[2]||(o[2]=l=>r.to=l),type:"text",invalid:e(t).to.$error,onInput:o[3]||(o[3]=l=>e(t).to.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(I,{error:e(t).subject.$error&&e(t).subject.$errors[0].$message,label:s.$t("general.subject"),required:""},{default:n(()=>[a(M,{modelValue:r.subject,"onUpdate:modelValue":o[4]||(o[4]=l=>r.subject=l),type:"text",invalid:e(t).subject.$error,onInput:o[5]||(o[5]=l=>e(t).subject.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["error","label"]),a(I,{label:s.$t("general.body"),error:e(t).body.$error&&e(t).body.$errors[0].$message,required:""},{default:n(()=>[a(T,{modelValue:r.body,"onUpdate:modelValue":o[6]||(o[6]=l=>r.body=l),fields:G.value},null,8,["modelValue","fields"])]),_:1},8,["label","error"])]),_:1})]),v("div",re,[a(g,{class:"mr-3",variant:"primary-outline",type:"button",onClick:y},{default:n(()=>[f($(s.$t("general.cancel")),1)]),_:1}),a(g,{loading:e(i),disabled:e(i),variant:"primary",type:"button",class:"mr-3",onClick:q},{left:n(l=>[e(i)?x("",!0):(_(),V(m,{key:0,class:ee(l.class),name:"PhotographIcon"},null,8,["class"]))]),default:n(()=>[f(" "+$(s.$t("general.preview")),1)]),_:1},8,["loading","disabled"])])]))]),_:1},8,["show"])}}};export{fe as _};
