import{r as $,a as u,O as r,j as y,k as V,U as s,l as a,P as C,u as t,as as U,X as P,R as k,g as Q,by as Z}from"./@vue.8cc12e6e.js";import{u as ee,b as te}from"./vue-router.746ec05f.js";import{v as ne}from"./vue-i18n.c6de3223.js";import{d as ae,c as S,r as oe,m as re,b as se}from"./@vuelidate.c7422de1.js";import{p as ie,q as le,c as me,b as ue,e as ce,g as de}from"./main.f5ac513d.js";import{_ as pe}from"./ItemUnitModal.cd06db8c.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";const _e=["onSubmit"],Le={__name:"Create",setup(ge){const n=ie(),h=le(),f=me(),N=ue(),{t:c}=ne.useI18n(),v=ee(),q=te(),E=ce(),p=$(!1),B=$(N.selectedCompanySettings.tax_per_item);let i=$(!1);n.$reset(),j();const b=u({get:()=>n.currentItem.price/100,set:e=>{n.currentItem.price=Math.round(e*100)}}),T=u({get:()=>n?.currentItem?.taxes?.map(e=>{if(e)return{...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}}),set:e=>{n.currentItem.taxes=e}}),g=u(()=>v.name==="items.edit"),x=u(()=>g.value?c("items.edit_item"):c("items.new_item")),z=u(()=>h.taxTypes.map(e=>({...e,tax_type_id:e.id,tax_name:e.name+" ("+e.percent+"%)"}))),A=u(()=>B.value==="YES"),G=u(()=>({currentItem:{name:{required:S.withMessage(c("validation.required"),oe),minLength:S.withMessage(c("validation.name_min_length",{count:3}),re(3))},description:{maxLength:S.withMessage(c("validation.description_maxlength"),se(65e3))}}})),m=ae(G,n);async function L(){f.openModal({title:c("settings.customization.items.add_item_unit"),componentName:"ItemUnitModal",size:"sm"})}async function j(){if(i.value=!0,await n.fetchItemUnits({limit:"all"}),E.hasAbilities(de.VIEW_TAX_TYPE)&&await h.fetchTaxTypes({limit:"all"}),g.value){let e=v.params.id;await n.fetchItem(e),n.currentItem.tax_per_item===1?B.value="YES":B.value="NO"}i.value=!1}async function D(){if(m.value.currentItem.$touch(),m.value.currentItem.$invalid)return!1;p.value=!0;try{let o={id:v.params.id,...n.currentItem};n.currentItem&&n.currentItem.taxes&&(o.taxes=n.currentItem.taxes.map(d=>({tax_type_id:d.tax_type_id,amount:b.value*d.percent,percent:d.percent,name:d.name,collective_tax:0}))),await(g.value?n.updateItem:n.addItem)(o),p.value=!1,q.push("/admin/items"),e()}catch{p.value=!1;return}function e(){f.closeModal(),setTimeout(()=>{n.resetCurrentItem(),f.$reset(),m.value.$reset()},300)}}return(e,o)=>{const I=r("BaseBreadcrumbItem"),d=r("BaseBreadcrumb"),R=r("BasePageHeader"),Y=r("BaseInput"),_=r("BaseInputGroup"),H=r("BaseMoney"),w=r("BaseIcon"),O=r("BaseSelectAction"),M=r("BaseMultiselect"),X=r("BaseTextarea"),F=r("BaseButton"),W=r("BaseInputGrid"),J=r("BaseCard"),K=r("BasePage");return y(),V(K,null,{default:s(()=>[a(R,{title:x.value},{default:s(()=>[a(d,null,{default:s(()=>[a(I,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),a(I,{title:e.$tc("items.item",2),to:"/admin/items"},null,8,["title"]),a(I,{title:x.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),a(pe),C("form",{class:"grid lg:grid-cols-2 mt-6",action:"submit",onSubmit:Z(D,["prevent"])},[a(J,{class:"w-full"},{default:s(()=>[a(W,{layout:"one-column"},{default:s(()=>[a(_,{label:e.$t("items.name"),"content-loading":t(i),required:"",error:t(m).currentItem.name.$error&&t(m).currentItem.name.$errors[0].$message},{default:s(()=>[a(Y,{modelValue:t(n).currentItem.name,"onUpdate:modelValue":o[0]||(o[0]=l=>t(n).currentItem.name=l),"content-loading":t(i),invalid:t(m).currentItem.name.$error,onInput:o[1]||(o[1]=l=>t(m).currentItem.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),a(_,{label:e.$t("items.price"),"content-loading":t(i)},{default:s(()=>[a(H,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=l=>b.value=l),"content-loading":t(i)},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(_,{"content-loading":t(i),label:e.$t("items.unit")},{default:s(()=>[a(M,{modelValue:t(n).currentItem.unit_id,"onUpdate:modelValue":o[3]||(o[3]=l=>t(n).currentItem.unit_id=l),"content-loading":t(i),label:"name",options:t(n).itemUnits,"value-prop":"id",placeholder:e.$t("items.select_a_unit"),searchable:"","track-by":"name"},{action:s(()=>[a(O,{onClick:L},{default:s(()=>[a(w,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),U(" "+P(e.$t("settings.customization.items.add_item_unit")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),A.value?(y(),V(_,{key:0,label:e.$t("items.taxes"),"content-loading":t(i)},{default:s(()=>[a(M,{modelValue:T.value,"onUpdate:modelValue":o[4]||(o[4]=l=>T.value=l),"content-loading":t(i),options:z.value,mode:"tags",label:"tax_name",class:"w-full","value-prop":"id","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","content-loading","options"])]),_:1},8,["label","content-loading"])):k("",!0),a(_,{label:e.$t("items.description"),"content-loading":t(i),error:t(m).currentItem.description.$error&&t(m).currentItem.description.$errors[0].$message},{default:s(()=>[a(X,{modelValue:t(n).currentItem.description,"onUpdate:modelValue":o[5]||(o[5]=l=>t(n).currentItem.description=l),"content-loading":t(i),name:"description",row:2,rows:"2",onInput:o[6]||(o[6]=l=>t(m).currentItem.description.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),C("div",null,[a(F,{"content-loading":t(i),type:"submit",loading:p.value},{left:s(l=>[p.value?k("",!0):(y(),V(w,{key:0,name:"SaveIcon",class:Q(l.class)},null,8,["class"]))]),default:s(()=>[U(" "+P(g.value?e.$t("items.update_item"):e.$t("items.save_item")),1)]),_:1},8,["content-loading","loading"])])]),_:1})]),_:1})],40,_e)]),_:1})}}};export{Le as default};
