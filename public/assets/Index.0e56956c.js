import{r as b,f as ve,a as k,b as fe,O as l,j as I,k as B,U as s,l as a,L as R,bx as V,u as i,g as $,as as m,X as _,R as q,aq as M,P as f}from"./@vue.8cc12e6e.js";import{b as ge}from"./vue-router.746ec05f.js";import{v as be}from"./vue-i18n.c6de3223.js";import{t as Ie,l as Be,j as ye,u as he,e as Ce,g as y}from"./main.f5ac513d.js";import{_ as ke}from"./SendInvoiceModal.b7b34c34.js";import{_ as Re}from"./RecurringInvoiceIndexDropdown.58239022.js";import{_ as Ve}from"./MoonwalkerIcon.02070a25.js";import{d as $e}from"./@vueuse.b6c5a1c1.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./mail-driver.f62a08cc.js";const Ee=f("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1),Ne={class:"relative table-container"},Ae={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},Se={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Te={class:"absolute items-center left-6 top-2.5 select-none"},xe={class:"relative block"},it={__name:"Index",setup(we){const c=Ie();Be();const H=ye(),x=he(),E=Ce(),h=b(null),{t:r}=be.useI18n(),g=b(!1),w=b(["ACTIVE","ON_HOLD","ALL"]),N=b(!0),p=b("recurring-invoices.all");ge();let n=ve({customer_id:"",status:"",from_date:"",to_date:""});const D=k(()=>!c.totalRecurringInvoices&&!N.value),L=k({get:()=>c.selectedRecurringInvoices,set:e=>c.selectRecurringInvoice(e)}),j=k(()=>[{key:"checkbox",thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"starts_at",label:r("recurring_invoices.starts_at"),thClass:"extra",tdClass:"font-medium"},{key:"customer",label:r("invoices.customer")},{key:"frequency",label:r("recurring_invoices.frequency.title")},{key:"status",label:r("invoices.status")},{key:"total",label:r("invoices.total")},{key:"actions",label:r("recurring_invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);$e(n,()=>{Q()},{debounce:500}),fe(()=>{c.selectAllField&&c.selectAllRecurringInvoices()});const W=k(()=>w.value.findIndex(e=>e===n.status));function z(){return E.hasAbilities([y.DELETE_RECURRING_INVOICE,y.EDIT_RECURRING_INVOICE,y.VIEW_RECURRING_INVOICE])}function X(e){const o=c.frequencies.find(u=>u.value===e);return o?o.label:`CUSTOM: ${e}`}function A(){h.value&&h.value.refresh()}async function J({page:e,filter:o,sort:u}){let v={customer_id:n.customer_id,status:n.status,from_date:n.from_date,to_date:n.to_date,orderByField:u.fieldName||"created_at",orderBy:u.order||"desc",page:e};N.value=!0;let d=await c.fetchRecurringInvoices(v);return N.value=!1,{data:d.data.data,pagination:{totalPages:d.data.meta.last_page,currentPage:e,totalCount:d.data.meta.total,limit:10}}}function K(e){if(p.value==e.title)return!0;switch(p.value=e.title,e.title){case r("recurring_invoices.active"):n.status="ACTIVE";break;case r("recurring_invoices.on_hold"):n.status="ON_HOLD";break;case r("recurring_invoices.all"):n.status="ALL";break}}function Q(){c.$patch(e=>{e.selectedRecurringInvoices=[],e.selectAllField=!1}),A()}function O(){n.customer_id="",n.status="",n.from_date="",n.to_date="",n.invoice_number="",p.value=r("general.all")}async function Y(e=null){H.openDialog({title:r("general.are_you_sure"),message:r("invoices.confirm_delete"),yesLabel:r("general.ok"),noLabel:r("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async o=>{o&&await c.deleteMultipleRecurringInvoices(e).then(u=>{u.data.success?(A(),c.$patch(v=>{v.selectedRecurringInvoices=[],v.selectAllField=!1}),x.showNotification({type:"success",message:r("recurring_invoices.deleted_message",2)})):u.data.error&&x.showNotification({type:"error",message:u.data.message})})})}function Z(){g.value&&O(),g.value=!g.value}async function ee(e,o){n.status="",A()}function te(e){switch(e){case"ACTIVE":p.value=r("recurring_invoices.active");break;case"ON_HOLD":p.value=r("recurring_invoices.on_hold");break;case"ALL":p.value=r("recurring_invoices.all");break}}return(e,o)=>{const u=l("BaseBreadcrumbItem"),v=l("BaseBreadcrumb"),d=l("BaseIcon"),S=l("BaseButton"),F=l("router-link"),ae=l("BasePageHeader"),se=l("BaseCustomerSelectInput"),C=l("BaseInputGroup"),oe=l("BaseMultiselect"),U=l("BaseDatePicker"),ne=l("BaseFilterWrapper"),le=l("BaseEmptyPlaceholder"),T=l("BaseTab"),re=l("BaseTabGroup"),ie=l("BaseDropdownItem"),ce=l("BaseDropdown"),P=l("BaseCheckbox"),G=l("BaseText"),ue=l("BaseRecurringInvoiceStatusBadge"),de=l("BaseFormatMoney"),me=l("BaseTable"),_e=l("BasePage");return I(),B(_e,null,{default:s(()=>[a(ke),a(ae,{title:e.$t("recurring_invoices.title")},{actions:s(()=>[R(a(S,{variant:"primary-outline",onClick:Z},{right:s(t=>[g.value?(I(),B(d,{key:1,name:"XIcon",class:$(t.class)},null,8,["class"])):(I(),B(d,{key:0,name:"FilterIcon",class:$(t.class)},null,8,["class"]))]),default:s(()=>[m(_(e.$t("general.filter"))+" ",1)]),_:1},512),[[V,i(c).totalRecurringInvoices]]),i(E).hasAbilities(i(y).CREATE_RECURRING_INVOICE)?(I(),B(F,{key:0,to:"recurring-invoices/create"},{default:s(()=>[a(S,{variant:"primary",class:"ml-4"},{left:s(t=>[a(d,{name:"PlusIcon",class:$(t.class)},null,8,["class"])]),default:s(()=>[m(" "+_(e.$t("recurring_invoices.new_invoice")),1)]),_:1})]),_:1})):q("",!0)]),default:s(()=>[a(v,null,{default:s(()=>[a(u,{title:e.$t("general.home"),to:"dashboard"},null,8,["title"]),a(u,{title:e.$tc("recurring_invoices.invoice",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),R(a(ne,{onClear:O},{default:s(()=>[a(C,{label:e.$tc("customers.customer",1)},{default:s(()=>[a(se,{modelValue:i(n).customer_id,"onUpdate:modelValue":o[0]||(o[0]=t=>i(n).customer_id=t),placeholder:e.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(C,{label:e.$t("recurring_invoices.status")},{default:s(()=>[a(oe,{modelValue:i(n).status,"onUpdate:modelValue":[o[1]||(o[1]=t=>i(n).status=t),te],options:w.value,searchable:"",placeholder:e.$t("general.select_a_status"),onRemove:o[2]||(o[2]=t=>ee())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(C,{label:e.$t("general.from")},{default:s(()=>[a(U,{modelValue:i(n).from_date,"onUpdate:modelValue":o[3]||(o[3]=t=>i(n).from_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),Ee,a(C,{label:e.$t("general.to")},{default:s(()=>[a(U,{modelValue:i(n).to_date,"onUpdate:modelValue":o[4]||(o[4]=t=>i(n).to_date=t),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[V,g.value]]),R(a(le,{title:e.$t("recurring_invoices.no_invoices"),description:e.$t("recurring_invoices.list_of_invoices")},M({default:s(()=>[a(Ve,{class:"mt-5 mb-4"})]),_:2},[i(E).hasAbilities(i(y).CREATE_RECURRING_INVOICE)?{name:"actions",fn:s(()=>[a(S,{variant:"primary-outline",onClick:o[5]||(o[5]=t=>e.$router.push("/admin/recurring-invoices/create"))},{left:s(t=>[a(d,{name:"PlusIcon",class:$(t.class)},null,8,["class"])]),default:s(()=>[m(" "+_(e.$t("recurring_invoices.add_new_invoice")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"]),[[V,D.value]]),R(f("div",Ne,[f("div",Ae,[a(re,{class:"-mb-5","default-index":W.value,onChange:K},{default:s(()=>[a(T,{title:e.$t("recurring_invoices.all"),filter:"ALL"},null,8,["title"]),a(T,{title:e.$t("recurring_invoices.active"),filter:"ACTIVE"},null,8,["title"]),a(T,{title:e.$t("recurring_invoices.on_hold"),filter:"ON_HOLD"},null,8,["title"])]),_:1},8,["default-index"]),i(c).selectedRecurringInvoices.length?(I(),B(ce,{key:0,class:"absolute float-right"},{activator:s(()=>[f("span",Se,[m(_(e.$t("general.actions"))+" ",1),a(d,{name:"ChevronDownIcon",class:"h-5"})])]),default:s(()=>[a(ie,{onClick:o[6]||(o[6]=t=>Y())},{default:s(()=>[a(d,{name:"TrashIcon",class:"mr-3 text-gray-600"}),m(" "+_(e.$t("general.delete")),1)]),_:1})]),_:1})):q("",!0)]),a(me,{ref_key:"table",ref:h,data:J,columns:j.value,"placeholder-count":i(c).totalRecurringInvoices>=20?10:5,class:"mt-10"},M({header:s(()=>[f("div",Te,[a(P,{modelValue:i(c).selectAllField,"onUpdate:modelValue":o[7]||(o[7]=t=>i(c).selectAllField=t),variant:"primary",onChange:i(c).selectAllRecurringInvoices},null,8,["modelValue","onChange"])])]),"cell-checkbox":s(({row:t})=>[f("div",xe,[a(P,{id:t.id,modelValue:L.value,"onUpdate:modelValue":o[8]||(o[8]=pe=>L.value=pe),value:t.data.id},null,8,["id","modelValue","value"])])]),"cell-starts_at":s(({row:t})=>[m(_(t.data.formatted_starts_at),1)]),"cell-customer":s(({row:t})=>[a(F,{to:{path:`recurring-invoices/${t.data.id}/view`}},{default:s(()=>[a(G,{text:t.data.customer.name,length:30,tag:"span",class:"font-medium text-primary-500 flex flex-col"},null,8,["text"]),a(G,{text:t.data.customer.contact_name?t.data.customer.contact_name:"",length:30,tag:"span",class:"text-xs text-gray-400"},null,8,["text"])]),_:2},1032,["to"])]),"cell-frequency":s(({row:t})=>[m(_(X(t.data.frequency)),1)]),"cell-status":s(({row:t})=>[a(ue,{status:t.data.status,class:"px-3 py-1"},{default:s(()=>[m(_(t.data.status),1)]),_:2},1032,["status"])]),"cell-total":s(({row:t})=>[a(de,{amount:t.data.total,currency:t.data.customer.currency},null,8,["amount","currency"])]),_:2},[z?{name:"cell-actions",fn:s(({row:t})=>[a(Re,{row:t.data,table:h.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[V,!D.value]])]),_:1})}}};export{it as default};
