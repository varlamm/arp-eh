import{v as ee}from"./vue-i18n.c6de3223.js";import{l as te}from"./lodash.8ab3583e.js";import{u as ae}from"./vue-router.746ec05f.js";import{h as oe}from"./moment.9709ab41.js";import{c as re,e as se,j as ne,g as le}from"./main.f5ac513d.js";import{u as ie}from"./payment.333e3a22.js";import{_ as de,a as ce}from"./SendPaymentModal.5fa3a6e9.js";import{L as me}from"./LoadingIcon.f4bad6f3.js";import{f as U,r as _,a as B,e as ue,O as l,j as d,M as g,l as a,U as r,u as s,k as I,as as pe,X as v,R as x,P as n,F as C,aW as fe,g as ye}from"./@vue.8cc12e6e.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@vuelidate.c7422de1.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./mail-driver.f62a08cc.js";const _e={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},ge={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},ve={class:"flex ml-3",role:"group","aria-label":"First group"},he={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},be={class:"px-2"},Be={class:"px-2"},xe={class:"px-2"},ke={class:"flex-2"},we={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Fe={class:"mb-1 text-xs not-italic font-medium leading-5 text-gray-500 capitalize"},Ie={class:"flex-1 whitespace-nowrap right"},Ve={class:"text-sm text-right text-gray-500 non-italic"},Pe={key:0,class:"flex justify-center p-4 items-center"},Se={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Te={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},De=["src"],nt={__name:"View",setup($e){const y=ae(),{t:V}=ee.useI18n();let p=U({}),t=U({orderBy:null,orderByField:null,searchText:null}),h=_(!1),k=_(!1);const P=ie(),E=re(),Y=se(),c=_(null),b=_(1),S=_(1),j=_(null),A=B(()=>p.payment_number||""),M=B(()=>t.orderBy==="asc"||t.orderBy==null);B(()=>M.value?V("general.ascending"):V("general.descending"));const z=B(()=>p.unique_hash?`/payments/pdf/${p.unique_hash}`:!1);B(()=>oe(P?.selectedPayment?.payment_date).format("YYYY/MM/DD")),ue(y,()=>{N()}),w(),N(),u=te.exports.debounce(u,500);function H(e){return y.params.id==e}ne();async function w(e,i=!1){if(h.value)return;let m={};t.searchText!==""&&t.searchText!==null&&t.searchText!==void 0&&(m.search=t.searchText),t.orderBy!==null&&t.orderBy!==void 0&&(m.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(m.orderByField=t.orderByField),h.value=!0;let F=await P.fetchPayments({page:e,...m});h.value=!1,c.value=c.value?c.value:[],c.value=[...c.value,...F.data.data],b.value=e||1,S.value=F.data.meta.last_page;let f=c.value.find(T=>T.id==y.params.id);i==!1&&!f&&b.value<S.value&&Object.keys(m).length===0&&w(++b.value),f&&setTimeout(()=>{i==!1&&O()},500)}async function N(){if(!y.params.id)return;k.value=!0;let e=await P.fetchPayment(y.params.id);e.data&&(k.value=!1,Object.assign(p,e.data.data))}function O(){const e=document.getElementById(`payment-${y.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"),R())}function R(){j.value.addEventListener("scroll",e=>{e.target.scrollTop>0&&e.target.scrollTop+e.target.clientHeight>e.target.scrollHeight-200&&b.value<S.value&&w(++b.value,!0)})}async function u(){c.value=[],w()}function q(){return t.orderBy==="asc"?(t.orderBy="desc",u(),!0):(t.orderBy="asc",u(),!0)}async function G(){E.openModal({title:V("payments.send_payment"),componentName:"SendPaymentModal",id:p.id,data:p,variant:"lg"})}return(e,i)=>{const m=l("BaseButton"),F=l("BasePageHeader"),f=l("BaseIcon"),T=l("BaseInput"),D=l("BaseRadio"),$=l("BaseInputGroup"),L=l("BaseDropdownItem"),W=l("BaseDropdown"),X=l("BaseText"),J=l("BaseFormatMoney"),K=l("router-link"),Q=l("BasePage");return d(),g(C,null,[a(de),a(Q,{class:"xl:pl-96"},{default:r(()=>[a(F,{title:A.value},{actions:r(()=>[s(Y).hasAbilities(s(le).SEND_PAYMENT)?(d(),I(m,{key:0,"content-loading":s(k),variant:"primary",onClick:G},{default:r(()=>[pe(v(e.$t("payments.send_payment_receipt")),1)]),_:1},8,["content-loading"])):x("",!0),a(ce,{"content-loading":s(k),class:"ml-3",row:s(p)},null,8,["content-loading","row"])]),_:1},8,["title"]),n("div",_e,[n("div",ge,[a(T,{modelValue:s(t).searchText,"onUpdate:modelValue":i[0]||(i[0]=o=>s(t).searchText=o),placeholder:e.$t("general.search"),type:"text",onInput:u},{default:r(()=>[a(f,{name:"SearchIcon",class:"h-5"})]),_:1},8,["modelValue","placeholder"]),n("div",ve,[a(W,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:r(()=>[a(m,{variant:"gray"},{default:r(()=>[a(f,{name:"FilterIcon"})]),_:1})]),default:r(()=>[n("div",he,v(e.$t("general.sort_by")),1),n("div",be,[a(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[a($,{class:"-mt-3 font-normal"},{default:r(()=>[a(D,{id:"filter_invoice_number",modelValue:s(t).orderByField,"onUpdate:modelValue":[i[1]||(i[1]=o=>s(t).orderByField=o),u],label:e.$t("invoices.title"),size:"sm",name:"filter",value:"invoice_number"},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",Be,[a(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[a($,{class:"-mt-3 font-normal"},{default:r(()=>[a(D,{modelValue:s(t).orderByField,"onUpdate:modelValue":[i[2]||(i[2]=o=>s(t).orderByField=o),u],label:e.$t("payments.date"),size:"sm",name:"filter",value:"payment_date"},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",xe,[a(L,{class:"pt-3 rounded-md hover:rounded-md"},{default:r(()=>[a($,{class:"-mt-3 font-normal"},{default:r(()=>[a(D,{id:"filter_payment_number",modelValue:s(t).orderByField,"onUpdate:modelValue":[i[3]||(i[3]=o=>s(t).orderByField=o),u],label:e.$t("payments.payment_number"),size:"sm",name:"filter",value:"payment_number"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),a(m,{class:"ml-1",size:"md",variant:"gray",onClick:q},{default:r(()=>[M.value?(d(),I(f,{key:0,name:"SortAscendingIcon"})):(d(),I(f,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),n("div",{ref_key:"paymentListSection",ref:j,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid"},[(d(!0),g(C,null,fe(c.value,(o,Z)=>(d(),g("div",{key:Z},[o?(d(),I(K,{key:0,id:"payment-"+o.id,to:`/admin/payments/${o.id}/view`,class:ye(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":H(o.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:r(()=>[n("div",ke,[a(X,{text:o?.customer?.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),n("div",we,v(o?.payment_number),1),n("div",Fe,v(o?.invoice_number),1)]),n("div",Ie,[a(J,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:o?.amount,currency:o.customer?.currency},null,8,["amount","currency"]),n("div",Ve,v(o.formatted_payment_date),1)])]),_:2},1032,["id","to","class"])):x("",!0)]))),128)),s(h)?(d(),g("div",Pe,[a(me,{class:"h-6 m-1 animate-spin text-primary-400"})])):x("",!0),!c.value?.length&&!s(h)?(d(),g("p",Se,v(e.$t("payments.no_matching_payments")),1)):x("",!0)],512)]),n("div",Te,[z.value?(d(),g("iframe",{key:0,src:z.value,class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,De)):x("",!0)])]),_:1})],64)}}};export{nt as default};
