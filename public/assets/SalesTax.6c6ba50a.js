import{q as Q,c as R,e as oe,b as Z,p as pe,g as ne,T as $e,k as we,u as Se,d as Ie}from"./main.f5ac513d.js";import{d as Be}from"./vuedraggable.e15681bc.js";import{u as Te}from"./vue-router.746ec05f.js";import{v as X}from"./vue-i18n.c6de3223.js";import{G as ye}from"./guid.7b3dea7e.js";import{r as G,f as fe,i as re,a as S,e as ae,O as f,j as r,M as b,P as o,X as h,l as a,aq as ke,u as m,U as c,as as j,k as P,R as L,F as J,aW as K,w as Pe,g as W,bh as Ce,o as xe,by as _e}from"./@vue.8cc12e6e.js";import{l as Y}from"./lodash.8ab3583e.js";import{c as U,r as F,i as me,b as ee,h as Me,d as le,m as De}from"./@vuelidate.c7422de1.js";import{D as Ve}from"./DragIcon.20becf7b.js";import"./axios.7b768d2b.js";import"./moment.9709ab41.js";import{j as je,W as qe,y as Ae}from"./@headlessui.4523e0e1.js";import{_ as Ee}from"./SelectNotePopup.9871fb7b.js";const Le={class:"flex items-center justify-between mb-3"},Ue={class:"flex items-center text-base",style:{flex:"4"}},Oe={class:"pr-2 mb-0",align:"right"},ze={class:"absolute left-3.5"},Ne={class:"ml-2 text-sm leading-none cursor-pointer text-primary-400"},Fe=o("br",null,null,-1),We={class:"text-sm text-right",style:{flex:"3"}},Ge={class:"flex items-center justify-center w-6 h-10 mx-2 cursor-pointer"},Ye={__name:"CreateItemRowTax",props:{ability:{type:String,default:""},store:{type:Object,default:null},storeProp:{type:String,default:""},itemIndex:{type:Number,required:!0},index:{type:Number,required:!0},taxData:{type:Object,required:!0},taxes:{type:Array,default:[]},total:{type:Number,default:0},totalTax:{type:Number,default:0},discountedTotal:{type:Number,default:0},currency:{type:[Object,String],required:!0},updateItems:{type:Function,default:()=>{}}},emits:["remove","update"],setup(s,{emit:e}){const t=s,n=Q(),w=R(),$=oe(),I=G(null),_=fe({...t.taxData});re("utils");const{t:C}=X.useI18n(),y=S(()=>n.taxTypes.map(u=>({...u})).map(u=>(t.taxes.find(g=>g.tax_type_id===u.id)?u.disabled=!0:u.disabled=!1,u))),M=S(()=>_.compound_tax&&t.discountedTotal?(t.discountedTotal+t.totalTax)*_.percent/100:t.discountedTotal&&_.percent?t.discountedTotal*_.percent/100:0);ae(()=>t.discountedTotal,()=>{B()}),ae(()=>t.totalTax,()=>{B()}),t.taxData.tax_type_id>0&&(I.value=n.taxTypes.find(p=>p.id===t.taxData.tax_type_id)),B();function V(p){_.percent=p.percent,_.tax_type_id=p.id,_.compound_tax=p.compound_tax,_.name=p.name,B()}function B(){_.tax_type_id!==0&&e("update",{index:t.index,item:{..._,amount:M.value}})}function i(){let p={itemIndex:t.itemIndex,taxIndex:t.index};w.openModal({title:C("settings.tax_types.add_tax"),componentName:"TaxTypeModal",data:p,size:"sm"})}function d(p){t.store.$patch(u=>{u[t.storeProp].items[t.itemIndex].taxes.splice(p,1)})}return(p,u)=>{const T=f("BaseIcon"),g=f("BaseMultiselect"),l=f("BaseFormatMoney");return r(),b("div",Le,[o("div",Ue,[o("label",Oe,h(p.$t("invoices.item.tax")),1),a(g,{modelValue:I.value,"onUpdate:modelValue":[u[0]||(u[0]=x=>I.value=x),u[1]||(u[1]=x=>V(x))],"value-prop":"id",options:y.value,placeholder:p.$t("general.select_a_tax"),"open-direction":"top","track-by":"name",searchable:"",object:"",label:"name"},ke({singlelabel:c(({value:x})=>[o("div",ze,h(x.name)+" - "+h(x.percent)+" % ",1)]),option:c(({option:x})=>[j(h(x.name)+" - "+h(x.percent)+" % ",1)]),_:2},[m($).hasAbilities(s.ability)?{name:"action",fn:c(()=>[o("button",{type:"button",class:"flex items-center justify-center w-full px-2 py-2 bg-gray-200 border-none outline-none cursor-pointer",onClick:i},[a(T,{name:"CheckCircleIcon",class:"h-5 text-primary-400"}),o("label",Ne,h(p.$t("invoices.add_new_tax")),1)])]),key:"0"}:void 0]),1032,["modelValue","options","placeholder"]),Fe]),o("div",We,[a(l,{amount:M.value,currency:s.currency},null,8,["amount","currency"])]),o("div",Ge,[s.taxes.length&&s.index!==s.taxes.length-1?(r(),P(T,{key:0,name:"TrashIcon",class:"h-5 text-gray-700 cursor-pointer",onClick:u[2]||(u[2]=x=>d(s.index))})):L("",!0)])])}}},Re={class:"box-border bg-white border border-gray-200 border-solid rounded-b"},Xe={colspan:"5",class:"p-0 text-left align-top"},He={class:"w-full"},Je=o("col",{style:{width:"40%","min-width":"280px"}},null,-1),Ke=o("col",{style:{width:"10%","min-width":"120px"}},null,-1),Qe=o("col",{style:{width:"15%","min-width":"120px"}},null,-1),Ze={key:0,style:{width:"15%","min-width":"160px"}},et=o("col",{style:{width:"15%","min-width":"120px"}},null,-1),tt={class:"px-5 py-4 text-left align-top"},st={class:"flex justify-start"},at={class:"flex items-center justify-center w-5 h-5 mt-2 mr-2 text-gray-300 cursor-move handle"},ot={class:"px-5 py-4 text-right align-top"},nt={class:"px-5 py-4 text-left align-top"},rt={class:"flex flex-col"},lt={class:"flex-auto flex-fill bd-highlight"},it={class:"relative w-full"},dt={key:0,class:"px-5 py-4 text-left align-top"},ct={class:"flex flex-col"},ut={class:"flex",style:{width:"120px"},role:"group"},mt={class:"flex items-center"},pt={class:"px-5 py-4 text-right align-top"},yt={class:"flex items-center justify-end text-sm"},ft={class:"flex items-center justify-center w-6 h-10 mx-2"},xt={key:0},_t=o("td",{class:"px-5 py-4 text-left align-top"},null,-1),gt={colspan:"4",class:"px-5 py-4 text-left align-top"},ht={__name:"CreateItemRow",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},itemData:{type:Object,default:null},index:{type:Number,default:null},type:{type:String,default:""},loading:{type:Boolean,default:!1},currency:{type:[Object,String],required:!0},invoiceItems:{type:Array,required:!0},itemValidationScope:{type:String,default:""}},emits:["update","remove","itemValidate"],setup(s,{emit:e}){const t=s,n=Z(),w=pe();Te();const{t:$}=X.useI18n(),I=S({get:()=>t.itemData.quantity,set:v=>{E("quantity",parseFloat(v))}}),_=S({get:()=>{const v=t.itemData.price;return parseFloat(v)>0?v/100:v},set:v=>{if(parseFloat(v)>0){let k=Math.round(v*100);E("price",k)}else E("price",v)}}),C=S(()=>t.itemData.price*t.itemData.quantity),y=S({get:()=>t.itemData.discount,set:v=>{t.itemData.discount_type==="percentage"?E("discount_val",C.value*v/100):E("discount_val",Math.round(v*100)),E("discount",v)}}),M=S(()=>C.value-t.itemData.discount_val),V=S(()=>t.currency?t.currency:n.selectedCompanyCurrency),B=S(()=>t.store[t.storeProp].items.length!=1),i=S(()=>Math.round(Y.exports.sumBy(t.itemData.taxes,function(v){return v.compound_tax?0:v.amount}))),d=S(()=>Math.round(Y.exports.sumBy(t.itemData.taxes,function(v){return v.compound_tax?v.amount:0}))),p=S(()=>i.value+d.value),u={name:{required:U.withMessage($("validation.required"),F)},quantity:{required:U.withMessage($("validation.required"),F),minValue:U.withMessage($("validation.qty_must_greater_than_zero"),me(0)),maxLength:U.withMessage($("validation.amount_maxlength"),ee(20))},price:{required:U.withMessage($("validation.required"),F),minValue:U.withMessage($("validation.number_length_minvalue"),me(1)),maxLength:U.withMessage($("validation.price_maxlength"),ee(20))},discount_val:{between:U.withMessage($("validation.discount_maxlength"),Me(0,S(()=>C.value)))},description:{maxLength:U.withMessage($("validation.notes_maxlength"),ee(65e3))}},T=le(u,S(()=>t.store[t.storeProp].items[t.index]),{$scope:t.itemValidationScope});function g(v){t.store.$patch(z=>{z[t.storeProp].items[t.index].taxes[v.index]=v.item}),t.itemData.taxes[t.itemData.taxes.length-1]?.tax_type_id!==0&&t.store.$patch(z=>{z[t.storeProp].items[t.index].taxes.push({...$e,id:ye.raw()})}),A()}function l(v){E("name",v)}function x(v){t.store.$patch(k=>{if(k[t.storeProp].items[t.index].name=v.name,k[t.storeProp].items[t.index].price=v.price,k[t.storeProp].items[t.index].item_id=v.id,k[t.storeProp].items[t.index].description=v.description,v.unit&&(k[t.storeProp].items[t.index].unit_name=v.unit.name),t.store[t.storeProp].tax_per_item==="YES"&&v.taxes){let z=0;v.taxes.forEach(H=>{g({index:z,item:{...H}}),z++})}k[t.storeProp].exchange_rate&&(k[t.storeProp].items[t.index].price/=k[t.storeProp].exchange_rate)}),w.fetchItems(),A()}function q(){t.itemData.discount_type!=="fixed"&&(E("discount_val",Math.round(t.itemData.discount*100)),E("discount_type","fixed"))}function D(){t.itemData.discount_type!=="percentage"&&(E("discount_val",C.value*t.itemData.discount/100),E("discount_type","percentage"))}function A(){let v=t.store[t.storeProp]?.items[t.index]?.taxes;v||(v=[]);let k={...t.store[t.storeProp].items[t.index],index:t.index,total:M.value,sub_total:C.value,totalSimpleTax:i.value,totalCompoundTax:d.value,totalTax:p.value,tax:p.value,taxes:[...v]};t.store.updateItem(k)}function E(v,k){t.store.$patch(z=>{z[t.storeProp].items[t.index][v]=k}),A()}return(v,k)=>{const z=f("BaseItemSelect"),H=f("BaseInput"),O=f("BaseMoney"),ie=f("BaseIcon"),ge=f("BaseButton"),de=f("BaseDropdownItem"),he=f("BaseDropdown"),ce=f("BaseContentPlaceholdersText"),ue=f("BaseContentPlaceholders"),ve=f("BaseFormatMoney");return r(),b("tr",Re,[o("td",Xe,[o("table",He,[o("colgroup",null,[Je,Ke,Qe,s.store[s.storeProp].discount_per_item==="YES"?(r(),b("col",Ze)):L("",!0),et]),o("tbody",null,[o("tr",null,[o("td",tt,[o("div",st,[o("div",at,[a(Ve)]),a(z,{type:"Invoice",item:s.itemData,invalid:m(T).name.$error,"invalid-description":m(T).description.$error,taxes:s.itemData.taxes,index:s.index,"store-prop":s.storeProp,store:s.store,onSearch:l,onSelect:x},null,8,["item","invalid","invalid-description","taxes","index","store-prop","store"])])]),o("td",ot,[a(H,{modelValue:I.value,"onUpdate:modelValue":k[0]||(k[0]=N=>I.value=N),invalid:m(T).quantity.$error,"content-loading":s.loading,type:"number",small:"",min:"0",step:"any",onChange:k[1]||(k[1]=N=>A()),onInput:k[2]||(k[2]=N=>m(T).quantity.$touch())},null,8,["modelValue","invalid","content-loading"])]),o("td",nt,[o("div",rt,[o("div",lt,[o("div",it,[(r(),P(O,{key:V.value,modelValue:_.value,"onUpdate:modelValue":k[3]||(k[3]=N=>_.value=N),invalid:m(T).price.$error,"content-loading":s.loading,currency:V.value},null,8,["modelValue","invalid","content-loading","currency"]))])])])]),s.store[s.storeProp].discount_per_item==="YES"?(r(),b("td",dt,[o("div",ct,[o("div",ut,[a(H,{modelValue:y.value,"onUpdate:modelValue":k[4]||(k[4]=N=>y.value=N),invalid:m(T).discount_val.$error,"content-loading":s.loading,class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue","invalid","content-loading"]),a(he,{position:"bottom-end"},{activator:c(()=>[a(ge,{"content-loading":s.loading,class:"rounded-tr-md rounded-br-md !p-2 rounded-none",type:"button",variant:"white"},{default:c(()=>[o("span",mt,[j(h(s.itemData.discount_type=="fixed"?s.currency.symbol:"%")+" ",1),a(ie,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1},8,["content-loading"])]),default:c(()=>[a(de,{onClick:q},{default:c(()=>[j(h(v.$t("general.fixed")),1)]),_:1}),a(de,{onClick:D},{default:c(()=>[j(h(v.$t("general.percentage")),1)]),_:1})]),_:1})])])])):L("",!0),o("td",pt,[o("div",yt,[o("span",null,[s.loading?(r(),P(ue,{key:0},{default:c(()=>[a(ce,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),P(ve,{key:1,amount:M.value,currency:V.value},null,8,["amount","currency"]))]),o("div",ft,[B.value?(r(),P(ie,{key:0,class:"h-5 text-gray-700 cursor-pointer",name:"TrashIcon",onClick:k[5]||(k[5]=N=>s.store.removeItem(s.index))})):L("",!0)])])])]),s.store[s.storeProp].tax_per_item==="YES"?(r(),b("tr",xt,[_t,o("td",gt,[s.loading?(r(),P(ue,{key:0},{default:c(()=>[a(ce,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(r(!0),b(J,{key:1},K(s.itemData.taxes,(N,be)=>(r(),P(Ye,{key:N.id,index:be,"item-index":s.index,"tax-data":N,taxes:s.itemData.taxes,"discounted-total":M.value,"total-tax":i.value,total:C.value,currency:s.currency,"update-items":A,ability:m(ne).CREATE_INVOICE,store:s.store,"store-prop":s.storeProp,discount:y.value,onUpdate:g},null,8,["index","item-index","tax-data","taxes","discounted-total","total-tax","total","currency","ability","store","store-prop","discount"]))),128))])])):L("",!0)])])])])}}},vt={class:"text-center item-table min-w-full"},bt=o("col",{style:{width:"40%","min-width":"280px"}},null,-1),$t=o("col",{style:{width:"10%","min-width":"120px"}},null,-1),wt=o("col",{style:{width:"15%","min-width":"120px"}},null,-1),St={key:0,style:{width:"15%","min-width":"160px"}},It=o("col",{style:{width:"15%","min-width":"120px"}},null,-1),Bt={class:"bg-white border border-gray-200 border-solid"},Tt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},kt={key:1,class:"pl-7"},Pt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},Ct={key:1},Mt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},Dt={key:1},Vt={key:0,class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-left text-gray-700 border-t border-b border-gray-200 border-solid"},jt={key:1},qt={class:"px-5 py-3 text-sm not-italic font-medium leading-5 text-right text-gray-700 border-t border-b border-gray-200 border-solid"},At={key:1,class:"pr-10 column-heading"},Zs={__name:"CreateItems",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},currency:{type:[Object,String,null],required:!0},isLoading:{type:Boolean,default:!1},itemValidationScope:{type:String,default:""}},setup(s){const e=s,t=Z(),n=S(()=>e.currency?e.currency:t.selectedCompanyCurrency);return(w,$)=>{const I=f("BaseContentPlaceholdersText"),_=f("BaseContentPlaceholders"),C=f("BaseIcon");return r(),b(J,null,[o("table",vt,[o("colgroup",null,[bt,$t,wt,s.store[s.storeProp].discount_per_item==="YES"?(r(),b("col",St)):L("",!0),It]),o("thead",Bt,[o("tr",null,[o("th",Tt,[s.isLoading?(r(),P(_,{key:0},{default:c(()=>[a(I,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("span",kt,h(w.$tc("items.item",2)),1))]),o("th",Pt,[s.isLoading?(r(),P(_,{key:0},{default:c(()=>[a(I,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("span",Ct,h(w.$t("invoices.item.quantity")),1))]),o("th",Mt,[s.isLoading?(r(),P(_,{key:0},{default:c(()=>[a(I,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("span",Dt,h(w.$t("invoices.item.price")),1))]),s.store[s.storeProp].discount_per_item==="YES"?(r(),b("th",Vt,[s.isLoading?(r(),P(_,{key:0},{default:c(()=>[a(I,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("span",jt,h(w.$t("invoices.item.discount")),1))])):L("",!0),o("th",qt,[s.isLoading?(r(),P(_,{key:0},{default:c(()=>[a(I,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("span",At,h(w.$t("invoices.item.amount")),1))])])]),a(m(Be),{modelValue:s.store[s.storeProp].items,"onUpdate:modelValue":$[0]||($[0]=y=>s.store[s.storeProp].items=y),"item-key":"id",tag:"tbody",handle:".handle"},{item:c(({element:y,index:M})=>[(r(),P(ht,{key:y.id,index:M,"item-data":y,loading:s.isLoading,currency:n.value,"item-validation-scope":s.itemValidationScope,"invoice-items":s.store[s.storeProp].items,store:s.store,"store-prop":s.storeProp},null,8,["index","item-data","loading","currency","item-validation-scope","invoice-items","store","store-prop"]))]),_:1},8,["modelValue"])]),o("div",{class:"flex items-center justify-center w-full px-6 py-3 text-base border border-t-0 border-gray-200 border-solid cursor-pointer text-primary-400 hover:bg-primary-100",onClick:$[1]||($[1]=(...y)=>s.store.addItem&&s.store.addItem(...y))},[a(C,{name:"PlusCircleIcon",class:"mr-2"}),j(" "+h(w.$t("general.add_new_item")),1)])],64)}}},Et={class:"flex items-center justify-between w-full mt-2 text-sm"},Lt={class:"font-semibold leading-5 text-gray-500 uppercase"},Ut={class:"flex items-center justify-center text-lg text-black"},Ot={__name:"CreateTotalTaxes",props:{index:{type:Number,required:!0},tax:{type:Object,required:!0},taxes:{type:Array,required:!0},currency:{type:[Object,String],required:!0},store:{type:Object,default:null},data:{type:String,default:""}},emits:["update","remove"],setup(s,{emit:e}){const t=s;re("$utils");const n=S(()=>t.tax.compound_tax&&t.store.getSubtotalWithDiscount?Math.round((t.store.getSubtotalWithDiscount+t.store.getTotalSimpleTax)*t.tax.percent/100):t.store.getSubtotalWithDiscount&&t.tax.percent?Math.round(t.store.getSubtotalWithDiscount*t.tax.percent/100):0);Pe(()=>{t.store.getSubtotalWithDiscount&&w(),t.store.getTotalSimpleTax&&w()});function w(){e("update",{...t.tax,amount:n.value})}return($,I)=>{const _=f("BaseFormatMoney"),C=f("BaseIcon");return r(),b("div",Et,[o("label",Lt,h(s.tax.name)+" ("+h(s.tax.percent)+" %) ",1),o("label",Ut,[a(_,{amount:s.tax.amount,currency:s.currency},null,8,["amount","currency"]),a(C,{name:"TrashIcon",class:"h-5 ml-2 cursor-pointer",onClick:I[0]||(I[0]=y=>$.$emit("remove",s.tax.id))})])])}}},zt={class:"w-full mt-4 tax-select"},Nt={class:"relative w-full max-w-md px-4"},Ft={class:"overflow-hidden rounded-md shadow-lg ring-1 ring-black ring-opacity-5"},Wt={class:"relative bg-white"},Gt={class:"relative p-4"},Yt={key:0,class:"relative flex flex-col overflow-auto list max-h-36 border-t border-gray-200"},Rt=["onClick"],Xt={class:"flex justify-between px-2"},Ht={class:"m-0 text-base font-semibold leading-tight text-gray-700 cursor-pointer"},Jt={class:"m-0 text-base font-semibold text-gray-700 cursor-pointer"},Kt={key:1,class:"flex justify-center p-5 text-gray-400"},Qt={class:"text-base text-gray-500 cursor-pointer"},Zt={class:"m-0 ml-3 text-sm leading-none cursor-pointer font-base text-primary-400"},es={__name:"SelectTaxPopup",props:{type:{type:String,default:null},store:{type:Object,default:null},storeProp:{type:String,default:""}},emits:["select:taxType"],setup(s,{emit:e}){const t=s,n=R(),w=Q(),$=oe(),{t:I}=X.useI18n(),_=G(null),C=S(()=>_.value?w.taxTypes.filter(function(B){return B.name.toLowerCase().indexOf(_.value.toLowerCase())!==-1}):w.taxTypes),y=S(()=>t.store[t.storeProp].taxes);function M(B,i){e("select:taxType",{...B}),i()}function V(){n.openModal({title:I("settings.tax_types.add_tax"),componentName:"TaxTypeModal",size:"sm",refreshData:B=>e("select:taxType",B)})}return(B,i)=>{const d=f("BaseIcon"),p=f("BaseInput");return r(),b("div",zt,[a(m(Ae),{class:"relative"},{default:c(({isOpen:u})=>[a(m(je),{class:W([u?"":"text-opacity-90","flex items-center text-sm font-medium text-primary-400 focus:outline-none focus:border-none"])},{default:c(()=>[a(d,{name:"PlusIcon",class:"w-4 h-4 font-medium text-primary-400"}),j(" "+h(B.$t("settings.tax_types.add_tax")),1)]),_:2},1032,["class"]),o("div",Nt,[a(Ce,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:c(()=>[a(m(qe),{style:{"min-width":"350px","margin-left":"62px",top:"-28px"},class:"absolute z-10 px-4 py-2 -translate-x-full sm:px-0"},{default:c(({close:T})=>[o("div",Ft,[o("div",Wt,[o("div",Gt,[a(p,{modelValue:_.value,"onUpdate:modelValue":i[0]||(i[0]=g=>_.value=g),placeholder:B.$t("general.search"),type:"text",class:"text-black"},null,8,["modelValue","placeholder"])]),C.value.length>0?(r(),b("div",Yt,[(r(!0),b(J,null,K(C.value,(g,l)=>(r(),b("div",{key:l,class:W([{"bg-gray-100 cursor-not-allowed opacity-50 pointer-events-none":y.value.find(x=>x.tax_type_id===g.id)},"px-6 py-4 border-b border-gray-200 border-solid cursor-pointer hover:bg-gray-100 hover:cursor-pointer last:border-b-0"]),tabindex:"2",onClick:x=>M(g,T)},[o("div",Xt,[o("label",Ht,h(g.name),1),o("label",Jt,h(g.percent)+" % ",1)])],10,Rt))),128))])):(r(),b("div",Kt,[o("label",Qt,h(B.$t("general.no_tax_found")),1)]))]),m($).hasAbilities(m(ne).CREATE_TAX_TYPE)?(r(),b("button",{key:0,type:"button",class:"flex items-center justify-center w-full h-10 px-2 py-3 bg-gray-200 border-none outline-none",onClick:V},[a(d,{name:"CheckCircleIcon",class:"text-primary-400"}),o("label",Zt,h(B.$t("estimates.add_new_tax")),1)])):L("",!0)])]),_:1})]),_:1})])]),_:1})])}}},ts={class:"px-5 py-4 mt-6 bg-white border border-gray-200 border-solid rounded md:min-w-[390px] min-w-[300px] lg:mt-7"},ss={class:"flex items-center justify-between w-full"},as={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},os={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ns={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-500 uppercase"},rs={key:3,class:"flex items-center justify-center m-0 text-lg text-black uppercase"},ls={key:0,class:"flex items-center justify-between w-full mt-2"},is={key:1,class:"text-sm font-semibold leading-5 text-gray-400 uppercase"},ds={key:3,class:"flex",style:{width:"140px"},role:"group"},cs={class:"flex items-center"},us={key:1},ms={class:"flex items-center justify-between w-full pt-2 mt-5 border-t border-gray-200 border-solid"},ps={key:1,class:"m-0 text-sm font-semibold leading-5 text-gray-400 uppercase"},ys={key:3,class:"flex items-center justify-center text-lg uppercase text-primary-400"},ea={__name:"CreateTotal",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},taxPopupType:{type:String,default:""},currency:{type:[Object,String],default:""},isLoading:{type:Boolean,default:!1}},setup(s){const e=s,t=G(null);re("$utils");const n=Z(),w=S({get:()=>e.store[e.storeProp].discount,set:i=>{e.store[e.storeProp].discount_type==="percentage"?e.store[e.storeProp].discount_val=Math.round(e.store.getSubTotal*i/100):e.store[e.storeProp].discount_val=Math.round(i*100),e.store[e.storeProp].discount=i}}),$=S({get:()=>e.store[e.storeProp].taxes,set:i=>{e.store.$patch(d=>{d[e.storeProp].taxes=i})}}),I=S(()=>{let i=[];return e.store[e.storeProp].items.forEach(d=>{d.taxes&&d.taxes.forEach(p=>{let u=i.find(T=>T.tax_type_id===p.tax_type_id);u?u.amount+=p.amount:p.tax_type_id&&i.push({tax_type_id:p.tax_type_id,amount:p.amount,percent:p.percent,name:p.name})})}),i}),_=S(()=>e.currency?e.currency:n.selectedCompanyCurrency);function C(){e.store[e.storeProp].discount_type!=="fixed"&&(e.store[e.storeProp].discount_val=Math.round(e.store[e.storeProp].discount*100),e.store[e.storeProp].discount_type="fixed")}function y(){e.store[e.storeProp].discount_type!=="percentage"&&(e.store[e.storeProp].discount_val=e.store.getSubTotal*e.store[e.storeProp].discount/100,e.store[e.storeProp].discount_type="percentage")}function M(i){let d=0;i.compound_tax&&e.store.getSubtotalWithDiscount?d=Math.round((e.store.getSubtotalWithDiscount+e.store.getTotalSimpleTax)*i.percent/100):e.store.getSubtotalWithDiscount&&i.percent&&(d=Math.round(e.store.getSubtotalWithDiscount*i.percent/100));let p={...ne,id:ye.raw(),name:i.name,percent:i.percent,compound_tax:i.compound_tax,tax_type_id:i.id,amount:d};e.store.$patch(u=>{u[e.storeProp].taxes.push({...p})})}function V(i){const d=e.store[e.storeProp].taxes.find(p=>p.id===i.id);d&&Object.assign(d,{...i})}function B(i){const d=e.store[e.storeProp].taxes.findIndex(p=>p.id===i);e.store.$patch(p=>{p[e.storeProp].taxes.splice(d,1)})}return(i,d)=>{const p=f("BaseContentPlaceholdersText"),u=f("BaseContentPlaceholders"),T=f("BaseFormatMoney"),g=f("BaseInput"),l=f("BaseIcon"),x=f("BaseButton"),q=f("BaseDropdownItem"),D=f("BaseDropdown");return r(),b("div",ts,[o("div",ss,[s.isLoading?(r(),P(u,{key:0},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("label",as,h(i.$t("estimates.sub_total")),1)),s.isLoading?(r(),P(u,{key:2},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("label",os,[a(T,{amount:s.store.getSubTotal,currency:_.value},null,8,["amount","currency"])]))]),(r(!0),b(J,null,K(I.value,A=>(r(),b("div",{key:A.tax_type_id,class:"flex items-center justify-between w-full"},[s.isLoading?(r(),P(u,{key:0},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(r(),b("label",ns,h(A.name)+" - "+h(A.percent)+"% ",1)):L("",!0),s.isLoading?(r(),P(u,{key:2},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):s.store[s.storeProp].tax_per_item==="YES"?(r(),b("label",rs,[a(T,{amount:A.amount,currency:_.value},null,8,["amount","currency"])])):L("",!0)]))),128)),s.store[s.storeProp].discount_per_item==="NO"||s.store[s.storeProp].discount_per_item===null?(r(),b("div",ls,[s.isLoading?(r(),P(u,{key:0},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("label",is,h(i.$t("estimates.discount")),1)),s.isLoading?(r(),P(u,{key:2},{default:c(()=>[a(p,{lines:1,class:"w-24 h-8 border rounded-md"})]),_:1})):(r(),b("div",ds,[a(g,{modelValue:w.value,"onUpdate:modelValue":d[0]||(d[0]=A=>w.value=A),class:"border-r-0 focus:border-r-2 rounded-tr-sm rounded-br-sm h-[38px]"},null,8,["modelValue"]),a(D,{position:"bottom-end"},{activator:c(()=>[a(x,{class:"p-2 rounded-none rounded-tr-md rounded-br-md",type:"button",variant:"white"},{default:c(()=>[o("span",cs,[j(h(s.store[s.storeProp].discount_type=="fixed"?_.value.symbol:"%")+" ",1),a(l,{name:"ChevronDownIcon",class:"w-4 h-4 ml-1 text-gray-500"})])]),_:1})]),default:c(()=>[a(q,{onClick:C},{default:c(()=>[j(h(i.$t("general.fixed")),1)]),_:1}),a(q,{onClick:y},{default:c(()=>[j(h(i.$t("general.percentage")),1)]),_:1})]),_:1})]))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(r(),b("div",us,[(r(!0),b(J,null,K($.value,(A,E)=>(r(),P(Ot,{key:A.id,index:E,tax:A,taxes:$.value,currency:s.currency,store:s.store,onRemove:B,onUpdate:V},null,8,["index","tax","taxes","currency","store"]))),128))])):L("",!0),s.store[s.storeProp].tax_per_item==="NO"||s.store[s.storeProp].tax_per_item===null?(r(),b("div",{key:2,ref_key:"taxModal",ref:t,class:"float-right pt-2 pb-4"},[a(es,{"store-prop":s.storeProp,store:s.store,type:s.taxPopupType,"onSelect:taxType":M},null,8,["store-prop","store","type"])],512)):L("",!0),o("div",ms,[s.isLoading?(r(),P(u,{key:0},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("label",ps,h(i.$t("estimates.total"))+" "+h(i.$t("estimates.amount"))+":",1)),s.isLoading?(r(),P(u,{key:2},{default:c(()=>[a(p,{lines:1,class:"w-16 h-5"})]),_:1})):(r(),b("label",ys,[a(T,{amount:s.store.getTotal,currency:_.value},null,8,["amount","currency"])]))])])}}},fs={class:"flex text-gray-800 font-medium text-sm mb-2"},xs=o("span",{class:"text-sm text-red-500"}," *",-1),ta={__name:"SelectTemplateButton",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},isMarkAsDefault:{type:Boolean,default:!1}},setup(s){const e=s,t=R(),{t:n}=X.useI18n();function w(){let $="";e.storeProp=="newEstimate"?$=n("estimates.mark_as_default_estimate_template_description"):e.storeProp=="newInvoice"&&($=n("invoices.mark_as_default_invoice_template_description")),t.openModal({title:n("general.choose_template"),componentName:"SelectTemplate",data:{templates:e.store.templates,store:e.store,storeProp:e.storeProp,isMarkAsDefault:e.isMarkAsDefault,markAsDefaultDescription:$}})}return($,I)=>{const _=f("BaseIcon"),C=f("BaseButton");return r(),b("div",null,[o("label",fs,[j(h($.$t("general.select_template"))+" ",1),xs]),a(C,{type:"button",class:"flex justify-center w-full text-sm lg:w-auto hover:bg-gray-200",variant:"gray",onClick:w},{right:c(y=>[a(_,{name:"PencilIcon",class:W(y.class)},null,8,["class"])]),default:c(()=>[j(" "+h(s.store[s.storeProp].template_name),1)]),_:1})])}}},_s={class:"mb-6"},gs={class:"z-20 text-sm font-semibold leading-5 text-primary-400 float-right"},hs={class:"text-gray-800 font-medium mb-4 text-sm"},sa={__name:"CreateNotesField",props:{store:{type:Object,default:null},storeProp:{type:String,default:""},fields:{type:Object,default:null},type:{type:String,default:null}},setup(s){const e=s;function t(n){e.store[e.storeProp].notes=""+n.notes}return(n,w)=>{const $=f("BaseCustomInput");return r(),b("div",_s,[o("div",gs,[a(Ee,{type:s.type,onSelect:t},null,8,["type"])]),o("label",hs,h(n.$t("invoices.notes")),1),a($,{modelValue:s.store[s.storeProp].notes,"onUpdate:modelValue":w[0]||(w[0]=I=>s.store[s.storeProp].notes=I),"content-loading":s.store.isFetchingInitialSettings,fields:s.fields,class:"mt-1"},null,8,["modelValue","content-loading","fields"])])}}},vs={class:"flex justify-between w-full"},bs={class:"px-8 py-8 sm:p-6"},$s={key:0,class:"grid grid-cols-3 gap-2 p-1 overflow-x-auto"},ws=["onClick"],Ss=["src","alt"],Is=["alt","src"],Bs={key:1,class:"z-0 flex ml-3 pt-5"},Ts={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},aa={__name:"SelectTemplateModal",setup(s){const e=R(),t=oe(),n=G(""),w=S(()=>e.active&&e.componentName==="SelectTemplate"),$=S(()=>e.title);function I(){e.data.store[e.data.storeProp].template_name?n.value=e.data.store[e.data.storeProp].template_name:n.value=e.data.templates[0]}async function _(){await e.data.store.setTemplate(n.value),!e.data.store.isEdit&&e.data.isMarkAsDefault&&(e.data.storeProp=="newEstimate"?await t.updateUserSettings({settings:{default_estimate_template:n.value}}):e.data.storeProp=="newInvoice"&&await t.updateUserSettings({settings:{default_invoice_template:n.value}})),y()}function C(){return new URL("/img/tick.png",self.location)}function y(){e.closeModal(),setTimeout(()=>{e.$reset()},300)}return(M,V)=>{const B=f("BaseIcon"),i=f("BaseCheckbox"),d=f("BaseButton"),p=f("BaseModal");return r(),P(p,{show:w.value,onClose:y,onOpen:I},{header:c(()=>[o("div",vs,[j(h($.value)+" ",1),a(B,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:y})])]),default:c(()=>[o("div",bs,[m(e).data?(r(),b("div",$s,[(r(!0),b(J,null,K(m(e).data.templates,(u,T)=>(r(),b("div",{key:T,class:W([{"border border-solid border-primary-500":n.value===u.name},"relative flex flex-col m-2 border border-gray-200 border-solid cursor-pointer hover:border-primary-300"]),onClick:g=>n.value=u.name},[o("img",{src:u.path,alt:u.name,class:"w-full min-h-[100px]"},null,8,Ss),n.value===u.name?(r(),b("img",{key:0,alt:u.name,class:"absolute z-10 w-5 h-5 text-primary-500",style:{top:"-6px",right:"-5px"},src:C()},null,8,Is)):L("",!0),o("span",{class:W(["w-full p-1 bg-gray-200 text-sm text-center absolute bottom-0 left-0",{"text-primary-500 bg-primary-100":n.value===u.name,"text-gray-600":n.value!=u.name}])},h(u.name),3)],10,ws))),128))])):L("",!0),m(e).data.store.isEdit?L("",!0):(r(),b("div",Bs,[a(i,{modelValue:m(e).data.isMarkAsDefault,"onUpdate:modelValue":V[0]||(V[0]=u=>m(e).data.isMarkAsDefault=u),"set-initial-value":!1,variant:"primary",label:M.$t("general.mark_as_default"),description:m(e).data.markAsDefaultDescription},null,8,["modelValue","label","description"])]))]),o("div",Ts,[a(d,{class:"mr-3",variant:"primary-outline",onClick:y},{default:c(()=>[j(h(M.$t("general.cancel")),1)]),_:1}),a(d,{variant:"primary",onClick:V[1]||(V[1]=u=>_())},{left:c(u=>[a(B,{name:"SaveIcon",class:W(u.class)},null,8,["class"])]),default:c(()=>[j(" "+h(M.$t("general.choose")),1)]),_:1})])]),_:1},8,["show"])}}},ks={class:"flex justify-between w-full"},Ps={class:"item-modal"},Cs=["onSubmit"],Ms={class:"px-8 py-8 sm:p-6"},Ds={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},oa={__name:"ItemModal",emits:["newItem"],setup(s,{emit:e}){const t=R(),n=pe(),w=Z(),$=Q();we(),Se();const{t:I}=X.useI18n(),_=G(!1),C=G(w.selectedCompanySettings.tax_per_item),y=S(()=>t.active&&t.componentName==="ItemModal"),M=S({get:()=>n.currentItem.price/100,set:g=>{n.currentItem.price=Math.round(g*100)}}),V=S({get:()=>n.currentItem.taxes.map(g=>{if(g)return{...g,tax_type_id:g.id,tax_name:g.name+" ("+g.percent+"%)"}}),set:g=>{n.$patch(l=>{l.currentItem.taxes=g})}}),B=S(()=>C.value==="YES"),i={name:{required:U.withMessage(I("validation.required"),F),minLength:U.withMessage(I("validation.name_min_length",{count:3}),De(3))},description:{maxLength:U.withMessage(I("validation.description_maxlength",{count:255}),ee(255))}},d=le(i,S(()=>n.currentItem)),p=S(()=>$.taxTypes.map(g=>({...g,tax_name:g.name+" ("+g.percent+"%)"})));xe(()=>{d.value.$reset(),n.fetchItemUnits({limit:"all"})});async function u(){if(d.value.$touch(),d.value.$invalid)return!0;let g={...n.currentItem,taxes:n.currentItem.taxes.map(x=>({tax_type_id:x.id,amount:M.value*x.percent/100,percent:x.percent,name:x.name,collective_tax:0}))};_.value=!0,await(n.isEdit?n.updateItem:n.addItem)(g).then(x=>{_.value=!1,x.data.data&&t.data&&t.refreshData(x.data.data),T()})}function T(){t.closeModal(),setTimeout(()=>{n.resetCurrentItem(),t.$reset(),d.value.$reset()},300)}return(g,l)=>{const x=f("BaseIcon"),q=f("BaseInput"),D=f("BaseInputGroup"),A=f("BaseMoney"),E=f("BaseMultiselect"),v=f("BaseTextarea"),k=f("BaseInputGrid"),z=f("BaseButton"),H=f("BaseModal");return r(),P(H,{show:y.value,onClose:T},{header:c(()=>[o("div",ks,[j(h(m(t).title)+" ",1),a(x,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:T})])]),default:c(()=>[o("div",Ps,[o("form",{action:"",onSubmit:_e(u,["prevent"])},[o("div",Ms,[a(k,{layout:"one-column"},{default:c(()=>[a(D,{label:g.$t("items.name"),required:"",error:m(d).name.$error&&m(d).name.$errors[0].$message},{default:c(()=>[a(q,{modelValue:m(n).currentItem.name,"onUpdate:modelValue":l[0]||(l[0]=O=>m(n).currentItem.name=O),type:"text",invalid:m(d).name.$error,onInput:l[1]||(l[1]=O=>m(d).name.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"]),a(D,{label:g.$t("items.price")},{default:c(()=>[(r(),P(A,{key:m(w).selectedCompanyCurrency,modelValue:M.value,"onUpdate:modelValue":l[2]||(l[2]=O=>M.value=O),currency:m(w).selectedCompanyCurrency,class:"relative w-full focus:border focus:border-solid focus:border-primary"},null,8,["modelValue","currency"]))]),_:1},8,["label"]),a(D,{label:g.$t("items.unit")},{default:c(()=>[a(E,{modelValue:m(n).currentItem.unit_id,"onUpdate:modelValue":l[3]||(l[3]=O=>m(n).currentItem.unit_id=O),label:"name",options:m(n).itemUnits,"value-prop":"id","can-deselect":!1,"can-clear":!1,placeholder:g.$t("items.select_a_unit"),searchable:"","track-by":"name"},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),B.value?(r(),P(D,{key:0,label:g.$t("items.taxes")},{default:c(()=>[a(E,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=O=>V.value=O),options:p.value,mode:"tags",label:"tax_name","value-prop":"id",class:"w-full","can-deselect":!1,"can-clear":!1,searchable:"","track-by":"tax_name",object:""},null,8,["modelValue","options"])]),_:1},8,["label"])):L("",!0),a(D,{label:g.$t("items.description"),error:m(d).description.$error&&m(d).description.$errors[0].$message},{default:c(()=>[a(v,{modelValue:m(n).currentItem.description,"onUpdate:modelValue":l[5]||(l[5]=O=>m(n).currentItem.description=O),rows:"4",cols:"50",invalid:m(d).description.$error,onInput:l[6]||(l[6]=O=>m(d).description.$touch())},null,8,["modelValue","invalid"])]),_:1},8,["label","error"])]),_:1})]),o("div",Ds,[a(z,{class:"mr-3",variant:"primary-outline",type:"button",onClick:T},{default:c(()=>[j(h(g.$t("general.cancel")),1)]),_:1}),a(z,{loading:_.value,disabled:_.value,variant:"primary",type:"submit"},{left:c(O=>[a(x,{name:"SaveIcon",class:W(O.class)},null,8,["class"])]),default:c(()=>[j(" "+h(m(n).isEdit?g.$t("general.update"):g.$t("general.save")),1)]),_:1},8,["loading","disabled"])])],40,Cs)])]),_:1},8,["show"])}}},Vs={class:"flex justify-between w-full"},js={class:"flex flex-col"},qs={class:"text-sm text-gray-500 mt-1"},As=["onSubmit"],Es={class:"p-4 sm:p-6"},Ls={class:"z-0 flex justify-end p-4 border-t border-gray-200 border-solid"},Us={__name:"TaxationAddressModal",emits:["addTax"],setup(s,{emit:e}){const t=R();Ie();const n=fe({state:"",city:"",address_street_1:"",zip:""}),w=G(!1),$=Q(),{t:I}=X.useI18n(),_=S(()=>t.active&&t.componentName==="TaxationAddressModal"),C=S(()=>({state:{required:U.withMessage(I("validation.required"),F)},city:{required:U.withMessage(I("validation.required"),F)},address_street_1:{required:U.withMessage(I("validation.required"),F)},zip:{required:U.withMessage(I("validation.required"),F)}})),y=le(C,S(()=>n));async function M(){if(y.value.$touch(),y.value.$invalid)return!0;let i={address:n};t.id&&(i.customer_id=t.id),n.address_street_1=n.address_street_1.replace(/(\r\n|\n|\r)/gm,""),w.value=!0,await $.fetchSalesTax(i).then(d=>{w.value=!1,e("addTax",d.data.data),B()}).catch(d=>{w.value=!1})}function V(){n.state=t?.data?.state,n.city=t?.data?.city,n.address_street_1=t?.data?.address_street_1,n.zip=t?.data?.zip}function B(){t.closeModal()}return(i,d)=>{const p=f("BaseIcon"),u=f("BaseInput"),T=f("BaseInputGroup"),g=f("BaseTextarea"),l=f("BaseInputGrid"),x=f("BaseButton"),q=f("BaseModal");return r(),P(q,{show:_.value,onClose:B,onOpen:V},{header:c(()=>[o("div",Vs,[o("div",js,[j(h(m(t).title)+" ",1),o("p",qs,h(m(t).content),1)]),a(p,{name:"XIcon",class:"h-6 w-6 text-gray-500 cursor-pointer",onClick:B})])]),default:c(()=>[o("form",{onSubmit:_e(M,["prevent"])},[o("div",Es,[a(l,{layout:"one-column"},{default:c(()=>[a(T,{required:"",error:m(y).state.$error&&m(y).state.$errors[0].$message,label:i.$t("customers.state")},{default:c(()=>[a(u,{modelValue:n.state,"onUpdate:modelValue":d[0]||(d[0]=D=>n.state=D),type:"text",name:"shippingState",class:"mt-1 md:mt-0",invalid:m(y).state.$error,onInput:d[1]||(d[1]=D=>m(y).state.$touch()),placeholder:i.$t("settings.taxations.state_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(T,{required:"",error:m(y).city.$error&&m(y).city.$errors[0].$message,label:i.$t("customers.city")},{default:c(()=>[a(u,{modelValue:n.city,"onUpdate:modelValue":d[2]||(d[2]=D=>n.city=D),type:"text",name:"shippingCity",class:"mt-1 md:mt-0",invalid:m(y).city.$error,onInput:d[3]||(d[3]=D=>m(y).city.$touch()),placeholder:i.$t("settings.taxations.city_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(T,{required:"",error:m(y).address_street_1.$error&&m(y).address_street_1.$errors[0].$message,label:i.$t("customers.address")},{default:c(()=>[a(g,{modelValue:n.address_street_1,"onUpdate:modelValue":d[4]||(d[4]=D=>n.address_street_1=D),rows:"2",cols:"50",class:"mt-1 md:mt-0",invalid:m(y).address_street_1.$error,onInput:d[5]||(d[5]=D=>m(y).address_street_1.$touch()),placeholder:i.$t("settings.taxations.address_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"]),a(T,{required:"",error:m(y).zip.$error&&m(y).zip.$errors[0].$message,label:i.$t("customers.zip_code")},{default:c(()=>[a(u,{modelValue:n.zip,"onUpdate:modelValue":d[6]||(d[6]=D=>n.zip=D),invalid:m(y).zip.$error,onInput:d[7]||(d[7]=D=>m(y).zip.$touch()),type:"text",class:"mt-1 md:mt-0",placeholder:i.$t("settings.taxations.zip_placeholder")},null,8,["modelValue","invalid","placeholder"])]),_:1},8,["error","label"])]),_:1})]),o("div",Ls,[a(x,{class:"mr-3 text-sm",type:"button",variant:"primary-outline",onClick:B},{default:c(()=>[j(h(i.$t("general.cancel")),1)]),_:1}),a(x,{loading:w.value,variant:"primary",type:"submit"},{left:c(D=>[w.value?L("",!0):(r(),P(p,{key:0,name:"SaveIcon",class:W(D.class)},null,8,["class"]))]),default:c(()=>[j(" "+h(i.$t("general.save")),1)]),_:1},8,["loading"])])],40,As)]),_:1},8,["show"])}}},te="Sales Tax",se="MODULE",na={__name:"SalesTax",props:{isEdit:{type:Boolean,default:null},type:{type:String,default:null},customer:{type:[Object],default:null},store:{type:Object,default:null},storeProp:{type:String,default:null}},setup(s){const e=s,t=R(),n=Z(),w=Q(),{t:$}=X.useI18n(),I=G(!1),_=S(()=>e.isEdit?e.store[e.storeProp].sales_tax_address_type==="billing":n.selectedCompanySettings.sales_tax_address_type==="billing"),C=S(()=>n.selectedCompanySettings.sales_tax_us_enabled==="YES"),y=S(()=>e.isEdit?e.store[e.storeProp].sales_tax_type==="customer_level":n.selectedCompanySettings.sales_tax_type==="customer_level"),M=S(()=>e.isEdit?e.store[e.storeProp].sales_tax_type==="company_level":n.selectedCompanySettings.sales_tax_type==="company_level"),V=S(()=>{if(y.value&&B.value){let l=_.value?e.customer.billing:e.customer.shipping;return{address:Y.exports.pick(l,["address_street_1","city","state","zip"]),customer_id:e.customer.id}}else if(M.value&&B.value)return{address:Y.exports.pick(address,["address_street_1","city","state","zip"])}}),B=S(()=>{if(y.value){let l=_.value?e.customer?.billing:e.customer?.shipping;return i(l)}else if(M.value)return i(n.selectedCompany.address);return!1});ae(()=>e.customer,(l,x)=>{if(l&&x&&y.value){d(l,x);return}!B.value&&y.value&&l?setTimeout(()=>{p()},500):y.value&&l?u():y.value&&!l&&g()}),xe(()=>{M.value&&(B.value?u():p())});function i(l){return l?l.address_street_1&&l.city&&l.state&&l.zip:!1}function d(l,x){const q=_.value?l.billing:l.shipping,D=_.value?x.billing:x.shipping,A=Y.exports.pick(q,["address_street_1","city","state","zip"]),E=Y.exports.pick(D,["address_street_1","city","state","zip"]);Y.exports.isEqual(A,E)||u()}function p(){if(!C.value)return;let l=null,x="";y.value?_.value?(l=e.customer?.billing,x=$("settings.taxations.add_billing_address")):(l=e.customer?.shipping,x=$("settings.taxations.add_shipping_address")):(l=n.selectedCompany.address,x=$("settings.taxations.add_company_address")),t.openModal({title:x,content:$("settings.taxations.modal_description"),componentName:"TaxationAddressModal",data:l,id:y.value?e.customer.id:""})}async function u(){!C.value||(I.value=!0,await w.fetchSalesTax(V.value).then(l=>{T(l.data.data),I.value=!1}).catch(l=>{l.response.data.error&&setTimeout(()=>{p()},500),I.value=!1}))}function T(l){l.tax_type_id=l.id;const x=e.store[e.storeProp].taxes.findIndex(q=>q.name===te&&q.type===se);x>-1?Object.assign(e.store[e.storeProp].taxes[x],l):e.store[e.storeProp].taxes.push(l)}function g(){const l=e.store[e.storeProp].taxes.findIndex(q=>q.name===te&&q.type===se);l>-1&&e.store[e.storeProp].taxes.splice(l,1);let x=w.taxTypes.findIndex(q=>q.name===te&&q.type===se);x>-1&&w.taxTypes.splice(x,1)}return(l,x)=>(r(),P(Us,{onAddTax:T}))}};export{aa as _,oa as a,na as b,Zs as c,sa as d,ta as e,ea as f};
