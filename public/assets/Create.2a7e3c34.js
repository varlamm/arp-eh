import{r as k,a as $,m as ie,O as u,j as y,M as ue,l as r,U as s,P as q,u as e,k as E,g as F,as as w,X as S,R as h,by as de,F as ce}from"./@vue.8cc12e6e.js";import{u as pe,b as me}from"./vue-router.746ec05f.js";import{v as ge}from"./vue-i18n.c6de3223.js";import{d as xe,c as m,r as C,i as _e,b as N,a as fe,f as ye}from"./@vuelidate.c7422de1.js";import{u as ve}from"./expense.dd29ce12.js";import{u as Ee}from"./category.11760f10.js";import{l as be,b as $e,m as he,c as Ce,d as Be}from"./main.f5ac513d.js";import{_ as Ve}from"./CreateCustomFields.52efad8b.js";import{_ as we}from"./CategoryModal.681da4d6.js";import{_ as Se}from"./ExchangeRateConverter.8557ba74.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./moment.9709ab41.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./lodash.8ab3583e.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./exchange-rate.b16bc248.js";const Ie=["onSubmit"],Me={class:"hidden md:block"},ke={class:"block md:hidden"},j="newExpense",it={__name:"Create",setup(qe){const _=be(),U=$e(),t=ve(),f=Ee(),G=he(),A=Ce(),v=pe(),T=me(),{t:d}=ge.useI18n(),D=Be();let g=k(!1),i=k(!1);const I=k(!1),L=$(()=>({currentExpense:{expense_category_id:{required:m.withMessage(d("validation.required"),C)},expense_date:{required:m.withMessage(d("validation.required"),C)},amount:{required:m.withMessage(d("validation.required"),C),minValue:m.withMessage(d("validation.price_minvalue"),_e(.1)),maxLength:m.withMessage(d("validation.price_maxlength"),N(20))},notes:{maxLength:m.withMessage(d("validation.description_maxlength"),N(65e3))},currency_id:{required:m.withMessage(d("validation.required"),C)},exchange_rate:{required:fe(function(){return m.withMessage(d("validation.required"),C),t.showExchangeRate}),decimal:m.withMessage(d("validation.valid_exchange_rate"),ye)}}})),l=xe(L,t,{$scope:j}),R=$({get:()=>t.currentExpense.amount/100,set:a=>{t.currentExpense.amount=Math.round(a*100)}}),c=$(()=>v.name==="expenses.edit"),P=$(()=>c.value?d("expenses.edit_expense"):d("expenses.new_expense")),O=$(()=>c.value?`/reports/expenses/${v.params.id}/download-receipt`:"");t.resetCurrentExpenseData(),G.resetCustomFields(),W();function z(a,n){t.currentExpense.attachment_receipt=n}function H(){t.currentExpense.attachment_receipt=null,I.value=!0}function X(){A.openModal({title:d("settings.expense_category.add_category"),componentName:"CategoryModal",size:"sm"})}function J(a){t.currentExpense.selectedCurrency=D.currencies.find(n=>n.id===a)}async function K(a){let n=await f.fetchCategories({search:a});if(n.data.data.length>0&&f.editCategory&&!n.data.data.find(p=>p.id==f.editCategory.id)){let p=Object.assign({},f.editCategory);n.data.data.unshift(p)}return n.data.data}async function Q(a){let n=await _.fetchCustomers({search:a});if(n.data.data.length>0&&_.editCustomer&&!n.data.data.find(p=>p.id==_.editCustomer.id)){let p=Object.assign({},_.editCustomer);n.data.data.unshift(p)}return n.data.data}async function W(){if(c.value||(t.currentExpense.currency_id=U.selectedCompanyCurrency.id,t.currentExpense.selectedCurrency=U.selectedCompanyCurrency),i.value=!0,await t.fetchPaymentModes({limit:"all"}),c.value){const a=await t.fetchExpense(v.params.id);t.currentExpense.currency_id=t.currentExpense.selectedCurrency.id,a.data&&(!f.editCategory&&a.data.data.expense_category&&(f.editCategory=a.data.data.expense_category),!_.editCustomer&&a.data.data.customer&&(_.editCustomer=a.data.data.customer))}else v.query.customer&&(t.currentExpense.customer_id=v.query.customer);i.value=!1}async function Y(){if(l.value.$touch(),l.value.$invalid)return;g.value=!0;let a=t.currentExpense;try{c.value?await t.updateExpense({id:v.params.id,data:a,isAttachmentReceiptRemoved:I.value}):await t.addExpense(a),g.value=!1,t.currentExpense.attachment_receipt=null,I.value=!1,T.push("/admin/expenses")}catch(n){console.error(n),g.value=!1;return}}return ie(()=>{t.resetCurrentExpenseData(),_.editCustomer=null,f.editCategory=null}),(a,n)=>{const b=u("BaseBreadcrumbItem"),p=u("BaseBreadcrumb"),B=u("BaseIcon"),M=u("BaseButton"),Z=u("BasePageHeader"),ee=u("BaseSelectAction"),V=u("BaseMultiselect"),x=u("BaseInputGroup"),te=u("BaseDatePicker"),ne=u("BaseMoney"),ae=u("BaseTextarea"),re=u("BaseFileUploader"),oe=u("BaseInputGrid"),se=u("BaseCard"),le=u("BasePage");return y(),ue(ce,null,[r(we),r(le,{class:"relative"},{default:s(()=>[q("form",{action:"",onSubmit:de(Y,["prevent"])},[r(Z,{title:P.value,class:"mb-5"},{actions:s(()=>[c.value&&e(t).currentExpense.attachment_receipt_url?(y(),E(M,{key:0,href:O.value,tag:"a",variant:"primary-outline",type:"button",class:"mr-2"},{left:s(o=>[r(B,{name:"DownloadIcon",class:F(o.class)},null,8,["class"])]),default:s(()=>[w(" "+S(a.$t("expenses.download_receipt")),1)]),_:1},8,["href"])):h("",!0),q("div",Me,[r(M,{loading:e(g),"content-loading":e(i),disabled:e(g),variant:"primary",type:"submit"},{left:s(o=>[e(g)?h("",!0):(y(),E(B,{key:0,name:"SaveIcon",class:F(o.class)},null,8,["class"]))]),default:s(()=>[w(" "+S(c.value?a.$t("expenses.update_expense"):a.$t("expenses.save_expense")),1)]),_:1},8,["loading","content-loading","disabled"])])]),default:s(()=>[r(p,null,{default:s(()=>[r(b,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(b,{title:a.$tc("expenses.expense",2),to:"/admin/expenses"},null,8,["title"]),r(b,{title:P.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(se,null,{default:s(()=>[r(oe,null,{default:s(()=>[r(x,{label:a.$t("expenses.category"),error:e(l).currentExpense.expense_category_id.$error&&e(l).currentExpense.expense_category_id.$errors[0].$message,"content-loading":e(i),required:""},{default:s(()=>[e(i)?h("",!0):(y(),E(V,{key:0,modelValue:e(t).currentExpense.expense_category_id,"onUpdate:modelValue":n[0]||(n[0]=o=>e(t).currentExpense.expense_category_id=o),"content-loading":e(i),"value-prop":"id",label:"name","track-by":"id",options:K,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",invalid:e(l).currentExpense.expense_category_id.$error,placeholder:a.$t("expenses.categories.select_a_category"),onInput:n[1]||(n[1]=o=>e(l).currentExpense.expense_category_id.$touch())},{action:s(()=>[r(ee,{onClick:X},{default:s(()=>[r(B,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),w(" "+S(a.$t("settings.expense_category.add_new_category")),1)]),_:1})]),_:1},8,["modelValue","content-loading","invalid","placeholder"]))]),_:1},8,["label","error","content-loading"]),r(x,{label:a.$t("expenses.expense_date"),error:e(l).currentExpense.expense_date.$error&&e(l).currentExpense.expense_date.$errors[0].$message,"content-loading":e(i),required:""},{default:s(()=>[r(te,{modelValue:e(t).currentExpense.expense_date,"onUpdate:modelValue":n[2]||(n[2]=o=>e(t).currentExpense.expense_date=o),"content-loading":e(i),"calendar-button":!0,invalid:e(l).currentExpense.expense_date.$error,onInput:n[3]||(n[3]=o=>e(l).currentExpense.expense_date.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(x,{label:a.$t("expenses.amount"),error:e(l).currentExpense.amount.$error&&e(l).currentExpense.amount.$errors[0].$message,"content-loading":e(i),required:""},{default:s(()=>[(y(),E(ne,{key:e(t).currentExpense.selectedCurrency,modelValue:R.value,"onUpdate:modelValue":n[4]||(n[4]=o=>R.value=o),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(l).currentExpense.amount.$error,currency:e(t).currentExpense.selectedCurrency,onInput:n[5]||(n[5]=o=>e(l).currentExpense.amount.$touch())},null,8,["modelValue","invalid","currency"]))]),_:1},8,["label","error","content-loading"]),r(x,{label:a.$t("expenses.currency"),"content-loading":e(i),error:e(l).currentExpense.currency_id.$error&&e(l).currentExpense.currency_id.$errors[0].$message,required:""},{default:s(()=>[r(V,{modelValue:e(t).currentExpense.currency_id,"onUpdate:modelValue":[n[6]||(n[6]=o=>e(t).currentExpense.currency_id=o),J],"value-prop":"id",label:"name","track-by":"name","content-loading":e(i),options:e(D).currencies,searchable:"","can-deselect":!1,placeholder:a.$t("customers.select_currency"),invalid:e(l).currentExpense.currency_id.$error,class:"w-full"},null,8,["modelValue","content-loading","options","placeholder","invalid"])]),_:1},8,["label","content-loading","error"]),r(Se,{store:e(t),"store-prop":"currentExpense",v:e(l).currentExpense,"is-loading":e(i),"is-edit":c.value,"customer-currency":e(t).currentExpense.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"]),r(x,{"content-loading":e(i),label:a.$t("expenses.customer")},{default:s(()=>[e(i)?h("",!0):(y(),E(V,{key:0,modelValue:e(t).currentExpense.customer_id,"onUpdate:modelValue":n[7]||(n[7]=o=>e(t).currentExpense.customer_id=o),"content-loading":e(i),"value-prop":"id",label:"name","track-by":"id",options:Q,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",placeholder:a.$t("customers.select_a_customer")},null,8,["modelValue","content-loading","placeholder"]))]),_:1},8,["content-loading","label"]),r(x,{"content-loading":e(i),label:a.$t("payments.payment_mode")},{default:s(()=>[r(V,{modelValue:e(t).currentExpense.payment_method_id,"onUpdate:modelValue":n[8]||(n[8]=o=>e(t).currentExpense.payment_method_id=o),"content-loading":e(i),label:"name","value-prop":"id","track-by":"name",options:e(t).paymentModes,placeholder:a.$t("payments.select_payment_mode"),searchable:""},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(x,{"content-loading":e(i),label:a.$t("expenses.note"),error:e(l).currentExpense.notes.$error&&e(l).currentExpense.notes.$errors[0].$message},{default:s(()=>[r(ae,{modelValue:e(t).currentExpense.notes,"onUpdate:modelValue":n[9]||(n[9]=o=>e(t).currentExpense.notes=o),"content-loading":e(i),row:4,rows:"4",onInput:n[10]||(n[10]=o=>e(l).currentExpense.notes.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label","error"]),r(x,{label:a.$t("expenses.receipt")},{default:s(()=>[r(re,{modelValue:e(t).currentExpense.receiptFiles,"onUpdate:modelValue":n[11]||(n[11]=o=>e(t).currentExpense.receiptFiles=o),accept:"image/*,.doc,.docx,.pdf,.csv,.xlsx,.xls",onChange:z,onRemove:H},null,8,["modelValue"])]),_:1},8,["label"]),r(Ve,{"is-edit":c.value,class:"col-span-2","is-loading":e(i),type:"Expense",store:e(t),"store-prop":"currentExpense","custom-field-scope":j},null,8,["is-edit","is-loading","store"]),q("div",ke,[r(M,{loading:e(g),tabindex:6,variant:"primary",type:"submit",class:"flex justify-center w-full"},{left:s(o=>[e(g)?h("",!0):(y(),E(B,{key:0,name:"SaveIcon",class:F(o.class)},null,8,["class"]))]),default:s(()=>[w(" "+S(c.value?a.$t("expenses.update_expense"):a.$t("expenses.save_expense")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})],40,Ie)]),_:1})],64)}}};export{it as default};
