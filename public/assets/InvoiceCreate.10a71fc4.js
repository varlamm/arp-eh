import{O as s,j as d,M as P,l as o,u as t,U as a,r as C,a as I,e as z,k as b,R as k,P as y,X as L,g as A,as as X,by as Y,F as J}from"./@vue.8cc12e6e.js";import{u as K,b as Q}from"./vue-router.746ec05f.js";import{v as W}from"./vue-i18n.c6de3223.js";import{c as _,r as $,b as Z,a as ee,f as te,d as oe}from"./@vuelidate.c7422de1.js";import{i as F,b as ne,m as ie,r as ae}from"./main.f5ac513d.js";import{_ as se,a as re,b as le,c as ce,d as ue,e as de,f as me}from"./SalesTax.6c6ba50a.js";import{_ as ve}from"./ExchangeRateConverter.8557ba74.js";import{_ as pe}from"./CreateCustomFields.52efad8b.js";import{_ as ge}from"./TaxTypeModal.0de294f9.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./vuedraggable.e15681bc.js";import"./sortablejs.79e2f684.js";import"./DragIcon.20becf7b.js";import"./SelectNotePopup.9871fb7b.js";import"./NoteModal.86bd9d44.js";import"./payment.333e3a22.js";import"./exchange-rate.b16bc248.js";const _e={class:"grid grid-cols-12 gap-8 mt-6 mb-8"},fe={__name:"InvoiceCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const e=F();return(m,r)=>{const B=s("BaseCustomerSelectPopup"),l=s("BaseDatePicker"),v=s("BaseInputGroup"),S=s("BaseInput"),u=s("BaseInputGrid");return d(),P("div",_e,[o(B,{modelValue:t(e).newInvoice.customer,"onUpdate:modelValue":r[0]||(r[0]=c=>t(e).newInvoice.customer=c),valid:n.v.customer_id,"content-loading":n.isLoading,type:"invoice",class:"col-span-12 lg:col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),o(u,{class:"col-span-12 lg:col-span-7"},{default:a(()=>[o(v,{label:m.$t("invoices.invoice_date"),"content-loading":n.isLoading,required:"",error:n.v.invoice_date.$error&&n.v.invoice_date.$errors[0].$message},{default:a(()=>[o(l,{modelValue:t(e).newInvoice.invoice_date,"onUpdate:modelValue":r[1]||(r[1]=c=>t(e).newInvoice.invoice_date=c),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(v,{label:m.$t("invoices.due_date"),"content-loading":n.isLoading},{default:a(()=>[o(l,{modelValue:t(e).newInvoice.due_date,"onUpdate:modelValue":r[2]||(r[2]=c=>t(e).newInvoice.due_date=c),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),o(v,{label:m.$t("invoices.invoice_number"),"content-loading":n.isLoading,error:n.v.invoice_number.$error&&n.v.invoice_number.$errors[0].$message,required:""},{default:a(()=>[o(S,{modelValue:t(e).newInvoice.invoice_number,"onUpdate:modelValue":r[3]||(r[3]=c=>t(e).newInvoice.invoice_number=c),"content-loading":n.isLoading,onInput:r[4]||(r[4]=c=>n.v.invoice_number.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),o(ve,{store:t(e),"store-prop":"newInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":t(e).newInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},Ie=["onSubmit"],be={class:"flex"},we={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},ye={class:"relative w-full lg:w-1/2 lg:mr-4"},V="newInvoice",ot={__name:"InvoiceCreate",setup(n){const e=F(),m=ne(),r=ie(),B=ae(),{t:l}=W.useI18n();let v=K(),S=Q(),u=C(!1);const c=C(!1),M=C(["customer","company","customerCustom","invoice","invoiceCustom"]);let f=I(()=>e.isFetchingInvoice||e.isFetchingInitialSettings),T=I(()=>p.value?l("invoices.edit_invoice"):l("invoices.new_invoice"));const x=I(()=>m.selectedCompanySettings.sales_tax_us_enabled==="YES"&&B.salesTaxUSEnabled);let p=I(()=>v.name==="invoices.edit");const E={invoice_date:{required:_.withMessage(l("validation.required"),$)},reference_number:{maxLength:_.withMessage(l("validation.price_maxlength"),Z(255))},customer_id:{required:_.withMessage(l("validation.required"),$)},invoice_number:{required:_.withMessage(l("validation.required"),$)},exchange_rate:{required:ee(function(){return _.withMessage(l("validation.required"),$),e.showExchangeRate}),decimal:_.withMessage(l("validation.valid_exchange_rate"),te)}},w=oe(E,I(()=>e.newInvoice),{$scope:V});r.resetCustomFields(),w.value.$reset,e.resetCurrentInvoice(),e.fetchInvoiceInitialSettings(p.value),z(()=>e.newInvoice.customer,i=>{i&&i.currency?e.newInvoice.selectedCurrency=i.currency:e.newInvoice.selectedCurrency=m.selectedCompanyCurrency});async function U(){if(w.value.$touch(),w.value.$invalid)return!1;u.value=!0;let i={...e.newInvoice,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};try{const g=await(p.value?e.updateInvoice:e.addInvoice)(i);S.push(`/admin/invoices/${g.data.data.id}/view`)}catch(h){console.error(h)}u.value=!1}return(i,h)=>{const g=s("BaseBreadcrumbItem"),N=s("BaseBreadcrumb"),q=s("BaseButton"),j=s("router-link"),D=s("BaseIcon"),G=s("BasePageHeader"),R=s("BaseScrollPane"),H=s("BasePage");return d(),P(J,null,[o(se),o(re),o(ge),x.value&&(!t(f)||t(v).query.customer)?(d(),b(le,{key:0,store:t(e),"is-edit":t(p),"store-prop":"newInvoice",customer:t(e).newInvoice.customer},null,8,["store","is-edit","customer"])):k("",!0),o(H,{class:"relative invoice-create-page"},{default:a(()=>[y("form",{onSubmit:Y(U,["prevent"])},[o(G,{title:t(T)},{actions:a(()=>[i.$route.name==="invoices.edit"?(d(),b(j,{key:0,to:`/invoices/pdf/${t(e).newInvoice.unique_hash}`,target:"_blank"},{default:a(()=>[o(q,{class:"mr-3",variant:"primary-outline",type:"button"},{default:a(()=>[y("span",be,L(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):k("",!0),o(q,{loading:t(u),disabled:t(u),variant:"primary",type:"submit"},{left:a(O=>[t(u)?k("",!0):(d(),b(D,{key:0,name:"SaveIcon",class:A(O.class)},null,8,["class"]))]),default:a(()=>[X(" "+L(i.$t("invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:a(()=>[o(N,null,{default:a(()=>[o(g,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),o(g,{title:i.$tc("invoices.invoice",2),to:"/admin/invoices"},null,8,["title"]),i.$route.name==="invoices.edit"?(d(),b(g,{key:0,title:i.$t("invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(d(),b(g,{key:1,title:i.$t("invoices.new_invoice"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),o(fe,{v:t(w),"is-loading":t(f),"is-edit":t(p)},null,8,["v","is-loading","is-edit"]),o(R,null,{default:a(()=>[o(ce,{currency:t(e).newInvoice.selectedCurrency,"is-loading":t(f),"item-validation-scope":V,store:t(e),"store-prop":"newInvoice"},null,8,["currency","is-loading","store"]),y("div",we,[y("div",ye,[o(ue,{store:t(e),"store-prop":"newInvoice",fields:M.value,type:"Invoice"},null,8,["store","fields"]),o(pe,{type:"Invoice","is-edit":t(p),"is-loading":t(f),store:t(e),"store-prop":"newInvoice","custom-field-scope":V,class:"mb-6"},null,8,["is-edit","is-loading","store"]),o(de,{store:t(e),"store-prop":"newInvoice","component-name":"InvoiceTemplate","is-mark-as-default":c.value},null,8,["store","is-mark-as-default"])]),o(me,{currency:t(e).newInvoice.selectedCurrency,"is-loading":t(f),store:t(e),"store-prop":"newInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Ie)]),_:1})],64)}}};export{ot as default};
