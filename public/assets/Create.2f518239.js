import{r as b,a as w,O as u,j as B,k as V,U as i,l as o,P as h,u as e,M as A,aW as O,F as W,g as X,R as J,as as K,X as Q,by as Y}from"./@vue.8cc12e6e.js";import{u as Z,b as x}from"./vue-router.746ec05f.js";import{b as ee}from"./main.f5ac513d.js";import{c as m,r as v,d as ae,g as te,m as C,e as oe,a as re}from"./@vuelidate.c7422de1.js";import{v as se}from"./vue-i18n.c6de3223.js";import{u as ne}from"./users.aa10f6e7.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";const le=["onSubmit"],ie={class:"grid grid-cols-12"},ue={class:"space-y-6"},Le={__name:"Create",setup(de){const a=ne(),{t:d}=se.useI18n(),y=Z(),S=x(),k=ee();let p=b(!1),n=b(!1);b([]);let I=b([]);const c=w(()=>y.name==="users.edit"),q=w(()=>c.value?d("users.edit_user"):d("users.new_user")),P=w(()=>({userData:{name:{required:m.withMessage(d("validation.required"),v),minLength:m.withMessage(d("validation.name_min_length",{count:3}),C(3))},email:{required:m.withMessage(d("validation.required"),v),email:m.withMessage(d("validation.email_incorrect"),oe)},password:{required:re(function(){return m.withMessage(d("validation.required"),v),!c.value}),minLength:m.withMessage(d("validation.password_min_length",{count:8}),C(8))},companies:{required:m.withMessage(d("validation.required"),v)}}})),G={role:{required:m.withMessage(d("validation.required"),v)}},r=ae(P,a,{$scope:!0});L(),a.resetUserData();async function L(){n.value=!0;try{c.value&&await a.fetchUser(y.params.id);let l=await k.fetchUserCompanies();l?.data?.data&&(I.value=l.data.data.map(t=>(t.role=null,t)))}catch{n.value=!1}n.value=!1}async function N(){if(r.value.$touch(),r.value.$invalid)return!0;try{p.value=!0;let l={...a.userData,companies:a.userData.companies.map(g=>({role:g.role,id:g.id}))};await(c.value?a.updateUser:a.addUser)(l),S.push("/admin/users"),p.value=!1}catch{p.value=!1}}return(l,t)=>{const g=u("BaseBreadcrumbItem"),R=u("BaseBreadcrumb"),j=u("BasePageHeader"),$=u("BaseInput"),f=u("BaseInputGroup"),M=u("BaseMultiselect"),E=u("BaseInputGrid"),F=u("BaseIcon"),H=u("BaseButton"),T=u("BaseCard"),z=u("BasePage");return B(),V(z,null,{default:i(()=>[o(j,{title:q.value},{default:i(()=>[o(R,null,{default:i(()=>[o(g,{title:l.$t("general.home"),to:"dashboard"},null,8,["title"]),o(g,{title:l.$tc("users.user",2),to:"/admin/users"},null,8,["title"]),o(g,{title:q.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),h("form",{action:"",autocomplete:"off",onSubmit:Y(N,["prevent"])},[h("div",ie,[o(T,{class:"mt-6 col-span-12 md:col-span-8"},{default:i(()=>[o(E,{layout:"one-column"},{default:i(()=>[o(f,{"content-loading":e(n),label:l.$t("users.name"),error:e(r).userData.name.$error&&e(r).userData.name.$errors[0].$message,required:""},{default:i(()=>[o($,{modelValue:e(a).userData.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e(a).userData.name=s),modelModifiers:{trim:!0},"content-loading":e(n),invalid:e(r).userData.name.$error,onInput:t[1]||(t[1]=s=>e(r).userData.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o(f,{"content-loading":e(n),label:l.$t("users.email"),error:e(r).userData.email.$error&&e(r).userData.email.$errors[0].$message,required:""},{default:i(()=>[o($,{modelValue:e(a).userData.email,"onUpdate:modelValue":t[2]||(t[2]=s=>e(a).userData.email=s),modelModifiers:{trim:!0},type:"email","content-loading":e(n),invalid:e(r).userData.email.$error,onInput:t[3]||(t[3]=s=>e(r).userData.email.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o(f,{"content-loading":e(n),label:l.$t("users.companies"),error:e(r).userData.companies.$error&&e(r).userData.companies.$errors[0].$message,required:""},{default:i(()=>[o(M,{modelValue:e(a).userData.companies,"onUpdate:modelValue":t[4]||(t[4]=s=>e(a).userData.companies=s),mode:"tags",object:!0,autocomplete:"new-password",label:"name",options:e(I),"value-prop":"id",invalid:e(r).userData.companies.$error,"content-loading":e(n),searchable:"","can-deselect":!1,class:"w-full","track-by":"name"},null,8,["modelValue","options","invalid","content-loading"])]),_:1},8,["content-loading","label","error"]),(B(!0),A(W,null,O(e(a).userData.companies,(s,D)=>(B(),V(e(te),{key:D,state:s,rules:G},{default:i(({v:_})=>[h("div",ue,[o(f,{"content-loading":e(n),label:l.$t("users.select_company_role",{company:s.name}),error:_.role.$error&&_.role.$errors[0].$message,required:""},{default:i(()=>[o(M,{modelValue:e(a).userData.companies[D].role,"onUpdate:modelValue":U=>e(a).userData.companies[D].role=U,"value-prop":"name","track-by":"id",autocomplete:"off","content-loading":e(n),label:"name",options:e(a).userData.companies[D].roles,"can-deselect":!1,invalid:_.role.$invalid,onChange:U=>_.role.$touch()},null,8,["modelValue","onUpdate:modelValue","content-loading","options","invalid","onChange"])]),_:2},1032,["content-loading","label","error"])])]),_:2},1032,["state"]))),128)),o(f,{"content-loading":e(n),label:l.$tc("users.password"),error:e(r).userData.password.$error&&e(r).userData.password.$errors[0].$message,required:!c.value},{default:i(()=>[o($,{modelValue:e(a).userData.password,"onUpdate:modelValue":t[5]||(t[5]=s=>e(a).userData.password=s),name:"new-password",autocomplete:"new-password","content-loading":e(n),type:"password",invalid:e(r).userData.password.$error,onInput:t[6]||(t[6]=s=>e(r).userData.password.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error","required"]),o(f,{"content-loading":e(n),label:l.$t("users.phone")},{default:i(()=>[o($,{modelValue:e(a).userData.phone,"onUpdate:modelValue":t[7]||(t[7]=s=>e(a).userData.phone=s),modelModifiers:{trim:!0},"content-loading":e(n)},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label"])]),_:1}),o(H,{"content-loading":e(n),type:"submit",loading:e(p),disabled:e(p),class:"mt-6"},{left:i(s=>[e(p)?J("",!0):(B(),V(F,{key:0,name:"SaveIcon",class:X(s.class)},null,8,["class"]))]),default:i(()=>[K(" "+Q(c.value?l.$t("users.update_user"):l.$t("users.save_user")),1)]),_:1},8,["content-loading","loading","disabled"])]),_:1})])],40,le)]),_:1})}}};export{Le as default};
