import{u as A,b as P}from"./vue-router.746ec05f.js";import{v as O}from"./vue-i18n.c6de3223.js";import{t as T,e as z,g as S,j as Q}from"./main.f5ac513d.js";import{l as Y}from"./lodash.8ab3583e.js";import{L as Z}from"./LoadingIcon.f4bad6f3.js";import{r as I,f as ee,a as C,O as i,j as d,M as k,P as g,l as t,U as a,X as b,k as f,F as H,aW as te,as as $,g as ne,R as B,i as ae,aq as oe,u as r,e as re}from"./@vue.8cc12e6e.js";import{_ as ie}from"./InvoiceIndexDropdown.86fb0c41.js";import{_ as se}from"./SendInvoiceModal.b7b34c34.js";import{_ as le}from"./RecurringInvoiceIndexDropdown.58239022.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./mail-driver.f62a08cc.js";const ce={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.4rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},ue={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},de={class:"mb-6"},me={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},_e={class:"px-2 py-1 pb-2 mb-1 mb-2 text-sm border-b border-gray-200 border-solid"},pe={class:"flex-2"},ve={class:"mt-1 mb-2 text-xs not-italic font-medium leading-5 text-gray-600"},ge={class:"flex-1 whitespace-nowrap right"},fe={class:"text-sm not-italic font-normal leading-5 text-right text-gray-600 est-date"},ye={key:0,class:"flex justify-center p-4 items-center"},be={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ie={__name:"RecurringInvoiceViewSidebar",setup(D){const n=T();O.useI18n();const _=A(),o=I(!1),m=I(null),u=I(1),h=I(1),y=I(null),e=ee({orderBy:null,orderByField:null,searchText:null}),x=C(()=>e.orderBy==="asc"||e.orderBy==null);function w(s){return _.params.id==s}async function R(s,p=!1){if(o.value)return;let v={};e.searchText!==""&&e.searchText!==null&&e.searchText!==void 0&&(v.search=e.searchText),e.orderBy!==null&&e.orderBy!==void 0&&(v.orderBy=e.orderBy),e.orderByField!==null&&e.orderByField!==void 0&&(v.orderByField=e.orderByField),o.value=!0;let E=await n.fetchRecurringInvoices({page:s,...v});o.value=!1,m.value=m.value?m.value:[],m.value=[...m.value,...E.data.data],u.value=s||1,h.value=E.data.meta.last_page;let V=m.value.find(F=>F.id==_.params.id);p==!1&&!V&&u.value<h.value&&Object.keys(v).length===0&&R(++u.value),V&&setTimeout(()=>{p==!1&&N()},500)}function N(){const s=document.getElementById(`recurring-invoice-${_.params.id}`);s&&(s.scrollIntoView({behavior:"smooth"}),s.classList.add("shake"),L())}function L(){y.value.addEventListener("scroll",s=>{s.target.scrollTop>0&&s.target.scrollTop+s.target.clientHeight>s.target.scrollHeight-200&&u.value<h.value&&R(++u.value,!0)})}async function l(){m.value=[],R()}function M(){return e.orderBy==="asc"?(e.orderBy="desc",l(),!0):(e.orderBy="asc",l(),!0)}return R(),l=Y.exports.debounce(l,500),(s,p)=>{const v=i("BaseIcon"),E=i("BaseInput"),V=i("BaseButton"),F=i("BaseRadio"),j=i("BaseInputGroup"),U=i("BaseDropdownItem"),q=i("BaseDropdown"),G=i("BaseText"),W=i("BaseRecurringInvoiceStatusBadge"),X=i("BaseFormatMoney"),J=i("router-link");return d(),k("div",ce,[g("div",ue,[g("div",de,[t(E,{modelValue:e.searchText,"onUpdate:modelValue":p[0]||(p[0]=c=>e.searchText=c),placeholder:s.$t("general.search"),type:"text",variant:"gray",onInput:p[1]||(p[1]=c=>l())},{right:a(()=>[t(v,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"])]),g("div",me,[t(q,{class:"ml-3",position:"bottom-start"},{activator:a(()=>[t(V,{size:"md",variant:"gray"},{default:a(()=>[t(v,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:a(()=>[g("div",_e,b(s.$t("general.sort_by")),1),t(U,{class:"flex px-1 py-2 cursor-pointer"},{default:a(()=>[t(j,{class:"-mt-3 font-normal"},{default:a(()=>[t(F,{id:"filter_next_invoice_date",modelValue:e.orderByField,"onUpdate:modelValue":[p[2]||(p[2]=c=>e.orderByField=c),l],label:s.$t("recurring_invoices.next_invoice_date"),size:"sm",name:"filter",value:"next_invoice_at"},null,8,["modelValue","label"])]),_:1})]),_:1}),t(U,{class:"flex px-1 py-2 cursor-pointer"},{default:a(()=>[t(j,{class:"-mt-3 font-normal"},{default:a(()=>[t(F,{id:"filter_start_date",modelValue:e.orderByField,"onUpdate:modelValue":[p[3]||(p[3]=c=>e.orderByField=c),l],label:s.$t("recurring_invoices.starts_at"),value:"starts_at",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1}),t(V,{class:"ml-1",size:"md",variant:"gray",onClick:M},{default:a(()=>[x.value?(d(),f(v,{key:0,name:"SortAscendingIcon",class:"h-5"})):(d(),f(v,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),g("div",{ref_key:"invoiceListSection",ref:y,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid base-scroll"},[(d(!0),k(H,null,te(m.value,(c,K)=>(d(),k("div",{key:K},[c?(d(),f(J,{key:0,id:"recurring-invoice-"+c.id,to:`/admin/recurring-invoices/${c.id}/view`,class:ne(["flex justify-between side-invoice p-4 cursor-pointer hover:bg-gray-100 items-center border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":w(c.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:a(()=>[g("div",pe,[t(G,{text:c.customer.name,length:30,class:"pr-2 mb-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),g("div",ve,b(c.invoice_number),1),t(W,{status:c.status,class:"px-1 text-xs"},{default:a(()=>[$(b(c.status),1)]),_:2},1032,["status"])]),g("div",ge,[t(X,{class:"block mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900",amount:c.total,currency:c.customer.currency},null,8,["amount","currency"]),g("div",fe,b(c.formatted_starts_at),1)])]),_:2},1032,["id","to","class"])):B("",!0)]))),128)),o.value?(d(),k("div",ye,[t(Z,{class:"h-6 m-1 animate-spin text-primary-400"})])):B("",!0),!m.value?.length&&!o.value?(d(),k("p",be,b(s.$t("invoices.no_matching_invoices")),1)):B("",!0)],512)])}}},Be={class:"relative table-container"},he={__name:"Invoices",setup(D){const n=T(),_=I(null);I(null),ae("$utils");const{t:o}=O.useI18n();I(null),P();const m=z(),u=C(()=>[{key:"invoice_date",label:o("invoices.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"invoice_number",label:o("invoices.invoice")},{key:"customer.name",label:o("invoices.customer")},{key:"status",label:o("invoices.status")},{key:"total",label:o("invoices.total")},{key:"actions",label:o("invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);function h(){return m.hasAbilities([S.DELETE_INVOICE,S.EDIT_INVOICE,S.VIEW_INVOICE,S.SEND_INVOICE])}function y(e){let x=n.newRecurringInvoice.invoices.findIndex(w=>w.id===e);n.newRecurringInvoice.invoices[x]&&(n.newRecurringInvoice.invoices[x].status="SENT")}return(e,x)=>{const w=i("router-link"),R=i("BaseFormatMoney"),N=i("BaseInvoiceStatusBadge"),L=i("BaseTable");return d(),k(H,null,[t(se,{onUpdate:y}),g("div",Be,[t(L,{ref_key:"table",ref:_,data:r(n).newRecurringInvoice.invoices,columns:u.value,loading:r(n).isFetchingViewData,"placeholder-count":5,class:"mt-5"},oe({"cell-invoice_number":a(({row:l})=>[t(w,{to:{path:`/admin/invoices/${l.data.id}/view`},class:"font-medium text-primary-500"},{default:a(()=>[$(b(l.data.invoice_number),1)]),_:2},1032,["to"])]),"cell-total":a(({row:l})=>[t(R,{amount:l.data.due_amount,currency:l.data.currency},null,8,["amount","currency"])]),"cell-status":a(({row:l})=>[t(N,{status:l.data.status,class:"px-3 py-1"},{default:a(()=>[$(b(l.data.status),1)]),_:2},1032,["status"])]),_:2},[h()?{name:"cell-actions",fn:a(({row:l})=>[t(ie,{row:l.data,table:_.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["data","columns","loading"])])],64)}}},xe={__name:"RecurringInvoiceInfo",setup(D){const n=T(),_=A();let o=C(()=>n.isFetchingViewData);re(_,()=>{_.params.id&&_.name==="recurring-invoices.view"&&m()},{immediate:!0});async function m(){await n.fetchRecurringInvoice(_.params.id)}return(u,h)=>{const y=i("BaseHeading"),e=i("BaseDescriptionListItem"),x=i("BaseDescriptionList"),w=i("BaseCard");return d(),f(w,{class:"mt-10"},{default:a(()=>[t(y,null,{default:a(()=>[$(b(u.$t("customers.basic_info")),1)]),_:1}),t(x,{class:"mt-5"},{default:a(()=>[t(e,{label:u.$t("recurring_invoices.starts_at"),"content-loading":r(o),value:r(n).newRecurringInvoice?.formatted_starts_at},null,8,["label","content-loading","value"]),t(e,{label:u.$t("recurring_invoices.next_invoice_date"),"content-loading":r(o),value:r(n).newRecurringInvoice?.formatted_next_invoice_at},null,8,["label","content-loading","value"]),r(n).newRecurringInvoice?.limit_date&&r(n).newRecurringInvoice?.limit_by!=="NONE"?(d(),f(e,{key:0,label:u.$t("recurring_invoices.limit_date"),"content-loading":r(o),value:r(n).newRecurringInvoice?.limit_date},null,8,["label","content-loading","value"])):B("",!0),r(n).newRecurringInvoice?.limit_date&&r(n).newRecurringInvoice?.limit_by!=="NONE"?(d(),f(e,{key:1,label:u.$t("recurring_invoices.limit_by"),"content-loading":r(o),value:r(n).newRecurringInvoice?.limit_by},null,8,["label","content-loading","value"])):B("",!0),r(n).newRecurringInvoice?.limit_count?(d(),f(e,{key:2,label:u.$t("recurring_invoices.limit_count"),value:r(n).newRecurringInvoice?.limit_count,"content-loading":r(o)},null,8,["label","value","content-loading"])):B("",!0),r(n).newRecurringInvoice?.selectedFrequency?(d(),f(e,{key:3,label:u.$t("recurring_invoices.frequency.title"),value:r(n).newRecurringInvoice?.selectedFrequency?.label,"content-loading":r(o)},null,8,["label","value","content-loading"])):B("",!0)]),_:1}),t(y,{class:"mt-8"},{default:a(()=>[$(b(u.$t("invoices.title",2)),1)]),_:1}),t(he)]),_:1})}}},Ye={__name:"View",setup(D){Q();const n=T(),_=z();O.useI18n(),P();const o=C(()=>n.newRecurringInvoice?n.newRecurringInvoice?.customer?.name:"");function m(){return _.hasAbilities([S.DELETE_RECURRING_INVOICE,S.EDIT_RECURRING_INVOICE])}return(u,h)=>{const y=i("BasePageHeader"),e=i("BasePage");return d(),f(e,{class:"xl:pl-96"},{default:a(()=>[t(y,{title:o.value},{actions:a(()=>[m()?(d(),f(le,{key:0,row:r(n).newRecurringInvoice},null,8,["row"])):B("",!0)]),_:1},8,["title"]),t(Ie),t(xe)]),_:1})}}};export{Ye as default};
