import{r as T,f as oe,a as g,b as me,O as l,j as y,k as _,U as t,l as a,L as M,bx as N,u as i,g as B,as as d,X as c,R as V,aq as x,P as p}from"./@vue.8cc12e6e.js";import{v as re}from"./vue-i18n.c6de3223.js";import{b as ie,j as ue,e as ce,g as f}from"./main.f5ac513d.js";import{u as de}from"./payment.333e3a22.js";import{_ as pe}from"./CapsuleIcon.65ebf9b5.js";import{_ as ye,a as _e}from"./SendPaymentModal.5fa3a6e9.js";import{d as fe}from"./@vueuse.b6c5a1c1.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./vue-router.746ec05f.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./mail-driver.f62a08cc.js";const be={class:"relative table-container"},ve={class:"relative flex items-center justify-end h-5"},Be={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},he={class:"absolute items-center left-6 top-2.5 select-none"},ge={class:"relative block"},Je={__name:"Index",setup(ke){const{t:u}=re.useI18n();let b=T(!1),k=T(!0),h=T(null);const m=oe({customer:"",payment_mode:"",payment_number:""}),o=de();ie();const U=ue(),C=ce(),A=g(()=>!o.paymentTotalCount&&!k.value),Y=g(()=>[{key:"status",sortable:!1,thClass:"extra w-10",tdClass:"text-left text-sm font-medium extra"},{key:"payment_date",label:u("payments.date"),thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"payment_number",label:u("payments.payment_number")},{key:"name",label:u("payments.customer")},{key:"payment_mode",label:u("payments.payment_mode")},{key:"invoice_number",label:u("invoices.invoice_number")},{key:"amount",label:u("payments.amount")},{key:"actions",label:"",tdClass:"text-right text-sm font-medium",sortable:!1}]),E=g({get:()=>o.selectedPayments,set:n=>o.selectPayment(n)}),S=g({get:()=>o.selectAllField,set:n=>o.setSelectAllState(n)});fe(m,()=>{H()},{debounce:500}),me(()=>{o.selectAllField&&o.selectAllPayments()}),o.fetchPaymentModes({limit:"all"});async function j(n){return(await o.fetchPaymentModes({search:n})).data.data}function L(){return C.hasAbilities([f.DELETE_PAYMENT,f.EDIT_PAYMENT,f.VIEW_PAYMENT,f.SEND_PAYMENT])}async function W({page:n,filter:s,sort:v}){let P={customer_id:m.customer_id,payment_method_id:m.payment_mode!==null?m.payment_mode:"",payment_number:m.payment_number,orderByField:v.fieldName||"created_at",orderBy:v.order||"desc",page:n};k.value=!0;let r=await o.fetchPayments(P);return k.value=!1,{data:r.data.data,pagination:{totalPages:r.data.meta.last_page,currentPage:n,totalCount:r.data.meta.total,limit:10}}}function F(){h.value&&h.value.refresh()}function H(){F()}function w(){m.customer_id="",m.payment_mode="",m.payment_number=""}function R(){b.value&&w(),b.value=!b.value}function z(){U.openDialog({title:u("general.are_you_sure"),message:u("payments.confirm_delete",2),yesLabel:u("general.ok"),noLabel:u("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(n=>{n&&o.deleteMultiplePayments().then(s=>{s.data.success&&F()})})}return(n,s)=>{const v=l("BaseBreadcrumbItem"),P=l("BaseBreadcrumb"),r=l("BaseIcon"),I=l("BaseButton"),G=l("BasePageHeader"),O=l("BaseCustomerSelectInput"),$=l("BaseInputGroup"),X=l("BaseInput"),q=l("BaseMultiselect"),J=l("BaseFilterWrapper"),K=l("BaseEmptyPlaceholder"),Q=l("BaseDropdownItem"),Z=l("BaseDropdown"),D=l("BaseCheckbox"),ee=l("router-link"),te=l("BaseText"),ae=l("BaseFormatMoney"),ne=l("BaseTable"),le=l("BasePage");return y(),_(le,{class:"payments"},{default:t(()=>[a(ye),a(G,{title:n.$t("payments.title")},{actions:t(()=>[M(a(I,{variant:"primary-outline",onClick:R},{right:t(e=>[i(b)?(y(),_(r,{key:1,name:"XIcon",class:B(e.class)},null,8,["class"])):(y(),_(r,{key:0,class:B(e.class),name:"FilterIcon"},null,8,["class"]))]),default:t(()=>[d(c(n.$t("general.filter"))+" ",1)]),_:1},512),[[N,i(o).paymentTotalCount]]),i(C).hasAbilities(i(f).CREATE_PAYMENT)?(y(),_(I,{key:0,variant:"primary",class:"ml-4",onClick:s[0]||(s[0]=e=>n.$router.push("/admin/payments/create"))},{left:t(e=>[a(r,{name:"PlusIcon",class:B(e.class)},null,8,["class"])]),default:t(()=>[d(" "+c(n.$t("payments.add_payment")),1)]),_:1})):V("",!0)]),default:t(()=>[a(P,null,{default:t(()=>[a(v,{title:n.$t("general.home"),to:"dashboard"},null,8,["title"]),a(v,{title:n.$tc("payments.payment",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),a(J,{show:i(b),class:"mt-3",onClear:w},{default:t(()=>[a($,{label:n.$t("payments.customer")},{default:t(()=>[a(O,{modelValue:m.customer_id,"onUpdate:modelValue":s[1]||(s[1]=e=>m.customer_id=e),placeholder:n.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a($,{label:n.$t("payments.payment_number")},{default:t(()=>[a(X,{modelValue:m.payment_number,"onUpdate:modelValue":s[2]||(s[2]=e=>m.payment_number=e)},{left:t(e=>[a(r,{name:"HashtagIcon",class:B(e.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a($,{label:n.$t("payments.payment_mode")},{default:t(()=>[a(q,{modelValue:m.payment_mode,"onUpdate:modelValue":s[3]||(s[3]=e=>m.payment_mode=e),"value-prop":"id","track-by":"name","filter-results":!1,label:"name","resolve-on-load":"",delay:500,searchable:"",options:j},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["show"]),A.value?(y(),_(K,{key:0,title:n.$t("payments.no_payments"),description:n.$t("payments.list_of_payments")},x({default:t(()=>[a(pe,{class:"mt-5 mb-4"})]),_:2},[i(C).hasAbilities(i(f).CREATE_PAYMENT)?{name:"actions",fn:t(()=>[a(I,{variant:"primary-outline",onClick:s[4]||(s[4]=e=>n.$router.push("/admin/payments/create"))},{left:t(e=>[a(r,{name:"PlusIcon",class:B(e.class)},null,8,["class"])]),default:t(()=>[d(" "+c(n.$t("payments.add_new_payment")),1)]),_:1})]),key:"0"}:void 0]),1032,["title","description"])):V("",!0),M(p("div",be,[p("div",ve,[i(o).selectedPayments.length?(y(),_(Z,{key:0},{activator:t(()=>[p("span",Be,[d(c(n.$t("general.actions"))+" ",1),a(r,{name:"ChevronDownIcon"})])]),default:t(()=>[a(Q,{onClick:z},{default:t(()=>[a(r,{name:"TrashIcon",class:"mr-3 text-gray-600"}),d(" "+c(n.$t("general.delete")),1)]),_:1})]),_:1})):V("",!0)]),a(ne,{ref_key:"tableComponent",ref:h,data:W,columns:Y.value,"placeholder-count":i(o).paymentTotalCount>=20?10:5,class:"mt-3"},x({header:t(()=>[p("div",he,[a(D,{modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=e=>S.value=e),variant:"primary",onChange:i(o).selectAllPayments},null,8,["modelValue","onChange"])])]),"cell-status":t(({row:e})=>[p("div",ge,[a(D,{id:e.id,modelValue:E.value,"onUpdate:modelValue":s[6]||(s[6]=se=>E.value=se),value:e.data.id,variant:"primary"},null,8,["id","modelValue","value"])])]),"cell-payment_date":t(({row:e})=>[d(c(e.data.formatted_payment_date),1)]),"cell-payment_number":t(({row:e})=>[a(ee,{to:{path:`payments/${e.data.id}/view`},class:"font-medium text-primary-500"},{default:t(()=>[d(c(e.data.payment_number),1)]),_:2},1032,["to"])]),"cell-name":t(({row:e})=>[a(te,{text:e.data.customer.name,length:30,tag:"span"},null,8,["text"])]),"cell-payment_mode":t(({row:e})=>[p("span",null,c(e.data.payment_method?e.data.payment_method.name:"-"),1)]),"cell-invoice_number":t(({row:e})=>[p("span",null,c(e?.data?.invoice?.invoice_number?e?.data?.invoice?.invoice_number:"-"),1)]),"cell-amount":t(({row:e})=>[a(ae,{amount:e.data.amount,currency:e.data.customer.currency},null,8,["amount","currency"])]),_:2},[L()?{name:"cell-actions",fn:t(({row:e})=>[a(_e,{row:e.data,table:i(h)},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[N,!A.value]])]),_:1})}}};export{Je as default};
