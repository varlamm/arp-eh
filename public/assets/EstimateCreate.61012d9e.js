import{O as n,j as c,M as L,l as a,u as t,U as o,r as h,a as v,e as z,k as b,R as C,P as E,X as q,g as A,as as X,by as Y,F as J}from"./@vue.8cc12e6e.js";import{u as K,b as Q}from"./vue-router.746ec05f.js";import{v as W}from"./vue-i18n.c6de3223.js";import{c as _,r as w,b as Z,a as ee,f as te,d as ae}from"./@vuelidate.c7422de1.js";import{k as x,r as se,b as ie,m as oe}from"./main.f5ac513d.js";import{_ as ne,a as re,b as le,c as me,d as de,e as ue,f as ce}from"./SalesTax.6c6ba50a.js";import{_ as pe}from"./CreateCustomFields.52efad8b.js";import{_ as ge}from"./ExchangeRateConverter.8557ba74.js";import{_ as _e}from"./TaxTypeModal.0de294f9.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./vuedraggable.e15681bc.js";import"./sortablejs.79e2f684.js";import"./DragIcon.20becf7b.js";import"./SelectNotePopup.9871fb7b.js";import"./NoteModal.86bd9d44.js";import"./payment.333e3a22.js";import"./exchange-rate.b16bc248.js";const fe={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},ve={__name:"EstimateCreateBasicFields",props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const e=x();return(f,r)=>{const B=n("BaseCustomerSelectPopup"),l=n("BaseDatePicker"),d=n("BaseInputGroup"),$=n("BaseInput"),S=n("BaseInputGrid");return c(),L("div",fe,[a(B,{modelValue:t(e).newEstimate.customer,"onUpdate:modelValue":r[0]||(r[0]=m=>t(e).newEstimate.customer=m),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(S,{class:"col-span-7"},{default:o(()=>[a(d,{label:f.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:o(()=>[a(l,{modelValue:t(e).newEstimate.estimate_date,"onUpdate:modelValue":r[1]||(r[1]=m=>t(e).newEstimate.estimate_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(d,{label:f.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:o(()=>[a(l,{modelValue:t(e).newEstimate.expiry_date,"onUpdate:modelValue":r[2]||(r[2]=m=>t(e).newEstimate.expiry_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(d,{label:f.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:o(()=>[a($,{modelValue:t(e).newEstimate.estimate_number,"onUpdate:modelValue":r[3]||(r[3]=m=>t(e).newEstimate.estimate_number=m),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(ge,{store:t(e),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":t(e).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},be=["onSubmit"],ye={class:"flex"},Ee={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},we={class:"relative w-full lg:w-1/2"},k="newEstimate",at={__name:"EstimateCreate",setup(s){const e=x(),f=se(),r=ie(),B=oe(),{t:l}=W.useI18n();let d=h(!1);const $=h(!1),S=h(["customer","company","customerCustom","estimate","estimateCustom"]);let m=K(),P=Q(),p=v(()=>e.isFetchingInitialSettings),M=v(()=>g.value?l("estimates.edit_estimate"):l("estimates.new_estimate")),g=v(()=>m.name==="estimates.edit");const F=v(()=>r.selectedCompanySettings.sales_tax_us_enabled==="YES"&&f.salesTaxUSEnabled),T={estimate_date:{required:_.withMessage(l("validation.required"),w)},estimate_number:{required:_.withMessage(l("validation.required"),w)},reference_number:{maxLength:_.withMessage(l("validation.price_maxlength"),Z(255))},customer_id:{required:_.withMessage(l("validation.required"),w)},exchange_rate:{required:ee(function(){return _.withMessage(l("validation.required"),w),e.showExchangeRate}),decimal:_.withMessage(l("validation.valid_exchange_rate"),te)}},y=ae(T,v(()=>e.newEstimate),{$scope:k});z(()=>e.newEstimate.customer,i=>{i&&i.currency?e.newEstimate.selectedCurrency=i.currency:e.newEstimate.selectedCurrency=r.selectedCompanyCurrency}),e.resetCurrentEstimate(),B.resetCustomFields(),y.value.$reset,e.fetchEstimateInitialSettings(g.value);async function U(){if(y.value.$touch(),y.value.$invalid)return!1;d.value=!0;let i={...e.newEstimate,sub_total:e.getSubTotal,total:e.getTotal,tax:e.getTotalTax};const I=g.value?e.updateEstimate:e.addEstimate;try{let u=await I(i);u.data.data&&P.push(`/admin/estimates/${u.data.data.id}/view`)}catch(u){console.error(u)}d.value=!1}return(i,I)=>{const u=n("BaseBreadcrumbItem"),N=n("BaseBreadcrumb"),V=n("BaseButton"),j=n("router-link"),D=n("BaseIcon"),G=n("BasePageHeader"),R=n("BaseScrollPane"),H=n("BasePage");return c(),L(J,null,[a(ne),a(re),a(_e),F.value&&(!t(p)||t(m).query.customer)?(c(),b(le,{key:0,store:t(e),"store-prop":"newEstimate","is-edit":t(g),customer:t(e).newEstimate.customer},null,8,["store","is-edit","customer"])):C("",!0),a(H,{class:"relative estimate-create-page"},{default:o(()=>[E("form",{onSubmit:Y(U,["prevent"])},[a(G,{title:t(M)},{actions:o(()=>[i.$route.name==="estimates.edit"?(c(),b(j,{key:0,to:`/estimates/pdf/${t(e).newEstimate.unique_hash}`,target:"_blank"},{default:o(()=>[a(V,{class:"mr-3",variant:"primary-outline",type:"button"},{default:o(()=>[E("span",ye,q(i.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):C("",!0),a(V,{loading:t(d),disabled:t(d),"content-loading":t(p),variant:"primary",type:"submit"},{left:o(O=>[t(d)?C("",!0):(c(),b(D,{key:0,class:A(O.class),name:"SaveIcon"},null,8,["class"]))]),default:o(()=>[X(" "+q(i.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:o(()=>[a(N,null,{default:o(()=>[a(u,{title:i.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(u,{title:i.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),i.$route.name==="estimates.edit"?(c(),b(u,{key:0,title:i.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(c(),b(u,{key:1,title:i.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(ve,{v:t(y),"is-loading":t(p),"is-edit":t(g)},null,8,["v","is-loading","is-edit"]),a(R,null,{default:o(()=>[a(me,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(p),"item-validation-scope":k,store:t(e),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),E("div",Ee,[E("div",we,[a(de,{store:t(e),"store-prop":"newEstimate",fields:S.value,type:"Estimate"},null,8,["store","fields"]),a(pe,{type:"Estimate","is-edit":t(g),"is-loading":t(p),store:t(e),"store-prop":"newEstimate","custom-field-scope":k,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(ue,{store:t(e),"component-name":"EstimateTemplate","store-prop":"newEstimate","is-mark-as-default":$.value},null,8,["store","is-mark-as-default"])]),a(ce,{currency:t(e).newEstimate.selectedCurrency,"is-loading":t(p),store:t(e),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],40,be)]),_:1})],64)}}};export{at as default};
