import{v as H}from"./vue-i18n.c6de3223.js";import{u as N,b as Z}from"./vue-router.746ec05f.js";import{l as M,_ as ee,b as te,j as se,e as ae,g as T}from"./main.f5ac513d.js";import{L as le}from"./LoadingIcon.f4bad6f3.js";import{l as oe}from"./lodash.8ab3583e.js";import{r as P,f as L,a as w,O as i,j as o,M as b,P as n,l as e,U as l,u as a,X as v,k as m,F as Y,aW as X,R as p,g as G,as as I,i as q,e as ne,z as re}from"./@vue.8cc12e6e.js";import{_ as ie}from"./LineChart.37ee9ebf.js";import{_ as ce}from"./CustomerIndexDropdown.89da222a.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./chart.js.bab82181.js";const ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-[6.6rem] ml-56 bg-white xl:ml-64 w-88 xl:block"},de={class:"flex items-center justify-between px-4 pt-8 pb-2 border border-gray-200 border-solid height-full"},me={class:"flex mb-6 ml-3",role:"group","aria-label":"First group"},pe={class:"px-4 py-3 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},_e={class:"px-2"},fe={class:"px-2"},he={class:"flex-1 font-bold text-right whitespace-nowrap"},ye={key:0,class:"flex justify-center p-4 items-center"},ge={key:1,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},ve={__name:"CustomerViewSidebar",setup(j){const $=M(),t=N(),{t:d}=H.useI18n();let r=P(!1),s=L({orderBy:null,orderByField:null,searchText:null});const f=P(null),h=P(1),y=P(1),C=P(null);u=oe.exports.debounce(u,500);const _=w(()=>s.orderBy==="asc"||s.orderBy==null);w(()=>_.value?d("general.ascending"):d("general.descending"));function D(c){return t.params.id==c}async function k(c,x=!1){if(r.value)return;let B={};s.searchText!==""&&s.searchText!==null&&s.searchText!==void 0&&(B.display_name=s.searchText),s.orderBy!==null&&s.orderBy!==void 0&&(B.orderBy=s.orderBy),s.orderByField!==null&&s.orderByField!==void 0&&(B.orderByField=s.orderByField),r.value=!0;let F=await $.fetchCustomers({page:c,...B,limit:15});r.value=!1,f.value=f.value?f.value:[],f.value=[...f.value,...F.data.data],h.value=c||1,y.value=F.data.meta.last_page;let A=f.value.find(R=>R.id==t.params.id);x==!1&&!A&&h.value<y.value&&Object.keys(B).length===0&&k(++h.value),A&&setTimeout(()=>{x==!1&&V()},500)}function V(){const c=document.getElementById(`customer-${t.params.id}`);c&&(c.scrollIntoView({behavior:"smooth"}),c.classList.add("shake"),S())}function S(){C.value.addEventListener("scroll",c=>{c.target.scrollTop>0&&c.target.scrollTop+c.target.clientHeight>c.target.scrollHeight-200&&h.value<y.value&&k(++h.value,!0)})}async function u(){f.value=[],k()}function E(){return s.orderBy==="asc"?(s.orderBy="desc",u(),!0):(s.orderBy="asc",u(),!0)}return k(),(c,x)=>{const B=i("BaseIcon"),F=i("BaseInput"),A=i("BaseButton"),R=i("BaseRadio"),O=i("BaseInputGroup"),U=i("BaseDropdownItem"),W=i("BaseDropdown"),z=i("BaseText"),J=i("BaseFormatMoney"),K=i("router-link");return o(),b("div",ue,[n("div",de,[e(F,{modelValue:a(s).searchText,"onUpdate:modelValue":x[0]||(x[0]=g=>a(s).searchText=g),placeholder:c.$t("general.search"),"container-class":"mb-6",type:"text",variant:"gray",onInput:x[1]||(x[1]=g=>u())},{default:l(()=>[e(B,{name:"SearchIcon",class:"text-gray-500"})]),_:1},8,["modelValue","placeholder"]),n("div",me,[e(W,{"close-on-select":!1,position:"bottom-start","width-class":"w-40","position-class":"left-0"},{activator:l(()=>[e(A,{variant:"gray"},{default:l(()=>[e(B,{name:"FilterIcon"})]),_:1})]),default:l(()=>[n("div",pe,v(c.$t("general.sort_by")),1),n("div",_e,[e(U,{class:"flex px-1 py-2 mt-1 cursor-pointer hover:rounded-md"},{default:l(()=>[e(O,{class:"pt-2 -mt-4"},{default:l(()=>[e(R,{id:"filter_create_date",modelValue:a(s).orderByField,"onUpdate:modelValue":[x[2]||(x[2]=g=>a(s).orderByField=g),u],label:c.$t("customers.create_date"),size:"sm",name:"filter",value:"invoices.created_at"},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",fe,[e(U,{class:"flex px-1 cursor-pointer hover:rounded-md"},{default:l(()=>[e(O,{class:"pt-2 -mt-4"},{default:l(()=>[e(R,{id:"filter_display_name",modelValue:a(s).orderByField,"onUpdate:modelValue":[x[3]||(x[3]=g=>a(s).orderByField=g),u],label:c.$t("customers.display_name"),size:"sm",name:"filter",value:"name"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),e(A,{class:"ml-1",size:"md",variant:"gray",onClick:E},{default:l(()=>[_.value?(o(),m(B,{key:0,name:"SortAscendingIcon"})):(o(),m(B,{key:1,name:"SortDescendingIcon"}))]),_:1})])]),n("div",{ref_key:"customerListSection",ref:C,class:"h-full overflow-y-scroll border-l border-gray-200 border-solid sidebar base-scroll"},[(o(!0),b(Y,null,X(f.value,(g,Q)=>(o(),b("div",{key:Q},[g?(o(),m(K,{key:0,id:"customer-"+g.id,to:`/admin/customers/${g.id}/view`,class:G(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":D(g.id)}]),style:{"border-top":"1px solid rgba(185, 193, 209, 0.41)"}},{default:l(()=>[n("div",null,[e(z,{text:g.name,length:30,class:"pr-2 text-sm not-italic font-normal leading-5 text-black capitalize truncate"},null,8,["text"]),g.contact_name?(o(),m(z,{key:0,text:g.contact_name,length:30,class:"mt-1 text-xs not-italic font-medium leading-5 text-gray-600"},null,8,["text"])):p("",!0)]),n("div",he,[e(J,{amount:g.due_amount!==null?g.due_amount:0,currency:g.currency},null,8,["amount","currency"])])]),_:2},1032,["id","to","class"])):p("",!0)]))),128)),a(r)?(o(),b("div",ye,[e(le,{class:"h-6 m-1 animate-spin text-primary-400"})])):p("",!0),!f.value?.length&&!a(r)?(o(),b("p",ge,v(c.$t("customers.no_matching_customers")),1)):p("",!0)],512)])}}},be={class:"pt-6 mt-5 border-t border-solid lg:pt-8 md:pt-4 border-gray-200"},xe={key:0,class:"text-sm font-bold leading-5 text-black non-italic"},Be={key:0},$e={key:1},we={key:1,class:"text-sm font-bold leading-5 text-black non-italic"},Ce={__name:"CustomerInfo",setup(j){const $=M(),t=w(()=>$.selectedViewCustomer),d=w(()=>$.isFetchingViewData),r=w(()=>t?.value?.fields?t?.value?.fields:[]);return(s,f)=>{const h=i("BaseHeading"),y=i("BaseDescriptionListItem"),C=i("BaseDescriptionList"),_=i("BaseCustomerAddressDisplay");return o(),b("div",be,[e(h,null,{default:l(()=>[I(v(s.$t("customers.basic_info")),1)]),_:1}),e(C,null,{default:l(()=>[e(y,{"content-loading":d.value,label:s.$t("customers.display_name"),value:t.value?.name},null,8,["content-loading","label","value"]),e(y,{"content-loading":d.value,label:s.$t("customers.primary_contact_name"),value:t.value?.contact_name},null,8,["content-loading","label","value"]),e(y,{"content-loading":d.value,label:s.$t("customers.email"),value:t.value?.email},null,8,["content-loading","label","value"])]),_:1}),e(C,{class:"mt-5"},{default:l(()=>[e(y,{"content-loading":d.value,label:s.$t("wizard.currency"),value:t.value?.currency?`${t.value?.currency?.code} (${t.value?.currency?.symbol})`:""},null,8,["content-loading","label","value"]),e(y,{"content-loading":d.value,label:s.$t("customers.phone_number"),value:t.value?.phone},null,8,["content-loading","label","value"]),e(y,{"content-loading":d.value,label:s.$t("customers.website"),value:t.value?.website},null,8,["content-loading","label","value"])]),_:1}),t.value.billing||t.value.shipping?(o(),m(h,{key:0,class:"mt-8"},{default:l(()=>[I(v(s.$t("customers.address")),1)]),_:1})):p("",!0),e(C,{class:"mt-5"},{default:l(()=>[t.value.billing?(o(),m(y,{key:0,"content-loading":d.value,label:s.$t("customers.billing_address")},{default:l(()=>[e(_,{address:t.value.billing},null,8,["address"])]),_:1},8,["content-loading","label"])):p("",!0),t.value.shipping?(o(),m(y,{key:1,"content-loading":d.value,label:s.$t("customers.shipping_address")},{default:l(()=>[e(_,{address:t.value.shipping},null,8,["address"])]),_:1},8,["content-loading","label"])):p("",!0)]),_:1}),r.value.length>0?(o(),m(h,{key:1,class:"mt-8"},{default:l(()=>[I(v(s.$t("settings.custom_fields.title")),1)]),_:1})):p("",!0),e(C,{class:"mt-5"},{default:l(()=>[(o(!0),b(Y,null,X(r.value,(D,k)=>(o(),m(y,{key:k,"content-loading":d.value,label:D.custom_field.label},{default:l(()=>[D.type==="Switch"?(o(),b("p",xe,[D.default_answer===1?(o(),b("span",Be," Yes ")):(o(),b("span",$e," No "))])):(o(),b("p",we,v(D.default_answer),1))]),_:2},1032,["content-loading","label"]))),128))]),_:1})])}}},ke={},Te={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Ee={class:"flex justify-between mt-1 mb-6"},Ie={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},De={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ve={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Se={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"},Ae={class:"flex flex-col items-center justify-center px-6 py-2 lg:justify-end lg:items-end"};function Pe(j,$){const t=i("BaseContentPlaceholdersText"),d=i("BaseContentPlaceholdersBox"),r=i("BaseContentPlaceholders");return o(),m(r,{class:"grid grid-cols-12"},{default:l(()=>[n("div",Te,[n("div",Ee,[e(t,{class:"h-10 w-36",lines:1}),e(t,{class:"h-10 w-40 !mt-0",lines:1})]),e(d,{class:"h-80 xl:h-72 sm:w-full"})]),n("div",Ie,[n("div",De,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),n("div",Ve,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),n("div",Se,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})]),n("div",Ae,[e(t,{class:"h-3 w-14 xl:h-4",lines:1}),e(t,{class:"w-20 h-5 xl:h-6",lines:1})])])]),_:1})}var Fe=ee(ke,[["render",Pe]]);const je={key:1,class:"grid grid-cols-12"},Re={class:"col-span-12 xl:col-span-9 xxl:col-span-10"},Le={class:"flex justify-between mt-1 mb-6"},Me={class:"flex items-center"},Ne={class:"w-40 h-10"},Oe={class:"grid col-span-12 mt-6 text-center xl:mt-0 sm:grid-cols-4 xl:text-right xl:col-span-3 xl:grid-cols-1 xxl:col-span-2"},Ue={class:"px-6 py-2"},ze={class:"text-xs leading-5 lg:text-sm"},He=n("br",null,null,-1),Ye={key:0,class:"block mt-1 text-xl font-semibold leading-8"},Xe={class:"px-6 py-2"},Ge={class:"text-xs leading-5 lg:text-sm"},qe=n("br",null,null,-1),We={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#00c99c"}},Je={class:"px-6 py-2"},Ke={class:"text-xs leading-5 lg:text-sm"},Qe=n("br",null,null,-1),Ze={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#fb7178"}},et={class:"px-6 py-2"},tt={class:"text-xs leading-5 lg:text-sm"},st=n("br",null,null,-1),at={key:0,class:"block mt-1 text-xl font-semibold leading-8",style:{color:"#5851d8"}},lt={__name:"CustomerChart",setup(j){te();const $=M();q("utils");const t=N();let d=P(!1),r=L({}),s=L({}),f=L(["This year","Previous year"]),h=P("This year");const y=w(()=>r.expenseTotals?r.expenseTotals:[]),C=w(()=>r.netProfits?r.netProfits:[]),_=w(()=>r&&r.months?r.months:[]),D=w(()=>r.receiptTotals?r.receiptTotals:[]),k=w(()=>r.invoiceTotals?r.invoiceTotals:[]);ne(t,()=>{t.params.id&&V(),h.value="This year"},{immediate:!0});async function V(){d.value=!1;let u=await $.fetchViewCustomer({id:t.params.id});u.data&&(Object.assign(r,u.data.meta.chartData),Object.assign(s,u.data.data)),d.value=!0}async function S(u){let E={id:t.params.id};u==="Previous year"?E.previous_year=!0:E.this_year=!0;let c=await $.fetchViewCustomer(E);return c.data.meta.chartData&&Object.assign(r,c.data.meta.chartData),!0}return(u,E)=>{const c=i("BaseIcon"),x=i("BaseMultiselect"),B=i("BaseFormatMoney"),F=i("BaseCard");return o(),m(F,{class:"flex flex-col mt-6"},{default:l(()=>[a($).isFetchingViewData?(o(),m(Fe,{key:0})):(o(),b("div",je,[n("div",Re,[n("div",Le,[n("h6",Me,[e(c,{name:"ChartSquareBarIcon",class:"h-5 text-primary-400"}),I(" "+v(u.$t("dashboard.monthly_chart.title")),1)]),n("div",Ne,[e(x,{modelValue:a(h),"onUpdate:modelValue":E[0]||(E[0]=A=>re(h)?h.value=A:h=A),options:a(f),"allow-empty":!1,"show-labels":!1,placeholder:u.$t("dashboard.select_year"),"can-deselect":!1,onSelect:S},null,8,["modelValue","options","placeholder"])])]),a(d)?(o(),m(ie,{key:0,invoices:k.value,expenses:y.value,receipts:D.value,income:C.value,labels:_.value,class:"sm:w-full"},null,8,["invoices","expenses","receipts","income","labels"])):p("",!0)]),n("div",Oe,[n("div",Ue,[n("span",ze,v(u.$t("dashboard.chart_info.total_sales")),1),He,a(d)?(o(),b("span",Ye,[e(B,{amount:a(r).salesTotal,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)]),n("div",Xe,[n("span",Ge,v(u.$t("dashboard.chart_info.total_receipts")),1),qe,a(d)?(o(),b("span",We,[e(B,{amount:a(r).totalExpenses,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)]),n("div",Je,[n("span",Ke,v(u.$t("dashboard.chart_info.total_expense")),1),Qe,a(d)?(o(),b("span",Ze,[e(B,{amount:a(r).totalExpenses,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)]),n("div",et,[n("span",tt,v(u.$t("dashboard.chart_info.net_income")),1),st,a(d)?(o(),b("span",at,[e(B,{amount:a(r).netProfit,currency:a(s).currency},null,8,["amount","currency"])])):p("",!0)])])])),e(Ce)]),_:1})}}},St={__name:"View",setup(j){q("utils"),se();const $=M(),t=ae();H.useI18n();const d=Z(),r=N();P(null);const s=w(()=>$.selectedViewCustomer.customer?$.selectedViewCustomer.customer.name:"");let f=w(()=>$.isFetchingViewData);function h(){return t.hasAbilities([T.CREATE_ESTIMATE,T.CREATE_INVOICE,T.CREATE_PAYMENT,T.CREATE_EXPENSE])}function y(){return t.hasAbilities([T.DELETE_CUSTOMER,T.EDIT_CUSTOMER])}function C(){d.push("/admin/customers")}return(_,D)=>{const k=i("BaseButton"),V=i("router-link"),S=i("BaseIcon"),u=i("BaseDropdownItem"),E=i("BaseDropdown"),c=i("BasePageHeader"),x=i("BasePage");return o(),m(x,{class:"xl:pl-96"},{default:l(()=>[e(c,{title:s.value},{actions:l(()=>[a(t).hasAbilities(a(T).EDIT_CUSTOMER)?(o(),m(V,{key:0,to:`/admin/customers/${a(r).params.id}/edit`},{default:l(()=>[e(k,{class:"mr-3",variant:"primary-outline","content-loading":a(f)},{default:l(()=>[I(v(_.$t("general.edit")),1)]),_:1},8,["content-loading"])]),_:1},8,["to"])):p("",!0),h()?(o(),m(E,{key:1,position:"bottom-end","content-loading":a(f)},{activator:l(()=>[e(k,{class:"mr-3",variant:"primary","content-loading":a(f)},{default:l(()=>[I(v(_.$t("customers.new_transaction")),1)]),_:1},8,["content-loading"])]),default:l(()=>[a(t).hasAbilities(a(T).CREATE_ESTIMATE)?(o(),m(V,{key:0,to:`/admin/estimates/create?customer=${_.$route.params.id}`},{default:l(()=>[e(u,{class:""},{default:l(()=>[e(S,{name:"DocumentIcon",class:"mr-3 text-gray-600"}),I(" "+v(_.$t("estimates.new_estimate")),1)]),_:1})]),_:1},8,["to"])):p("",!0),a(t).hasAbilities(a(T).CREATE_INVOICE)?(o(),m(V,{key:1,to:`/admin/invoices/create?customer=${_.$route.params.id}`},{default:l(()=>[e(u,null,{default:l(()=>[e(S,{name:"DocumentTextIcon",class:"mr-3 text-gray-600"}),I(" "+v(_.$t("invoices.new_invoice")),1)]),_:1})]),_:1},8,["to"])):p("",!0),a(t).hasAbilities(a(T).CREATE_PAYMENT)?(o(),m(V,{key:2,to:`/admin/payments/create?customer=${_.$route.params.id}`},{default:l(()=>[e(u,null,{default:l(()=>[e(S,{name:"CreditCardIcon",class:"mr-3 text-gray-600"}),I(" "+v(_.$t("payments.new_payment")),1)]),_:1})]),_:1},8,["to"])):p("",!0),a(t).hasAbilities(a(T).CREATE_EXPENSE)?(o(),m(V,{key:3,to:`/admin/expenses/create?customer=${_.$route.params.id}`},{default:l(()=>[e(u,null,{default:l(()=>[e(S,{name:"CalculatorIcon",class:"mr-3 text-gray-600"}),I(" "+v(_.$t("expenses.new_expense")),1)]),_:1})]),_:1},8,["to"])):p("",!0)]),_:1},8,["content-loading"])):p("",!0),y()?(o(),m(ce,{key:2,class:G({"ml-3":a(f)}),row:a($).selectedViewCustomer,"load-data":C},null,8,["class","row"])):p("",!0)]),_:1},8,["title"]),e(ve),e(lt)]),_:1})}}};export{St as default};
