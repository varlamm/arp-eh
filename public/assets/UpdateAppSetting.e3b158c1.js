import{r as d,f as D,a as R,O as v,j as s,k as V,U as w,P as t,X as a,u as n,l as h,as as S,R as y,L as O,bx as W,M as i,F as j,aW as T,g as X}from"./@vue.8cc12e6e.js";import{u as Y,j as G,b as J,h as q}from"./main.f5ac513d.js";import{a as $}from"./axios.7b768d2b.js";import{L as Q}from"./LoadingIcon.f4bad6f3.js";import{v as Z}from"./vue-i18n.c6de3223.js";import{u as ee}from"./exchange-rate.b16bc248.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./vue-router.746ec05f.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";const te={class:"pb-8 ml-0"},ae={class:"text-sm not-italic font-medium input-label"},se={class:"box-border flex w-16 p-3 my-2 text-sm text-gray-600 bg-gray-200 border border-gray-200 border-solid rounded-md version"},ne={key:1,class:"mt-4 content"},ie={class:"rounded-md bg-primary-50 p-4 mb-3"},re={class:"flex"},oe={class:"shrink-0"},le={class:"ml-3"},de={class:"text-sm font-medium text-primary-800"},pe={class:"mt-2 text-sm text-primary-700"},ue={class:"text-sm not-italic font-medium input-label"},ce=t("br",null,null,-1),me={class:"box-border flex w-16 p-3 my-2 text-sm text-gray-600 bg-gray-200 border border-gray-200 border-solid rounded-md version"},_e=["innerHTML"],ge={class:"text-sm not-italic font-medium input-label"},fe={class:"w-1/2 mt-2 border-2 border-gray-200 BaseTable-fixed"},ve={width:"70%",class:"p-2 text-sm truncate"},he={width:"30%",class:"p-2 text-sm text-right"},ye={key:0,class:"inline-block w-4 h-4 ml-3 mr-2 bg-green-500 rounded-full"},be={key:1,class:"inline-block w-4 h-4 ml-3 mr-2 bg-red-500 rounded-full"},xe={key:2,class:"relative flex justify-between mt-4 content"},we={class:"m-0 mb-3 font-medium sw-section-title"},ke={class:"mb-8 text-sm leading-snug text-gray-500",style:{"max-width":"480px"}},Be={key:3,class:"w-full p-0 list-none"},Ue={class:"m-0 text-sm leading-8"},Se={class:"flex flex-row items-center"},$e={key:0,class:"mr-3 text-xs text-gray-500"},tt={__name:"UpdateAppSetting",setup(Ce){const k=Y(),z=G(),{t:p,tm:Ne}=Z.useI18n();J(),ee();let b=d(!1),c=d(!1),C=d(""),B=d(""),m=d(null),N=d(null),o=d(!1);const U=D([{translationKey:"settings.update_app.download_zip_file",stepUrl:"/api/v1/update/download",time:null,started:!1,completed:!1},{translationKey:"settings.update_app.unzipping_package",stepUrl:"/api/v1/update/unzip",time:null,started:!1,completed:!1},{translationKey:"settings.update_app.copying_files",stepUrl:"/api/v1/update/copy",time:null,started:!1,completed:!1},{translationKey:"settings.update_app.deleting_files",stepUrl:"/api/v1/update/delete",time:null,started:!1,completed:!1},{translationKey:"settings.update_app.running_migrations",stepUrl:"/api/v1/update/migrate",time:null,started:!1,completed:!1},{translationKey:"settings.update_app.finishing_update",stepUrl:"/api/v1/update/finish",time:null,started:!1,completed:!1}]),x=D({isMinor:Boolean,installed:"",version:""});let E=d(null);window.addEventListener("beforeunload",e=>{o.value&&(e.returnValue="Update is in progress!")}),$.get("/api/v1/app/version").then(e=>{B.value=e.data.version});const M=R(()=>m.value!==null?Object.keys(m.value).every(e=>m.value[e]):!0);function A(e){switch(L(e)){case"pending":return"text-primary-800 bg-gray-200";case"finished":return"text-teal-500 bg-teal-100";case"running":return"text-blue-400 bg-blue-100";case"error":return"text-danger bg-red-200";default:return""}}async function F(){try{c.value=!0;let e=await $.get("/api/v1/check/update");if(c.value=!1,!e.data.version){k.showNotification({title:"Info!",type:"info",message:p("settings.update_app.latest_message")});return}e.data&&(x.isMinor=e.data.is_minor,x.version=e.data.version.version,C.value=e.data.version.description,m.value=e.data.version.extensions,b.value=!0,E.value=e.data.version.minimum_php_version,N.value=e.data.version.deleted_files)}catch(e){b.value=!1,c.value=!1,q(e)}}function K(){z.openDialog({title:p("general.are_you_sure"),message:p("settings.update_app.update_warning"),yesLabel:p("general.ok"),noLabel:p("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async e=>{if(e){let _=null;if(!M.value)return k.showNotification({type:"error",message:"Your current configuration does not match the update requirements. Please try again after all the requirements are fulfilled."}),!0;for(let u=0;u<U.length;u++){let r=U[u];try{o.value=!0,r.started=!0;let g={version:x.version,installed:B.value,deleted_files:N.value,path:_||null},f=await $.post(r.stepUrl,g);r.completed=!0,f.data&&f.data.path&&(_=f.data.path),r.translationKey=="settings.update_app.finishing_update"&&(o.value=!1,k.showNotification({type:"success",message:p("settings.update_app.update_success")}),setTimeout(()=>{location.reload()},3e3))}catch(g){return r.started=!1,r.completed=!0,q(g),H(r.translationKey),!1}}}})}function H(e){if(p(e).value){K();return}o.value=!1}function L(e){return e.started&&e.completed?"finished":e.started&&!e.completed?"running":!e.started&&!e.completed?"pending":"error"}return(e,_)=>{const u=v("BaseButton"),r=v("BaseDivider"),g=v("BaseHeading"),f=v("BaseIcon"),P=v("BaseSettingCard");return s(),V(P,{title:e.$t("settings.update_app.title"),description:e.$t("settings.update_app.description")},{default:w(()=>[t("div",te,[t("label",ae,a(e.$t("settings.update_app.current_version")),1),t("div",se,a(n(B)),1),h(u,{loading:n(c),disabled:n(c)||n(o),variant:"primary-outline",class:"mt-6",onClick:F},{default:w(()=>[S(a(e.$t("settings.update_app.check_update")),1)]),_:1},8,["loading","disabled"]),n(b)?(s(),V(r,{key:0,class:"mt-6 mb-4"})):y("",!0),n(b)?O((s(),i("div",ne,[h(g,{type:"heading-title",class:"mb-2"},{default:w(()=>[S(a(e.$t("settings.update_app.avail_update")),1)]),_:1}),t("div",ie,[t("div",re,[t("div",oe,[h(f,{name:"InformationCircleIcon",class:"h-5 w-5 text-primary-400","aria-hidden":"true"})]),t("div",le,[t("h3",de,a(e.$t("general.note")),1),t("div",pe,[t("p",null,a(e.$t("settings.update_app.update_warning")),1)])])])]),t("label",ue,a(e.$t("settings.update_app.next_version")),1),ce,t("div",me,a(x.version),1),t("div",{class:"pl-5 mt-4 mb-8 text-sm leading-snug text-gray-500 update-description",style:{"white-space":"pre-wrap","max-width":"480px"},innerHTML:n(C)},null,8,_e),t("label",ge,a(e.$t("settings.update_app.requirements")),1),t("table",fe,[(s(!0),i(j,null,T(n(m),(l,I)=>(s(),i("tr",{key:I,class:"p-2 border-2 border-gray-200"},[t("td",ve,a(I),1),t("td",he,[l?(s(),i("span",ye)):(s(),i("span",be))])]))),128))]),h(u,{class:"mt-10",variant:"primary",onClick:K},{default:w(()=>[S(a(e.$t("settings.update_app.update")),1)]),_:1})],512)),[[W,!n(o)]]):y("",!0),n(o)?(s(),i("div",xe,[t("div",null,[t("h6",we,a(e.$t("settings.update_app.update_progress")),1),t("p",ke,a(e.$t("settings.update_app.progress_text")),1)]),h(Q,{class:"absolute right-0 h-6 m-1 animate-spin text-primary-400"})])):y("",!0),n(o)?(s(),i("ul",Be,[(s(!0),i(j,null,T(U,l=>(s(),i("li",{key:l.stepUrl,class:"flex justify-between w-full py-3 border-b border-gray-200 border-solid last:border-b-0"},[t("p",Ue,a(e.$t(l.translationKey)),1),t("div",Se,[l.time?(s(),i("span",$e,a(l.time),1)):y("",!0),t("span",{class:X([A(l),"block py-1 text-sm text-center uppercase rounded-full"]),style:{width:"88px"}},a(L(l)),3)])]))),128))])):y("",!0)])]),_:1},8,["title","description"])}}};export{tt as default};
