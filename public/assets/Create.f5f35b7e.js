import{i as ue,r as w,f as se,a as I,w as me,m as ie,O as s,j as C,M as ce,l as r,U as l,P as $,u as t,k as M,g as x,R as U,as as q,X as P,by as de,F as pe}from"./@vue.8cc12e6e.js";import{_ as ye}from"./ExchangeRateConverter.8557ba74.js";import{u as ve,b as _e}from"./vue-router.746ec05f.js";import{v as fe}from"./vue-i18n.c6de3223.js";import{d as Pe,c as B,r as k,h as ge,a as be,f as $e}from"./@vuelidate.c7422de1.js";import{u as Be,l as he,m as Ie,b as Ce,c as Se,i as Ve,d as we}from"./main.f5ac513d.js";import{u as Me}from"./payment.333e3a22.js";import{_ as qe}from"./SelectNotePopup.9871fb7b.js";import{_ as ke}from"./CreateCustomFields.52efad8b.js";import{_ as Ue}from"./PaymentModeModal.cc54ef98.js";import"./exchange-rate.b16bc248.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./lodash.8ab3583e.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./@vueuse.b6c5a1c1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./NoteModal.86bd9d44.js";const Ne=["onSubmit"],De={class:"absolute left-3.5"},Ae={class:"relative w-full"},Ee={class:"relative mt-6"},Fe={class:"z-20 float-right text-sm font-semibold leading-5 text-primary-400"},xe={class:"mb-4 text-sm font-medium text-gray-800"},G="newEstimate",_t={__name:"Create",setup(Ge){const d=ve(),j=_e(),e=Me();Be();const S=he();Ie(),Ce();const R=Se(),N=Ve();we();const D=ue("utils"),{t:p}=fe.useI18n();let g=w(!1),V=w(!1),y=w([]);const v=w(null),L=se(["customer","company","customerCustom","payment","paymentCustom"]),h=I({get:()=>e.currentPayment.amount/100,set:a=>{e.currentPayment.amount=Math.round(a*100)}}),u=I(()=>e.isFetchingInitialData),i=I(()=>d.name==="payments.edit"),A=I(()=>i.value?p("payments.edit_payment"):p("payments.new_payment")),z=I(()=>({currentPayment:{customer_id:{required:B.withMessage(p("validation.required"),k)},payment_date:{required:B.withMessage(p("validation.required"),k)},amount:{required:B.withMessage(p("validation.required"),k),between:B.withMessage(p("validation.payment_greater_than_due_amount"),ge(0,e.currentPayment.maxPayableAmount))},exchange_rate:{required:be(function(){return B.withMessage(p("validation.required"),k),e.showExchangeRate}),decimal:B.withMessage(p("validation.valid_exchange_rate"),$e)}}})),m=Pe(z,e,{$scope:G});me(()=>{e.currentPayment.customer_id&&J(e.currentPayment.customer_id),d.query.customer&&(e.currentPayment.customer_id=d.query.customer)}),e.resetCurrentPayment(),d.query.customer&&(e.currentPayment.customer_id=d.query.customer),e.fetchPaymentInitialData(i.value),d.params.id&&!i.value&&O();async function H(){R.openModal({title:p("settings.payment_modes.add_payment_mode"),componentName:"PaymentModeModal"})}function T(a){e.currentPayment.notes=""+a.notes}async function O(){let a=await N.fetchInvoice(d?.params?.id);e.currentPayment.customer_id=a.data.data.customer.id,e.currentPayment.invoice_id=a.data.data.id}async function X(a){a&&(v.value=y.value.find(n=>n.id===a),h.value=v.value.due_amount/100,e.currentPayment.maxPayableAmount=v.value.due_amount)}function J(a){if(a){let n={customer_id:a,status:"DUE",limit:"all"};i.value&&(n.status=""),V.value=!0,Promise.all([N.fetchInvoices(n),S.fetchCustomer(a)]).then(async([c,_])=>{c&&(y.value=[...c.data.data]),_&&_.data&&(e.currentPayment.selectedCustomer=_.data.data,e.currentPayment.customer=_.data.data,e.currentPayment.currency=_.data.data.currency,i.value&&!S.editCustomer&&e.currentPayment.customer_id&&(S.editCustomer=_.data.data)),e.currentPayment.invoice_id&&(v.value=y.value.find(f=>f.id===e.currentPayment.invoice_id),e.currentPayment.maxPayableAmount=v.value.due_amount+e.currentPayment.amount,h.value===0&&(h.value=v.value.due_amount/100)),i.value&&(y.value=y.value.filter(f=>f.due_amount>0||f.id==e.currentPayment.invoice_id)),V.value=!1}).catch(c=>{V.value=!1,console.error(c,"error")})}}ie(()=>{e.resetCurrentPayment(),y.value=[],S.editCustomer=null});async function K(){if(m.value.$touch(),m.value.$invalid)return!1;g.value=!0;let a={...e.currentPayment},n=null;try{n=await(i.value?e.updatePayment:e.addPayment)(a),j.push(`/admin/payments/${n.data.data.id}/view`)}catch{g.value=!1}}function Q(a){let n={userId:a};d.params.id&&(n.model_id=d.params.id),e.currentPayment.invoice_id=v.value=null,e.currentPayment.amount=0,y.value=[],e.getNextNumber(n,!0)}return(a,n)=>{const c=s("BaseBreadcrumbItem"),_=s("BaseBreadcrumb"),f=s("BaseIcon"),E=s("BaseButton"),W=s("BasePageHeader"),Y=s("BaseDatePicker"),b=s("BaseInputGroup"),Z=s("BaseInput"),ee=s("BaseCustomerSelectInput"),F=s("BaseMultiselect"),te=s("BaseMoney"),ae=s("BaseSelectAction"),ne=s("BaseInputGrid"),oe=s("BaseCustomInput"),re=s("BaseCard"),le=s("BasePage");return C(),ce(pe,null,[r(Ue),r(le,{class:"relative payment-create"},{default:l(()=>[$("form",{action:"",onSubmit:de(K,["prevent"])},[r(W,{title:A.value,class:"mb-5"},{actions:l(()=>[r(E,{loading:t(g),disabled:t(g),variant:"primary",type:"submit",class:"hidden sm:flex"},{left:l(o=>[t(g)?U("",!0):(C(),M(f,{key:0,name:"SaveIcon",class:x(o.class)},null,8,["class"]))]),default:l(()=>[q(" "+P(i.value?a.$t("payments.update_payment"):a.$t("payments.save_payment")),1)]),_:1},8,["loading","disabled"])]),default:l(()=>[r(_,null,{default:l(()=>[r(c,{title:a.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(c,{title:a.$tc("payments.payment",2),to:"/admin/payments"},null,8,["title"]),r(c,{title:A.value,to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(re,null,{default:l(()=>[r(ne,null,{default:l(()=>[r(b,{label:a.$t("payments.date"),"content-loading":u.value,required:"",error:t(m).currentPayment.payment_date.$error&&t(m).currentPayment.payment_date.$errors[0].$message},{default:l(()=>[r(Y,{modelValue:t(e).currentPayment.payment_date,"onUpdate:modelValue":[n[0]||(n[0]=o=>t(e).currentPayment.payment_date=o),n[1]||(n[1]=o=>t(m).currentPayment.payment_date.$touch())],"content-loading":u.value,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:t(m).currentPayment.payment_date.$error},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),r(b,{label:a.$t("payments.payment_number"),"content-loading":u.value,required:""},{default:l(()=>[r(Z,{modelValue:t(e).currentPayment.payment_number,"onUpdate:modelValue":n[2]||(n[2]=o=>t(e).currentPayment.payment_number=o),"content-loading":u.value},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),r(b,{label:a.$t("payments.customer"),error:t(m).currentPayment.customer_id.$error&&t(m).currentPayment.customer_id.$errors[0].$message,"content-loading":u.value,required:""},{default:l(()=>[u.value?U("",!0):(C(),M(ee,{key:0,modelValue:t(e).currentPayment.customer_id,"onUpdate:modelValue":[n[3]||(n[3]=o=>t(e).currentPayment.customer_id=o),n[4]||(n[4]=o=>Q(t(e).currentPayment.customer_id))],"content-loading":u.value,invalid:t(m).currentPayment.customer_id.$error,placeholder:a.$t("customers.select_a_customer"),"show-action":""},null,8,["modelValue","content-loading","invalid","placeholder"]))]),_:1},8,["label","error","content-loading"]),r(b,{"content-loading":u.value,label:a.$t("payments.invoice"),"help-text":v.value?`Due Amount: ${t(e).currentPayment.maxPayableAmount/100}`:""},{default:l(()=>[r(F,{modelValue:t(e).currentPayment.invoice_id,"onUpdate:modelValue":n[5]||(n[5]=o=>t(e).currentPayment.invoice_id=o),"content-loading":u.value,"value-prop":"id","track-by":"invoice_number",label:"invoice_number",options:t(y),loading:t(V),placeholder:a.$t("invoices.select_invoice"),onSelect:X},{singlelabel:l(({value:o})=>[$("div",De,P(o.invoice_number)+" ("+P(t(D).formatMoney(o.total,o.customer.currency))+") ",1)]),option:l(({option:o})=>[q(P(o.invoice_number)+" ("+P(t(D).formatMoney(o.total,o.customer.currency))+") ",1)]),_:1},8,["modelValue","content-loading","options","loading","placeholder"])]),_:1},8,["content-loading","label","help-text"]),r(b,{label:a.$t("payments.amount"),"content-loading":u.value,error:t(m).currentPayment.amount.$error&&t(m).currentPayment.amount.$errors[0].$message,required:""},{default:l(()=>[$("div",Ae,[(C(),M(te,{key:t(e).currentPayment.currency,modelValue:h.value,"onUpdate:modelValue":[n[6]||(n[6]=o=>h.value=o),n[7]||(n[7]=o=>t(m).currentPayment.amount.$touch())],currency:t(e).currentPayment.currency,"content-loading":u.value,invalid:t(m).currentPayment.amount.$error},null,8,["modelValue","currency","content-loading","invalid"]))])]),_:1},8,["label","content-loading","error"]),r(b,{"content-loading":u.value,label:a.$t("payments.payment_mode")},{default:l(()=>[r(F,{modelValue:t(e).currentPayment.payment_method_id,"onUpdate:modelValue":n[8]||(n[8]=o=>t(e).currentPayment.payment_method_id=o),"content-loading":u.value,label:"name","value-prop":"id","track-by":"name",options:t(e).paymentModes,placeholder:a.$t("payments.select_payment_mode"),searchable:""},{action:l(()=>[r(ae,{onClick:H},{default:l(()=>[r(f,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),q(" "+P(a.$t("settings.payment_modes.add_payment_mode")),1)]),_:1})]),_:1},8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(ye,{store:t(e),"store-prop":"currentPayment",v:t(m).currentPayment,"is-loading":u.value,"is-edit":i.value,"customer-currency":t(e).currentPayment.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1}),r(ke,{type:"Payment","is-edit":i.value,"is-loading":u.value,store:t(e),"store-prop":"currentPayment","custom-field-scope":G,class:"mt-6"},null,8,["is-edit","is-loading","store"]),$("div",Ee,[$("div",Fe,[r(qe,{type:"Payment",onSelect:T})]),$("label",xe,P(a.$t("estimates.notes")),1),r(oe,{modelValue:t(e).currentPayment.notes,"onUpdate:modelValue":n[9]||(n[9]=o=>t(e).currentPayment.notes=o),"content-loading":u.value,fields:L,class:"mt-1"},null,8,["modelValue","content-loading","fields"])]),r(E,{loading:t(g),"content-loading":u.value,variant:"primary",type:"submit",class:"flex justify-center w-full mt-4 sm:hidden md:hidden"},{left:l(o=>[t(g)?U("",!0):(C(),M(f,{key:0,name:"SaveIcon",class:x(o.class)},null,8,["class"]))]),default:l(()=>[q(" "+P(i.value?a.$t("payments.update_payment"):a.$t("payments.save_payment")),1)]),_:1},8,["loading","content-loading"])]),_:1})],40,Ne)]),_:1})],64)}}};export{_t as default};
