import{r as h,f as de,a as F,b as pe,O as o,j as b,k as E,U as s,l as a,L as C,bx as I,u as r,g as y,as as p,X as _,R as w,P as g,aq as _e}from"./@vue.8cc12e6e.js";import{b as fe}from"./vue-router.746ec05f.js";import{v as be}from"./vue-i18n.c6de3223.js";import{k as Ee,j as ge,e as ve,g as f}from"./main.f5ac513d.js";import{_ as Be}from"./ObservatoryIcon.5786089a.js";import{_ as he}from"./EstimateIndexDropdown.e28cee42.js";import{_ as ye}from"./SendEstimateModal.403a3e08.js";import{d as Te}from"./@vueuse.b6c5a1c1.js";import"./@intlify.0be1c2d8.js";import"./vue.a6ed3e81.js";import"./v-tooltip.1cd7a91e.js";import"./vue-resize.0b8cd4b5.js";import"./@popperjs.940d197a.js";import"./axios.7b768d2b.js";import"./pinia.32c02ade.js";import"./lodash.8ab3583e.js";import"./@vuelidate.c7422de1.js";import"./moment.9709ab41.js";import"./guid.7b3dea7e.js";import"./@headlessui.4523e0e1.js";import"./prettier.6e0a0647.js";import"./vue-flatpickr-component.30399bbe.js";import"./flatpickr.dff0933c.js";import"./@heroicons.aa650707.js";import"./v-money3.6f830de1.js";import"./maska.1121c2e3.js";import"./mail-driver.f62a08cc.js";const ke=g("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1),Ce={class:"relative table-container"},Ie={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},Ae={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Se={class:"absolute items-center left-6 top-2.5 select-none"},$e={class:"relative block"},lt={__name:"Index",setup(Ve){const m=Ee(),W=ge(),T=ve(),k=h(null),{t:i}=be.useI18n(),v=h(!1),j=h(["DRAFT","SENT","VIEWED","EXPIRED","ACCEPTED","REJECTED"]),A=h(!0),c=h("general.draft");fe();let l=de({customer_id:"",status:"",from_date:"",to_date:"",estimate_number:""});const P=F(()=>!m.totalEstimateCount&&!A.value),R=F({get:()=>m.selectedEstimates,set:t=>{m.selectEstimate(t)}}),G=F(()=>[{key:"checkbox",thClass:"extra w-10 pr-0",sortable:!1,tdClass:"font-medium text-gray-900 pr-0"},{key:"estimate_date",label:i("estimates.date"),thClass:"extra",tdClass:"font-medium text-gray-500"},{key:"estimate_number",label:i("estimates.number",2)},{key:"name",label:i("estimates.customer")},{key:"status",label:i("estimates.status")},{key:"total",label:i("estimates.total"),tdClass:"font-medium text-gray-900"},{key:"actions",tdClass:"text-right text-sm font-medium pl-0",thClass:"text-right pl-0",sortable:!1}]);Te(l,()=>{q()},{debounce:500}),pe(()=>{m.selectAllField&&m.selectAllEstimates()});function L(){return T.hasAbilities([f.CREATE_ESTIMATE,f.EDIT_ESTIMATE,f.VIEW_ESTIMATE,f.SEND_ESTIMATE])}async function O(t,n){l.status="",S()}function S(){k.value&&k.value.refresh()}async function X({page:t,filter:n,sort:d}){let $={customer_id:l.customer_id,status:l.status,from_date:l.from_date,to_date:l.to_date,estimate_number:l.estimate_number,orderByField:d.fieldName||"created_at",orderBy:d.order||"desc",page:t};A.value=!0;let u=await m.fetchEstimates($);return A.value=!1,{data:u.data.data,pagination:{totalPages:u.data.meta.last_page,currentPage:t,totalCount:u.data.meta.total,limit:10}}}function H(t){if(c.value==t.title)return!0;switch(c.value=t.title,t.title){case i("general.draft"):l.status="DRAFT";break;case i("general.sent"):l.status="SENT";break;default:l.status="";break}}function q(){m.$patch(t=>{t.selectedEstimates=[],t.selectAllField=!1}),S()}function M(){l.customer_id="",l.status="",l.from_date="",l.to_date="",l.estimate_number="",c.value=i("general.all")}function z(){v.value&&M(),v.value=!v.value}async function J(){W.openDialog({title:i("general.are_you_sure"),message:i("estimates.confirm_delete"),yesLabel:i("general.ok"),noLabel:i("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(t=>{t&&m.deleteMultipleEstimates().then(n=>{S(),n.data&&m.$patch(d=>{d.selectedEstimates=[],d.selectAllField=!1})})})}function K(t){switch(t){case"DRAFT":c.value=i("general.draft");break;case"SENT":c.value=i("general.sent");break;case"VIEWED":c.value=i("estimates.viewed");break;case"EXPIRED":c.value=i("estimates.expired");break;case"ACCEPTED":c.value=i("estimates.accepted");break;case"REJECTED":c.value=i("estimates.rejected");break;default:c.value=i("general.all");break}}return(t,n)=>{const d=o("BaseBreadcrumbItem"),$=o("BaseBreadcrumb"),u=o("BaseIcon"),V=o("BaseButton"),x=o("router-link"),Q=o("BasePageHeader"),Y=o("BaseCustomerSelectInput"),B=o("BaseInputGroup"),Z=o("BaseMultiselect"),N=o("BaseDatePicker"),ee=o("BaseInput"),te=o("BaseFilterWrapper"),ae=o("BaseEmptyPlaceholder"),D=o("BaseTab"),se=o("BaseTabGroup"),le=o("BaseDropdownItem"),oe=o("BaseDropdown"),U=o("BaseCheckbox"),ne=o("BaseText"),re=o("BaseEstimateStatusBadge"),ie=o("BaseFormatMoney"),me=o("BaseTable"),ue=o("BasePage");return b(),E(ue,null,{default:s(()=>[a(ye),a(Q,{title:t.$t("estimates.title")},{actions:s(()=>[C(a(V,{variant:"primary-outline",onClick:z},{right:s(e=>[v.value?(b(),E(u,{key:1,name:"XIcon",class:y(e.class)},null,8,["class"])):(b(),E(u,{key:0,class:y(e.class),name:"FilterIcon"},null,8,["class"]))]),default:s(()=>[p(_(t.$t("general.filter"))+" ",1)]),_:1},512),[[I,r(m).totalEstimateCount]]),r(T).hasAbilities(r(f).CREATE_ESTIMATE)?(b(),E(x,{key:0,to:"estimates/create"},{default:s(()=>[a(V,{variant:"primary",class:"ml-4"},{left:s(e=>[a(u,{name:"PlusIcon",class:y(e.class)},null,8,["class"])]),default:s(()=>[p(" "+_(t.$t("estimates.new_estimate")),1)]),_:1})]),_:1})):w("",!0)]),default:s(()=>[a($,null,{default:s(()=>[a(d,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),a(d,{title:t.$tc("estimates.estimate",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),C(a(te,{"row-on-xl":!0,onClear:M},{default:s(()=>[a(B,{label:t.$tc("customers.customer",1)},{default:s(()=>[a(Y,{modelValue:r(l).customer_id,"onUpdate:modelValue":n[0]||(n[0]=e=>r(l).customer_id=e),placeholder:t.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(B,{label:t.$t("estimates.status")},{default:s(()=>[a(Z,{modelValue:r(l).status,"onUpdate:modelValue":[n[1]||(n[1]=e=>r(l).status=e),K],options:j.value,searchable:"",placeholder:t.$t("general.select_a_status"),onRemove:n[2]||(n[2]=e=>O())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(B,{label:t.$t("general.from")},{default:s(()=>[a(N,{modelValue:r(l).from_date,"onUpdate:modelValue":n[3]||(n[3]=e=>r(l).from_date=e),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),ke,a(B,{label:t.$t("general.to")},{default:s(()=>[a(N,{modelValue:r(l).to_date,"onUpdate:modelValue":n[4]||(n[4]=e=>r(l).to_date=e),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),a(B,{label:t.$t("estimates.estimate_number")},{default:s(()=>[a(ee,{modelValue:r(l).estimate_number,"onUpdate:modelValue":n[5]||(n[5]=e=>r(l).estimate_number=e)},{left:s(e=>[a(u,{name:"HashtagIcon",class:y(e.class)},null,8,["class"])]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[I,v.value]]),C(a(ae,{title:t.$t("estimates.no_estimates"),description:t.$t("estimates.list_of_estimates")},{actions:s(()=>[r(T).hasAbilities(r(f).CREATE_ESTIMATE)?(b(),E(V,{key:0,variant:"primary-outline",onClick:n[6]||(n[6]=e=>t.$router.push("/admin/estimates/create"))},{left:s(e=>[a(u,{name:"PlusIcon",class:y(e.class)},null,8,["class"])]),default:s(()=>[p(" "+_(t.$t("estimates.add_new_estimate")),1)]),_:1})):w("",!0)]),default:s(()=>[a(Be,{class:"mt-5 mb-4"})]),_:1},8,["title","description"]),[[I,P.value]]),C(g("div",Ce,[g("div",Ie,[a(se,{class:"-mb-5",onChange:H},{default:s(()=>[a(D,{title:t.$t("general.all"),filter:""},null,8,["title"]),a(D,{title:t.$t("general.draft"),filter:"DRAFT"},null,8,["title"]),a(D,{title:t.$t("general.sent"),filter:"SENT"},null,8,["title"])]),_:1}),r(m).selectedEstimates.length&&r(T).hasAbilities(r(f).DELETE_ESTIMATE)?(b(),E(oe,{key:0,class:"absolute float-right"},{activator:s(()=>[g("span",Ae,[p(_(t.$t("general.actions"))+" ",1),a(u,{name:"ChevronDownIcon"})])]),default:s(()=>[a(le,{onClick:J},{default:s(()=>[a(u,{name:"TrashIcon",class:"mr-3 text-gray-600"}),p(" "+_(t.$t("general.delete")),1)]),_:1})]),_:1})):w("",!0)]),a(me,{ref_key:"tableComponent",ref:k,data:X,columns:G.value,"placeholder-count":r(m).totalEstimateCount>=20?10:5,class:"mt-10"},_e({header:s(()=>[g("div",Se,[a(U,{modelValue:r(m).selectAllField,"onUpdate:modelValue":n[7]||(n[7]=e=>r(m).selectAllField=e),variant:"primary",onChange:r(m).selectAllEstimates},null,8,["modelValue","onChange"])])]),"cell-checkbox":s(({row:e})=>[g("div",$e,[a(U,{id:e.id,modelValue:R.value,"onUpdate:modelValue":n[8]||(n[8]=ce=>R.value=ce),value:e.data.id},null,8,["id","modelValue","value"])])]),"cell-estimate_date":s(({row:e})=>[p(_(e.data.formatted_estimate_date),1)]),"cell-estimate_number":s(({row:e})=>[a(x,{to:{path:`estimates/${e.data.id}/view`},class:"font-medium text-primary-500"},{default:s(()=>[p(_(e.data.estimate_number),1)]),_:2},1032,["to"])]),"cell-name":s(({row:e})=>[a(ne,{text:e.data.customer.name,length:30},null,8,["text"])]),"cell-status":s(({row:e})=>[a(re,{status:e.data.status,class:"px-3 py-1"},{default:s(()=>[p(_(e.data.status),1)]),_:2},1032,["status"])]),"cell-total":s(({row:e})=>[a(ie,{amount:e.data.total,currency:e.data.customer.currency},null,8,["amount","currency"])]),_:2},[L()?{name:"cell-actions",fn:s(({row:e})=>[a(he,{row:e.data,table:k.value},null,8,["row","table"])]),key:"0"}:void 0]),1032,["columns","placeholder-count"])],512),[[I,!P.value]])]),_:1})}}};export{lt as default};
